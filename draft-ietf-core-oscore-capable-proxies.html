<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>OSCORE-capable Proxies</title>
<meta content="Marco Tiloca" name="author">
<meta content="Rikard HÃ¶glund" name="author">
<meta content="
       Object Security for Constrained RESTful Environments (OSCORE) can be used to protect CoAP messages end-to-end between two endpoints at the application layer, also in the presence of intermediaries such as proxies. This document defines how to use OSCORE for protecting CoAP messages also between an origin application endpoint and an intermediary, or between two intermediaries. Also, it defines rules to escalate the protection of a CoAP option, in order to encrypt and integrity-protect it whenever possible. Finally, it defines how to secure a CoAP message by applying multiple, nested OSCORE protections, e.g., both end-to-end between origin application endpoints; and between an application endpoint and an intermediary or between two intermediaries. Therefore, this document updates RFC 8613. Furthermore, this document updates RFC 8768, by explicitly defining the processing with OSCORE for the CoAP option Hop-Limit. The approach defined in this document can be seamlessly used with Group OSCORE, for protecting CoAP messages when group communication is used in the presence of intermediaries. 
    " name="description">
<meta content="xml2rfc 3.30.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-core-oscore-capable-proxies-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.30.0
    Python 3.12.11
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 5.3.1
    platformdirs 4.3.8
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.4
    setuptools 80.9.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-core-oscore-capable-proxies.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "â";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">OSCORE-capable Proxies</td>
<td class="right">September 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Tiloca &amp; HÃ¶glund</td>
<td class="center">Expires 5 March 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">CoRE Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-core-oscore-capable-proxies-latest</dd>
<dt class="label-updates">Updates:</dt>
<dd class="updates">
<a href="https://www.rfc-editor.org/rfc/rfc8613" class="eref">8613</a>, <a href="https://www.rfc-editor.org/rfc/rfc8768" class="eref">8768</a> (if approved)</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-09-01" class="published">1 September 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-03-05">5 March 2026</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Tiloca</div>
<div class="org">RISE AB</div>
</div>
<div class="author">
      <div class="author-name">R. HÃ¶glund</div>
<div class="org">RISE AB</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">OSCORE-capable Proxies</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">Object Security for Constrained RESTful Environments (OSCORE) can be used to protect CoAP messages end-to-end between two endpoints at the application layer, also in the presence of intermediaries such as proxies. This document defines how to use OSCORE for protecting CoAP messages also between an origin application endpoint and an intermediary, or between two intermediaries. Also, it defines rules to escalate the protection of a CoAP option, in order to encrypt and integrity-protect it whenever possible. Finally, it defines how to secure a CoAP message by applying multiple, nested OSCORE protections, e.g., both end-to-end between origin application endpoints; and between an application endpoint and an intermediary or between two intermediaries. Therefore, this document updates RFC 8613. Furthermore, this document updates RFC 8768, by explicitly defining the processing with OSCORE for the CoAP option Hop-Limit. The approach defined in this document can be seamlessly used with Group OSCORE, for protecting CoAP messages when group communication is used in the presence of intermediaries.<a href="#section-abstract-1" class="pilcrow">Â¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">Â¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
    Constrained RESTful Environments Working Group mailing list (core@ietf.org),
    which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/core/">https://mailarchive.ietf.org/arch/browse/core/</a></span>.<a href="#section-note.1-2" class="pilcrow">Â¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/core-wg/oscore-capable-proxies">https://github.com/core-wg/oscore-capable-proxies</a></span>.<a href="#section-note.1-3" class="pilcrow">Â¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 5 March 2026.<a href="#section-boilerplate.1-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">â²</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.Â Â <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.Â Â <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.Â Â <a href="#name-message-processing" class="internal xref">Message Processing</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="auto internal xref">2.1</a>.Â Â <a href="#name-deviations-from-the-origina" class="internal xref">Deviations from the Original Message Processing</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.Â Â <a href="#name-protection-of-coap-options" class="internal xref">Protection of CoAP Options</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="auto internal xref">2.3</a>.Â Â <a href="#name-processing-of-an-outgoing-r" class="internal xref">Processing of an Outgoing Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="auto internal xref">2.4</a>.Â Â <a href="#name-processing-of-an-incoming-r" class="internal xref">Processing of an Incoming Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.5">
                <p id="section-toc.1-1.2.2.5.1"><a href="#section-2.5" class="auto internal xref">2.5</a>.Â Â <a href="#name-processing-of-an-outgoing-re" class="internal xref">Processing of an Outgoing Response</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.6">
                <p id="section-toc.1-1.2.2.6.1"><a href="#section-2.6" class="auto internal xref">2.6</a>.Â Â <a href="#name-processing-of-an-incoming-re" class="internal xref">Processing of an Incoming Response</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.Â Â <a href="#name-oscore-processing-of-the-ho" class="internal xref">OSCORE Processing of the Hop-Limit Option</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.Â Â <a href="#name-caching-of-oscore-protected" class="internal xref">Caching of OSCORE-Protected Responses</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.Â Â <a href="#name-establishment-of-oscore-sec" class="internal xref">Establishment of OSCORE Security Contexts</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.Â Â <a href="#name-coap-header-compression-wit" class="internal xref">CoAP Header Compression with SCHC</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.Â Â <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.Â Â <a href="#name-preserving-location-anonymi" class="internal xref">Preserving Location Anonymity</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.Â Â <a href="#name-hop-limit-option" class="internal xref">Hop-Limit Option</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.Â Â <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.Â Â <a href="#name-coap-option-numbers-registr" class="internal xref">CoAP Option Numbers Registry</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.Â Â <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.Â Â <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.Â Â <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.Â Â <a href="#name-use-cases" class="internal xref">Use Cases</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#appendix-A.1" class="auto internal xref">A.1</a>.Â Â <a href="#name-coap-group-communication-wi" class="internal xref">CoAP Group Communication with Proxies</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#appendix-A.2" class="auto internal xref">A.2</a>.Â Â <a href="#name-coap-observe-notifications-" class="internal xref">CoAP Observe Notifications over Multicast</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a href="#appendix-A.3" class="auto internal xref">A.3</a>.Â Â <a href="#name-lwm2m-client-and-external-a" class="internal xref">LwM2M Client and External Application Server</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.4">
                <p id="section-toc.1-1.10.2.4.1"><a href="#appendix-A.4" class="auto internal xref">A.4</a>.Â Â <a href="#name-lwm2m-gateway" class="internal xref">LwM2M Gateway</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.5">
                <p id="section-toc.1-1.10.2.5.1"><a href="#appendix-A.5" class="auto internal xref">A.5</a>.Â Â <a href="#name-further-use-cases" class="internal xref">Further Use Cases</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.Â Â <a href="#name-examples-of-message-exchang" class="internal xref">Examples of Message Exchanges</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#appendix-B.1" class="auto internal xref">B.1</a>.Â Â <a href="#name-with-forward-proxy-oscore-c" class="internal xref">With Forward-Proxy; OSCORE: C-S, C-P</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#appendix-B.2" class="auto internal xref">B.2</a>.Â Â <a href="#name-with-forward-proxy-oscore-c-" class="internal xref">With Forward-Proxy; OSCORE: C-S, P-S</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#appendix-B.3" class="auto internal xref">B.3</a>.Â Â <a href="#name-with-forward-proxy-oscore-c-s" class="internal xref">With Forward-Proxy; OSCORE: C-S, C-P, P-S</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.4">
                <p id="section-toc.1-1.11.2.4.1"><a href="#appendix-B.4" class="auto internal xref">B.4</a>.Â Â <a href="#name-with-forward-proxy-and-edho" class="internal xref">With Forward-Proxy and EDHOC; OSCORE: C-S, C-P</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.5">
                <p id="section-toc.1-1.11.2.5.1"><a href="#appendix-B.5" class="auto internal xref">B.5</a>.Â Â <a href="#name-with-forward-proxy-and-edhoc" class="internal xref">With Forward-Proxy and EDHOC (optimized); OSCORE: C-S, C-P</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.6">
                <p id="section-toc.1-1.11.2.6.1"><a href="#appendix-B.6" class="auto internal xref">B.6</a>.Â Â <a href="#name-with-reverse-proxy-oscore-c" class="internal xref">With Reverse-Proxy; OSCORE: C-P, P-S</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.7">
                <p id="section-toc.1-1.11.2.7.1"><a href="#appendix-B.7" class="auto internal xref">B.7</a>.Â Â <a href="#name-with-reverse-proxy-oscore-c-" class="internal xref">With Reverse-Proxy; OSCORE: C-S, C-P, P-S</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-C" class="auto internal xref">Appendix C</a>.Â Â <a href="#name-state-diagram-protection-of" class="internal xref">State Diagram: Protection of CoAP Options</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-D" class="auto internal xref">Appendix D</a>.Â Â <a href="#name-state-diagram-processing-of" class="internal xref">State Diagram: Processing of Incoming Requests</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-E" class="auto internal xref">Appendix E</a>.Â Â <a href="#name-document-updates" class="internal xref">Document Updates</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.1">
                <p id="section-toc.1-1.14.2.1.1"><a href="#appendix-E.1" class="auto internal xref">E.1</a>.Â Â <a href="#name-version-04-to-05" class="internal xref">Version -04 to -05</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2">
                <p id="section-toc.1-1.14.2.2.1"><a href="#appendix-E.2" class="auto internal xref">E.2</a>.Â Â <a href="#name-version-03-to-04" class="internal xref">Version -03 to -04</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3">
                <p id="section-toc.1-1.14.2.3.1"><a href="#appendix-E.3" class="auto internal xref">E.3</a>.Â Â <a href="#name-version-02-to-03" class="internal xref">Version -02 to -03</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.4">
                <p id="section-toc.1-1.14.2.4.1"><a href="#appendix-E.4" class="auto internal xref">E.4</a>.Â Â <a href="#name-version-01-to-02" class="internal xref">Version -01 to -02</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.5">
                <p id="section-toc.1-1.14.2.5.1"><a href="#appendix-E.5" class="auto internal xref">E.5</a>.Â Â <a href="#name-version-00-to-01" class="internal xref">Version -00 to -01</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-F" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-G" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The Constrained Application Protocol (CoAP) <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> supports the presence of intermediaries such as forward-proxies and reverse-proxies, which assist origin clients by performing requests to origin servers on their behalf and forwarding back the corresponding responses.<a href="#section-1-1" class="pilcrow">Â¶</a></p>
<p id="section-1-2">CoAP supports also group communication scenarios <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, where clients can send a one-to-many request targeting all the servers in the group, e.g., by using IP multicast. Like for one-to-one communication, group settings can also rely on intermediaries <span>[<a href="#I-D.ietf-core-groupcomm-proxy" class="cite xref">I-D.ietf-core-groupcomm-proxy</a>]</span>.<a href="#section-1-2" class="pilcrow">Â¶</a></p>
<p id="section-1-3">The security protocol Object Security for Constrained RESTful Environments (OSCORE) <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> can be used to protect CoAP messages between two endpoints at the application layer, especially achieving end-to-end security in the presence of (non-trusted) intermediaries. When CoAP group communication is used, the same can be achieved by means of the security protocol Group OSCORE <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>.<a href="#section-1-3" class="pilcrow">Â¶</a></p>
<p id="section-1-4">For a number of use cases (see <a href="#sec-use-cases" class="auto internal xref">Appendix A</a>), it is required and/or beneficial that communications are secured between an application endpoint (i.e., a CoAP origin client/server) and an intermediary as well as between two adjacent intermediaries in a chain. This especially applies to the communication leg between the CoAP origin client and the adjacent intermediary acting as the next hop towards the CoAP origin server.<a href="#section-1-4" class="pilcrow">Â¶</a></p>
<p id="section-1-5">In such cases, and especially if the origin client already uses OSCORE to achieve end-to-end security with the origin server, it would be convenient that OSCORE is used also to secure communications between the origin client and its next hop.<a href="#section-1-5" class="pilcrow">Â¶</a></p>
<p id="section-1-6">However, the original specification <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> does not define how OSCORE can be used to protect CoAP messages in that communication leg, or how to generally process CoAP messages with OSCORE at an intermediary. In fact, this would require to consider also an intermediary as an "OSCORE endpoint".<a href="#section-1-6" class="pilcrow">Â¶</a></p>
<p id="section-1-7">This document fills this gap and updates <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> as follows.<a href="#section-1-7" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-8.1">
          <p id="section-1-8.1.1">It defines how to use OSCORE for protecting a CoAP message in the communication leg between: i) an origin client/server and an intermediary; or ii) two adjacent intermediaries in an intermediary chain. That is, besides origin clients/servers, it allows also intermediaries to be "OSCORE endpoints".<a href="#section-1-8.1.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-1-8.2">
          <p id="section-1-8.2.1">It defines rules to escalate the protection of a CoAP option that is originally meant to be unprotected or only integrity-protected by OSCORE. This results in both encrypting and integrity-protecting a CoAP option whenever it is possible.<a href="#section-1-8.2.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-1-8.3">
          <p id="section-1-8.3.1">It admits a CoAP message to be secured by multiple, nested OSCORE protections applied in sequence. For instance, this is the case when the message is OSCORE-protected end-to-end between the origin client and origin server, after which the result is further OSCORE-protected over the leg between the current and next hop (e.g., the origin client and the adjacent intermediary acting as the next hop towards the origin server).<a href="#section-1-8.3.1" class="pilcrow">Â¶</a></p>
</li>
      </ul>
<p id="section-1-9">Furthermore, this document updates <span>[<a href="#RFC8768" class="cite xref">RFC8768</a>]</span>, by explicitly defining the CoAP option Hop-Limit to be of Class U for OSCORE (see <a href="#sec-hop-limit" class="auto internal xref">Section 3</a>). In the case where the Hop-Limit option is first added to a request by an origin client instead of an intermediary, this update avoids undesired overhead in terms of message size and ensures that the first intermediary in the chain enforces the intent of the origin client in detecting forwarding loops.<a href="#section-1-9" class="pilcrow">Â¶</a></p>
<p id="section-1-10">This document does not specify any new signaling method to guide the message processing on the different endpoints. In particular, every endpoint is always able to understand what steps to take on an incoming message, depending on the presence of the OSCORE option and of other CoAP options intended for an intermediary.<a href="#section-1-10" class="pilcrow">Â¶</a></p>
<p id="section-1-11">The approach defined in this document can be seamlessly adopted also when Group OSCORE is used for protecting CoAP messages in group communication scenarios that rely on intermediaries.<a href="#section-1-11" class="pilcrow">Â¶</a></p>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCPÂ 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">Â¶</a></p>
<p id="section-1.1-2">Readers are expected to be familiar with the terms and concepts related to CoAP <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, and Group OSCORE <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>. This document especially builds on concepts and mechanics related to intermediaries such as CoAP forward-proxies and reverse-proxies.<a href="#section-1.1-2" class="pilcrow">Â¶</a></p>
<p id="section-1.1-3">In addition, this document uses the following terms.<a href="#section-1.1-3" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-4.1">
            <p id="section-1.1-4.1.1">Source application endpoint: an origin client producing a request or an origin server producing a response.<a href="#section-1.1-4.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.2">
            <p id="section-1.1-4.2.1">Destination application endpoint: an origin server intended to consume a request or an origin client intended to consume a response.<a href="#section-1.1-4.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.3">
            <p id="section-1.1-4.3.1">Application endpoint: a source or destination application endpoint.<a href="#section-1.1-4.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.4">
            <p id="section-1.1-4.4.1">Source OSCORE endpoint: an endpoint protecting a message with OSCORE or Group OSCORE.<a href="#section-1.1-4.4.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.5">
            <p id="section-1.1-4.5.1">Destination OSCORE endpoint: an endpoint unprotecting a message with OSCORE or Group OSCORE.<a href="#section-1.1-4.5.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.6">
            <p id="section-1.1-4.6.1">OSCORE endpoint: a source or destination OSCORE endpoint. An OSCORE endpoint is not necessarily also an application endpoint with respect to a certain message.<a href="#section-1.1-4.6.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.7">
            <p id="section-1.1-4.7.1">Hop: an endpoint in the end-to-end path between two application endpoints included.<a href="#section-1.1-4.7.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.8">
            <p id="section-1.1-4.8.1">Proxy-related options: either of the following (set of) CoAP options that a proxy can use to understand where to forward a CoAP request. These CoAP options are defined in <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> and <span>[<a href="#I-D.ietf-core-href" class="cite xref">I-D.ietf-core-href</a>]</span>.<a href="#section-1.1-4.8.1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-4.8.2.1">
                <p id="section-1.1-4.8.2.1.1">The Proxy-Uri option or the Proxy-Cri option. These are relevant when using a forward-proxy.<a href="#section-1.1-4.8.2.1.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="normal" id="section-1.1-4.8.2.2">
                <p id="section-1.1-4.8.2.2.1">The set of CoAP options comprising the Proxy-Scheme option or the Proxy-Scheme-Number option, together with any of the Uri-* options. This is relevant when using a forward-proxy.<a href="#section-1.1-4.8.2.2.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="normal" id="section-1.1-4.8.2.3">
                <p id="section-1.1-4.8.2.3.1">The set of CoAP options comprising any of the Uri-Host, Uri-Port, and Uri-Path options, when those are not used together with the Proxy-Scheme option or the Proxy-Scheme-Number option. This is relevant when using a reverse-proxy.<a href="#section-1.1-4.8.2.3.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="sec-message-processing">
<section id="section-2">
      <h2 id="name-message-processing">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-message-processing" class="section-name selfRef">Message Processing</a>
      </h2>
<p id="section-2-1">This section defines the processing of CoAP messages with OSCORE.<a href="#section-2-1" class="pilcrow">Â¶</a></p>
<p id="section-2-2"><a href="#sec-examples" class="auto internal xref">Appendix B</a> provides a number of examples where the approach defined in this document is used to protect message exchanges.<a href="#section-2-2" class="pilcrow">Â¶</a></p>
<div id="deviations-from-the-original-message-processing">
<section id="section-2.1">
        <h3 id="name-deviations-from-the-origina">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-deviations-from-the-origina" class="section-name selfRef">Deviations from the Original Message Processing</a>
        </h3>
<p id="section-2.1-1">This document introduces the following two main deviations from the original OSCORE specification <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-2.1-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-2.1">
            <p id="section-2.1-2.1.1">An "OSCORE endpoint", as a producer/consumer of an OSCORE option, can be not only an application endpoint (i.e., an origin client or server) but also an intermediary such as a proxy.<a href="#section-2.1-2.1.1" class="pilcrow">Â¶</a></p>
<p id="section-2.1-2.1.2">
Hence, OSCORE can be used between an origin client/server and a proxy as well as between two proxies in an intermediary chain.<a href="#section-2.1-2.1.2" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-2.1-2.2">
            <p id="section-2.1-2.2.1">A CoAP message can be secured by multiple OSCORE protections applied in sequence. In such a case, the final result is a message with nested OSCORE protections. Hence, following a decryption, the resulting message might legitimately include an OSCORE option and thus have in turn to be decrypted.<a href="#section-2.1-2.2.1" class="pilcrow">Â¶</a></p>
<p id="section-2.1-2.2.2">
The most common case is expected to consider a message protected with up to two OSCORE layers, i.e.: i) an inner layer, protecting the message end-to-end between the origin client and the origin server acting as application endpoints; and ii) an outer layer, protecting the message between a certain OSCORE endpoint and the other OSCORE endpoint adjacent in the intermediary chain.<a href="#section-2.1-2.2.2" class="pilcrow">Â¶</a></p>
<p id="section-2.1-2.2.3">
However, a message can also be protected with a higher, arbitrary number of nested OSCORE layers, e.g., in scenarios that rely on a longer chain of intermediaries. For instance, the origin client can sequentially apply multiple OSCORE layers to a request, each of which is intended to be consumed and removed by one of the intermediaries in the chain, until the origin server is reached and it consumes the innermost OSCORE layer.<a href="#section-2.1-2.2.3" class="pilcrow">Â¶</a></p>
<p id="section-2.1-2.2.4">
An OSCORE endpoint <span class="bcp14">SHOULD</span> define the maximum number of OSCORE layers that it is able to apply (remove) when processing an outgoing (incoming) CoAP message. The defined limit has to appropriately reflect the security requirements of the application. At the same time, such a limit is typically bounded by the maximum number of OSCORE Security Contexts that can be active at the endpoint as well as by the number of intermediary OSCORE endpoints that have been explicitly set up by the communicating parties.<a href="#section-2.1-2.2.4" class="pilcrow">Â¶</a></p>
<p id="section-2.1-2.2.5">
If its defined limit is reached when processing a CoAP message, an OSCORE endpoint <span class="bcp14">MUST NOT</span> perform any further OSCORE processing on that message. If the message is an outgoing request and it requires further OSCORE processing beyond the set limit, the endpoint <span class="bcp14">MUST</span> abort the message sending. If the message is an incoming request and it requires further OSCORE processing beyond the set limit, the endpoint <span class="bcp14">MUST</span> reply with a 4.01 (Unauthorized) error response. The endpoint protects such a response by applying the same OSCORE layers that it successfully removed from the corresponding incoming request, but in the reverse order than the one according to which they were removed (see <a href="#outgoing-responses" class="auto internal xref">Section 2.5</a>).<a href="#section-2.1-2.2.5" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="general-rules">
<section id="section-2.2">
        <h3 id="name-protection-of-coap-options">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-protection-of-coap-options" class="section-name selfRef">Protection of CoAP Options</a>
        </h3>
<p id="section-2.2-1">The following considers a sender endpoint that, when protecting an outgoing message M, applies the i-th OSCORE layer in sequence, by using the OSCORE Security Context that is shares with another OSCORE endpoint X.<a href="#section-2.2-1" class="pilcrow">Â¶</a></p>
<p id="section-2.2-2">As usual, the sender endpoint encrypts and integrity-protects the CoAP options included in M that are processed as Class E for OSCORE, as per Sections <a href="https://rfc-editor.org/rfc/rfc8613#section-4.1.1" class="relref">4.1.1</a> and <a href="https://rfc-editor.org/rfc/rfc8613#section-4.1.3" class="relref">4.1.3</a> of <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-2.2-2" class="pilcrow">Â¶</a></p>
<p id="section-2.2-3">Per the update made by this document, the sender endpoint <span class="bcp14">MUST</span> perform the procedure defined below for each CoAP option OPT that is included in M and is originally specified only as an outer option (Class U or I) for OSCORE. This procedure does not apply to options that are specified (also) as Class E. Depending on the outcome of this procedure, the sender endpoint processes OPT as per its original Class U or I, or instead as Class E.<a href="#section-2.2-3" class="pilcrow">Â¶</a></p>
<p id="section-2.2-4">Before protecting M by using the OSCORE Security Context shared with the other OSCORE endpoint X and applying the i-th OSCORE layer in sequence, the sender endpoint performs the following steps for each CoAP option OPT that is included in M and is originally specified only as an outer option (Class U or I) for OSCORE. <a href="#sec-option-protection-diag" class="auto internal xref">Appendix C</a> provides an overview of these steps through a state diagram.<a href="#section-2.2-4" class="pilcrow">Â¶</a></p>
<p id="section-2.2-5">Note that the sender endpoint can assess some conditions only "to the best of its knowledge". This is due to the possible presence of a reverse-proxy standing for X and whose presence as reverse-proxy is, by definition, expected to be unknown to the sender endpoint.<a href="#section-2.2-5" class="pilcrow">Â¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2-6">
<li id="section-2.2-6.1">
            <p id="section-2.2-6.1.1">If the sender endpoint has added OPT to M, then this algorithm moves to Step 2. Otherwise, this algorithm moves to Step 4.<a href="#section-2.2-6.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li id="section-2.2-6.2">
            <p id="section-2.2-6.2.1">If, to the best of the sender endpoint's knowledge, X is a consumer of OPT, then this algorithm moves to Step 3. Otherwise, this algorithm moves to Step 4.<a href="#section-2.2-6.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li id="section-2.2-6.3">
            <p id="section-2.2-6.3.1">If, to the best of the sender endpoint's knowledge, X is the immediately next consumer of OPT, then this algorithm moves to Step 5. Otherwise, this algorithm moves to Step 9.<a href="#section-2.2-6.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li id="section-2.2-6.4">
            <p id="section-2.2-6.4.1">If any of the following conditions holds, then this algorithm moves to Step 6. Otherwise, this algorithm moves to Step 9.<a href="#section-2.2-6.4.1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2-6.4.2.1">
                <p id="section-2.2-6.4.2.1.1">To the best of the sender endpoint's knowledge, X is the next hop for the sender endpoint; or<a href="#section-2.2-6.4.2.1.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="normal" id="section-2.2-6.4.2.2">
                <p id="section-2.2-6.4.2.2.1">To the best of the sender endpoint's knowledge, the next hop for the sender endpoint is not the immediately next consumer of OPT.<a href="#section-2.2-6.4.2.2.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
</li>
          <li id="section-2.2-6.5">
            <p id="section-2.2-6.5.1">If X needs to access OPT before having removed the i-th OSCORE layer or in order to remove the i-th OSCORE layer, then this algorithm moves to Step 9. Otherwise, this algorithm moves to Step 6.<a href="#section-2.2-6.5.1" class="pilcrow">Â¶</a></p>
</li>
          <li id="section-2.2-6.6">
            <p id="section-2.2-6.6.1">If OPT is the Uri-Host or Uri-Port option, then this algorithm moves to Step 7. Otherwise, this algorithm moves to Step 8.<a href="#section-2.2-6.6.1" class="pilcrow">Â¶</a></p>
</li>
          <li id="section-2.2-6.7">
            <p id="section-2.2-6.7.1">If M includes the Proxy-Scheme or Proxy-Scheme-Number option, then this algorithm moves to Step 8. Otherwise, this algorithm moves to Step 9.<a href="#section-2.2-6.7.1" class="pilcrow">Â¶</a></p>
</li>
          <li id="section-2.2-6.8">
            <p id="section-2.2-6.8.1">The sender endpoint determines that OPT will be processed as Class E for OSCORE, i.e., both encrypted and integrity-protected. Then, the sender endpoint terminates this algorithm.<a href="#section-2.2-6.8.1" class="pilcrow">Â¶</a></p>
</li>
          <li id="section-2.2-6.9">
            <p id="section-2.2-6.9.1">The sender endpoint determines that OPT will be processed as per its original Class U or I for OSCORE. Then, the sender endpoint terminates this algorithm.<a href="#section-2.2-6.9.1" class="pilcrow">Â¶</a></p>
</li>
        </ol>
<p id="section-2.2-7">Compared to what is defined in <span><a href="https://rfc-editor.org/rfc/rfc7252#section-5.7.1" class="relref">Section 5.7.1</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, a new requirement is introduced for a proxy that acts as OSCORE endpoint. That is, for each CoAP option OPT included in an outgoing message M that the proxy protects with OSCORE, the proxy has to be able to recognize OPT and thus be aware of the original Class of OPT for OSCORE.<a href="#section-2.2-7" class="pilcrow">Â¶</a></p>
<p id="section-2.2-8">If a proxy that acts as OSCORE endpoint does not recognize a CoAP option included in M, then the proxy <span class="bcp14">MUST</span> stop processing M and performs the following actions.<a href="#section-2.2-8" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2-9.1">
            <p id="section-2.2-9.1.1">If M is a request, then the proxy <span class="bcp14">MUST</span> respond with a 4.02 (Bad Option) error response to (the previous hop towards) the origin client.<a href="#section-2.2-9.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-2.2-9.2">
            <p id="section-2.2-9.2.1">If M is a response, then the proxy <span class="bcp14">MUST</span> send a 5.02 (Bad Gateway) error response to (the previous hop towards) the origin client.<a href="#section-2.2-9.2.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<p id="section-2.2-10">In either case, this may result in protecting the error response over that communication leg, as per <a href="#outgoing-responses" class="auto internal xref">Section 2.5</a>.<a href="#section-2.2-10" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="outgoing-requests">
<section id="section-2.3">
        <h3 id="name-processing-of-an-outgoing-r">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-processing-of-an-outgoing-r" class="section-name selfRef">Processing of an Outgoing Request</a>
        </h3>
<p id="section-2.3-1">The rules from <a href="#general-rules" class="auto internal xref">Section 2.2</a> apply when processing an outgoing request message, with the following additions.<a href="#section-2.3-1" class="pilcrow">Â¶</a></p>
<p id="section-2.3-2">When a source application endpoint applies multiple OSCORE layers in sequence to protect an outgoing request and it uses an OSCORE Security Context shared with the other application endpoint, then the first OSCORE layer <span class="bcp14">MUST</span> be applied by using that Security Context.<a href="#section-2.3-2" class="pilcrow">Â¶</a></p>
<p id="section-2.3-3">After that, the source application endpoint further protects the outgoing request, by applying one OSCORE layer for each intermediary with which it shares an OSCORE Security Context. When doing so, the source application endpoint applies those OSCORE layers in the same order according to which those intermediaries are positioned in the chain, starting from the one closest to the other application endpoint and moving backwards towards the one closest to the source application endpoint.<a href="#section-2.3-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="incoming-requests">
<section id="section-2.4">
        <h3 id="name-processing-of-an-incoming-r">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-processing-of-an-incoming-r" class="section-name selfRef">Processing of an Incoming Request</a>
        </h3>
<p id="section-2.4-1">Upon receiving a request REQ, the recipient endpoint performs the actions described in the following steps. <a href="#sec-incoming-req-diag" class="auto internal xref">Appendix D</a> provides an overview of these steps through a state diagram.<a href="#section-2.4-1" class="pilcrow">Â¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.4-2">
<li id="section-2.4-2.1">
            <p id="section-2.4-2.1.1">If REQ includes proxy-related options, the endpoint moves to Step 2. Otherwise, the endpoint moves to Step 3.<a href="#section-2.4-2.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li id="section-2.4-2.2">
            <p id="section-2.4-2.2.1">The endpoint proceeds as defined below, depending on which of the two following conditions holds.<a href="#section-2.4-2.2.1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.4-2.2.2.1">
                <p id="section-2.4-2.2.2.1.1">REQ includes either of the following (set) of CoAP options: the Proxy-Uri option; the Proxy-Cri option; the Proxy-Scheme option or the Proxy-Scheme-Number option, together with any of the Uri-* options.<a href="#section-2.4-2.2.2.1.1" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.2.2.1.2">
If the endpoint is not configured to be a forward-proxy, it <span class="bcp14">MUST</span> stop processing the request and <span class="bcp14">MUST</span> respond with a 5.05 (Proxying Not Supported) error response to (the previous hop towards) the origin client, as per <span><a href="https://rfc-editor.org/rfc/rfc7252#section-5.10.2" class="relref">Section 5.10.2</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>. This may result in protecting the error response over that communication leg, as per <a href="#outgoing-responses" class="auto internal xref">Section 2.5</a>.<a href="#section-2.4-2.2.2.1.2" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.2.2.1.3">
Otherwise, the endpoint <span class="bcp14">MUST</span> check whether forwarding this request to (the next hop towards) the origin server is an acceptable operation to perform, according to the endpoint's configuration and a possible authorization enforcement. This check can be based, for instance, on the specific OSCORE Security Context that the endpoint used to decrypt the incoming message before performing this step.<a href="#section-2.4-2.2.2.1.3" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.2.2.1.4">
In case the check fails, the endpoint <span class="bcp14">MUST</span> stop processing the request and <span class="bcp14">MUST</span> respond with a 4.01 (Unauthorized) error response to (the previous hop towards) the origin client, as per <span><a href="https://rfc-editor.org/rfc/rfc7252#section-5.10.2" class="relref">Section 5.10.2</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>. This may result in protecting the error response over that communication leg, as per <a href="#outgoing-responses" class="auto internal xref">Section 2.5</a>.<a href="#section-2.4-2.2.2.1.4" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.2.2.1.5">
Instead, in case the check succeeds, the endpoint consumes the proxy-related options as per <span><a href="https://rfc-editor.org/rfc/rfc7252#section-5.7.2" class="relref">Section 5.7.2</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>. In particular, the endpoint checks whether the authority (host and port) of the request URI identifies the endpoint itself. In such a case, the endpoint moves to Step 1.<a href="#section-2.4-2.2.2.1.5" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.2.2.1.6">
Otherwise, the endpoint forwards REQ to (the next hop towards) the origin server according to the request URI, unless differently indicated in REQ, e.g., by means of any of its CoAP options. For instance, a forward-proxy does not forward a request that includes proxy-related options together with the Listen-To-Multicast-Notifications option (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-observe-multicast-notifications-12#section-12" class="relref">Section 12</a> of [<a href="#I-D.ietf-core-observe-multicast-notifications" class="cite xref">I-D.ietf-core-observe-multicast-notifications</a>]</span>).<a href="#section-2.4-2.2.2.1.6" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.2.2.1.7">
If the endpoint forwards REQ to (the next hop towards) the origin server, this may result in (further) protecting REQ over that communication leg, as per <a href="#outgoing-requests" class="auto internal xref">Section 2.3</a>.<a href="#section-2.4-2.2.2.1.7" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.2.2.1.8">
After that, the endpoint does not take any further action.<a href="#section-2.4-2.2.2.1.8" class="pilcrow">Â¶</a></p>
</li>
              <li class="normal" id="section-2.4-2.2.2.2">
                <p id="section-2.4-2.2.2.2.1">REQ does not include the Proxy-Scheme option or the Proxy-Scheme-Number option, but it includes one or more Uri-Path options, and/or the Uri-Host option, and/or the Uri-Port option.<a href="#section-2.4-2.2.2.2.1" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.2.2.2.2">
If the endpoint is not configured to be a reverse-proxy, or what is targeted by the value of the Uri-Path, Uri-Host, and Uri-Port options is not intended to support reverse-proxy functionalities, then the endpoint moves to Step 3.<a href="#section-2.4-2.2.2.2.2" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.2.2.2.3">
Otherwise, the endpoint <span class="bcp14">MUST</span> check whether forwarding this request to (the next hop towards) the origin server is an acceptable operation to perform, according to the endpoint's configuration and a possible authorization enforcement. This check can be based, for instance, on the specific OSCORE Security Context that the endpoint used to decrypt the incoming message before performing this step.<a href="#section-2.4-2.2.2.2.3" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.2.2.2.4">
In case the check fails, the endpoint <span class="bcp14">MUST</span> stop processing the request and <span class="bcp14">MUST</span> respond with a 4.01 (Unauthorized) error response to (the previous hop towards) the origin client, as per <span><a href="https://rfc-editor.org/rfc/rfc7252#section-5.10.2" class="relref">Section 5.10.2</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>. This may result in protecting the error response over that communication leg, as per <a href="#outgoing-responses" class="auto internal xref">Section 2.5</a>.<a href="#section-2.4-2.2.2.2.4" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.2.2.2.5">
Otherwise, the endpoint consumes the present Uri-Path, Uri-Host, and Uri-Port options, and forwards REQ to (the next hop towards) the origin server, unless differently indicated in REQ, e.g., by means of any of its CoAP options.<a href="#section-2.4-2.2.2.2.5" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.2.2.2.6">
If the endpoint forwards REQ to (the next hop towards) the origin server, this may result in (further) protecting REQ over that communication leg, as per <a href="#outgoing-requests" class="auto internal xref">Section 2.3</a>.<a href="#section-2.4-2.2.2.2.6" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.2.2.2.7">
After that, the endpoint does not take any further action.<a href="#section-2.4-2.2.2.2.7" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.2.2.2.8">
Note that, when forwarding REQ, the endpoint might not remove all the Uri-Path options originally present, e.g., in case the next hop towards the origin server is a reverse-proxy.<a href="#section-2.4-2.2.2.2.8" class="pilcrow">Â¶</a></p>
</li>
            </ul>
</li>
          <li id="section-2.4-2.3">
            <p id="section-2.4-2.3.1">The endpoint proceeds as defined below, depending on which of the two following conditions holds.<a href="#section-2.4-2.3.1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.4-2.3.2.1">
                <p id="section-2.4-2.3.2.1.1">REQ does not include an OSCORE option.<a href="#section-2.4-2.3.2.1.1" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.3.2.1.2">
If the endpoint does not have an application to handle REQ, it <span class="bcp14">MUST</span> stop processing the request and <span class="bcp14">MAY</span> respond with a 4.00 (Bad Request) error response to (the previous hop towards) the origin client. This may result in protecting the error response over that communication leg, as per <a href="#outgoing-responses" class="auto internal xref">Section 2.5</a>.<a href="#section-2.4-2.3.2.1.2" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.3.2.1.3">
Otherwise, the endpoint delivers REQ to the application.<a href="#section-2.4-2.3.2.1.3" class="pilcrow">Â¶</a></p>
</li>
              <li class="normal" id="section-2.4-2.3.2.2">
                <p id="section-2.4-2.3.2.2.1">REQ includes an OSCORE option.<a href="#section-2.4-2.3.2.2.1" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.3.2.2.2">
If REQ includes any Uri-Path options, the endpoint <span class="bcp14">MUST</span> stop processing the request and <span class="bcp14">MAY</span> respond with a 4.00 (Bad Request) error response to (the previous hop towards) the origin client. This may result in protecting the error response over that communication leg, as per <a href="#outgoing-responses" class="auto internal xref">Section 2.5</a>.<a href="#section-2.4-2.3.2.2.2" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.3.2.2.3">
Otherwise, the endpoint <span class="bcp14">MUST</span> check whether decrypting the request is an acceptable operation to perform, according to the endpoint's configuration and a possible authorization enforcement, and in view of the (previous hop towards the) origin client being the alleged request sender. This check can be based, for instance, on considering the source addressing information of the request and then asserting whether the OSCORE Security Context indicated by the OSCORE option is not only available to use, but also present in a local list of OSCORE Security Contexts that are usable to decrypt a request from the alleged request sender.<a href="#section-2.4-2.3.2.2.3" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.3.2.2.4">
In case the check fails, the endpoint <span class="bcp14">MUST</span> stop processing the request and <span class="bcp14">MUST</span> respond with a 4.01 (Unauthorized) error response to (the previous hop towards) the origin client, as per <span><a href="https://rfc-editor.org/rfc/rfc7252#section-5.10.2" class="relref">Section 5.10.2</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>. This may result in protecting the error response over that communication leg, as per <a href="#outgoing-responses" class="auto internal xref">Section 2.5</a>.<a href="#section-2.4-2.3.2.2.4" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.3.2.2.5">
Instead, in case the check succeeds, the endpoint decrypts REQ using the OSCORE Security Context indicated by the OSCORE option, which results in the decrypted request REQ*. The possible presence of an OSCORE option in REQ* is not treated as an error situation.<a href="#section-2.4-2.3.2.2.5" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.3.2.2.6">
If the OSCORE processing results in an error, the endpoint <span class="bcp14">MUST</span> stop processing the request and performs error handling as per <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8.2" class="relref">Section 8.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> or Sections <a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-groupcomm-26#section-7.2" class="relref">7.2</a> and <a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-groupcomm-26#section-8.4" class="relref">8.4</a> of <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>, in case OSCORE or Group OSCORE is used, respectively. In case the endpoint sends an error response to (the previous hop towards) the origin client, this may result in protecting the error response over that communication leg, as per <a href="#outgoing-responses" class="auto internal xref">Section 2.5</a>.<a href="#section-2.4-2.3.2.2.6" class="pilcrow">Â¶</a></p>
<p id="section-2.4-2.3.2.2.7">
Otherwise, REQ takes REQ* and the endpoint moves to Step 1.<a href="#section-2.4-2.3.2.2.7" class="pilcrow">Â¶</a></p>
</li>
            </ul>
</li>
        </ol>
</section>
</div>
<div id="outgoing-responses">
<section id="section-2.5">
        <h3 id="name-processing-of-an-outgoing-re">
<a href="#section-2.5" class="section-number selfRef">2.5. </a><a href="#name-processing-of-an-outgoing-re" class="section-name selfRef">Processing of an Outgoing Response</a>
        </h3>
<p id="section-2.5-1">The rules from <a href="#general-rules" class="auto internal xref">Section 2.2</a> apply when processing an outgoing response message, with the following additions.<a href="#section-2.5-1" class="pilcrow">Â¶</a></p>
<p id="section-2.5-2">When a source application endpoint applies multiple OSCORE layers in sequence to protect an outgoing response and it uses an OSCORE Security Context shared with the other application endpoint, then the first OSCORE layer <span class="bcp14">MUST</span> be applied by using that Security Context.<a href="#section-2.5-2" class="pilcrow">Â¶</a></p>
<p id="section-2.5-3">The sender endpoint protects the response by applying the same OSCORE layers that it removed from the corresponding incoming request, but in the reverse order than the one according to which they were removed.<a href="#section-2.5-3" class="pilcrow">Â¶</a></p>
<p id="section-2.5-4">In case the response is an error response, the sender endpoint protects it by applying the same OSCORE layers that it successfully removed from the corresponding incoming request, but in the reverse order than the one according to which they were removed.<a href="#section-2.5-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="incoming-responses">
<section id="section-2.6">
        <h3 id="name-processing-of-an-incoming-re">
<a href="#section-2.6" class="section-number selfRef">2.6. </a><a href="#name-processing-of-an-incoming-re" class="section-name selfRef">Processing of an Incoming Response</a>
        </h3>
<p id="section-2.6-1">The recipient endpoint removes the same OSCORE layers that it added when protecting the corresponding outgoing request, but in the reverse order than the one according to which they were added.<a href="#section-2.6-1" class="pilcrow">Â¶</a></p>
<p id="section-2.6-2">When doing so, the possible presence of an OSCORE option in the decrypted response following the removal of an OSCORE layer is not treated as an error situation, unless it occurs after having removed as many OSCORE layers as were added in the corresponding outgoing request. In such a case, the endpoint <span class="bcp14">MUST</span> stop processing the response.<a href="#section-2.6-2" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-hop-limit">
<section id="section-3">
      <h2 id="name-oscore-processing-of-the-ho">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-oscore-processing-of-the-ho" class="section-name selfRef">OSCORE Processing of the Hop-Limit Option</a>
      </h2>
<p id="section-3-1">The CoAP option Hop-Limit is defined in <span>[<a href="#RFC8768" class="cite xref">RFC8768</a>]</span> and can be used to detect forwarding loops through a chain of proxies. The first proxy in the chain that understands the option can include it in a received request (if not present already), then sets a proper integer value specifying the desired maximum number of hops, and finally forward the request to the next hop. Any following proxy that understands the option decrements the option value and forwards the request if the new value is different from zero, or returns a 5.08 (Hop Limit Reached) error response otherwise.<a href="#section-3-1" class="pilcrow">Â¶</a></p>
<p id="section-3-2"><span>[<a href="#RFC8768" class="cite xref">RFC8768</a>]</span> does not define how the Hop-Limit option is processed by OSCORE. As a consequence, the default behavior specified in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-4.1" class="relref">Section 4.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> applies, i.e., the Hop-Limit option has to be processed as Class E for OSCORE.<a href="#section-3-2" class="pilcrow">Â¶</a></p>
<p id="section-3-3">However, this results in additionally and unjustifiably increasing the size of OSCORE-protected CoAP messages, in case the origin client is the first endpoint to add the Hop-Limit option in a CoAP request. In the typical scenario where the origin client and the origin server share an OSCORE Security Context, the origin client including the Hop-Limit option in a request will also protect that option when protecting the request end-to-end for the origin server, per the default processing mentioned above. After that, the origin client sends the request to its adjacent proxy in the chain, which will add an outer Hop-Limit option to be effectively considered from then on as the message is forwarded towards the origin server.<a href="#section-3-3" class="pilcrow">Â¶</a></p>
<p id="section-3-4">This undesirably prevents the first proxy in the chain from enforcing the intent of the origin client, which was presumably in the position to specify a better initial value for the Hop-Limit option. While this does not fundamentally prevent the detection of forwarding loops, it is conducive to deviations from the intention of the origin client. Moreover, it results in undesired overhead due to the presence of the inner Hop-Limit option included by the client. That inner option will not be visible by the proxies in the chain and therefore will serve no practical purpose, but it will still be conveyed within the request as this traverses each hop towards the origin server.<a href="#section-3-4" class="pilcrow">Â¶</a></p>
<p id="section-3-5">In order to prevent that by construction, this section updates <span>[<a href="#RFC8768" class="cite xref">RFC8768</a>]</span> by explicitly defining the Hop-Limit option to be of Class U for OSCORE.<a href="#section-3-5" class="pilcrow">Â¶</a></p>
<p id="section-3-6">Therefore, with reference to the scenario discussed above, the origin client does not protect the Hop-Limit option when protecting the request end-to-end for the origin server, thus allowing the first proxy in the chain to see and process the Hop-Limit option as expected.<a href="#section-3-6" class="pilcrow">Â¶</a></p>
<p id="section-3-7">When OSCORE is used at proxies like it is defined in this document, the process defined in <a href="#general-rules" class="auto internal xref">Section 2.2</a> seamlessly applies also to the Hop-Limit option. Therefore, in a scenario where the origin client also shares an OSCORE Security Context with the first proxy in the chain, the origin client does not protect the Hop-Limit option end-to-end for the origin server, but it does protect the option when protecting the request for that proxy by means of their shared OSCORE Security Context.<a href="#section-3-7" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="sec-response-caching">
<section id="section-4">
      <h2 id="name-caching-of-oscore-protected">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-caching-of-oscore-protected" class="section-name selfRef">Caching of OSCORE-Protected Responses</a>
      </h2>
<p id="section-4-1">Although it is not possible as per the original OSCORE specification <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, effective cacheability of OSCORE-protected responses at proxies can be achieved. To this end, the approach defined in <span>[<a href="#I-D.amsuess-core-cachable-oscore" class="cite xref">I-D.amsuess-core-cachable-oscore</a>]</span> can be used, as based on Deterministic Requests protected with the pairwise mode of Group OSCORE <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span> used end-to-end between an origin client and an origin server. The applicability of this approach is limited to requests that are safe to process (in the REST sense) and that do not yield side effects at the origin server.<a href="#section-4-1" class="pilcrow">Â¶</a></p>
<p id="section-4-2">In particular, this approach requires both the origin client and the origin server to have already joined the correct OSCORE group. Then, starting from the same plain CoAP request, different clients in the OSCORE group are able to deterministically generate a same Deterministic Request protected with Group OSCORE, which is sent to a proxy for being forwarded to the origin server. The proxy can effectively cache the resulting OSCORE-protected response from the server, since the same plain CoAP request will result again in the same Deterministic Request and thus will produce a cache hit at the proxy.<a href="#section-4-2" class="pilcrow">Â¶</a></p>
<p id="section-4-3">When using this approach, the following also applies in addition to what is defined in <a href="#incoming-requests" class="auto internal xref">Section 2.4</a> and <a href="#incoming-responses" class="auto internal xref">Section 2.6</a>, when processing incoming messages at a proxy that implements caching of responses.<a href="#section-4-3" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-4.1">
          <p id="section-4-4.1.1">Upon receiving a request from (the previous hop towards) the origin client, the proxy checks if specifically the message available during the execution of Step 2 in <a href="#incoming-requests" class="auto internal xref">Section 2.4</a> produces a cache hit.<a href="#section-4-4.1.1" class="pilcrow">Â¶</a></p>
<p id="section-4-4.1.2">
That is, such a message: i) is exactly the one to be forwarded to (the next hop towards) the origin server, in case no cache hit occurs; and ii) is the result of an OSCORE decryption at the proxy, in case OSCORE is used on the communication leg between the proxy and (the previous hop towards) the origin client.<a href="#section-4-4.1.2" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-4-4.2">
          <p id="section-4-4.2.1">Upon receiving a response from (the next hop towards) the origin server, the proxy first removes the same OSCORE layers that it added when protecting the corresponding outgoing request, as defined in <a href="#incoming-responses" class="auto internal xref">Section 2.6</a>.<a href="#section-4-4.2.1" class="pilcrow">Â¶</a></p>
<p id="section-4-4.2.2">
Then, the proxy stores specifically that resulting response message in its cache. That is, such a stored message is exactly the one to be forwarded to (the previous hop towards) the origin client.<a href="#section-4-4.2.2" class="pilcrow">Â¶</a></p>
</li>
      </ul>
<p id="section-4-5">The specific rules about serving a request with a cached response are defined in <span><a href="https://rfc-editor.org/rfc/rfc7252#section-5.6" class="relref">Section 5.6</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> as well as in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-proxy-04#section-7" class="relref">Section 7</a> of [<a href="#I-D.ietf-core-groupcomm-proxy" class="cite xref">I-D.ietf-core-groupcomm-proxy</a>]</span> for group communication scenarios.<a href="#section-4-5" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="establishment-of-oscore-security-contexts">
<section id="section-5">
      <h2 id="name-establishment-of-oscore-sec">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-establishment-of-oscore-sec" class="section-name selfRef">Establishment of OSCORE Security Contexts</a>
      </h2>
<p id="section-5-1">Like the original OSCORE specification <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, this document is not devoted to any particular approach that two OSCORE endpoints use for establishing an OSCORE Security Context.<a href="#section-5-1" class="pilcrow">Â¶</a></p>
<p id="section-5-2">At the same time, the following applies, depending on the two peers using OSCORE or Group OSCORE <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span> to protect their communications.<a href="#section-5-2" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-3.1">
          <p id="section-5-3.1.1">When using OSCORE, the establishment of the OSCORE Security Context can rely on the authenticated key exchange protocol Ephemeral Diffie-Hellman Over COSE (EDHOC) <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>.<a href="#section-5-3.1.1" class="pilcrow">Â¶</a></p>
<p id="section-5-3.1.2">
Assuming that OSCORE has to be used between the two origin application endpoints as well as between the origin client and the first proxy in the chain, it is expected that the origin client first runs EDHOC with the first proxy in the chain and then with the origin server through the chain of proxies (see the example in <a href="#sec-example-edhoc" class="auto internal xref">Appendix B.4</a>).<a href="#section-5-3.1.2" class="pilcrow">Â¶</a></p>
<p id="section-5-3.1.3">
Furthermore, the additional use of the combined EDHOC + OSCORE request defined in <span>[<a href="#RFC9668" class="cite xref">RFC9668</a>]</span> is particularly beneficial in this case (see the example in <a href="#sec-example-edhoc-comb-req" class="auto internal xref">Appendix B.5</a>) and especially when relying on a long chain of proxies.<a href="#section-5-3.1.3" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-5-3.2">
          <p id="section-5-3.2.1">The use of Group OSCORE is expected to be limited between the origin application endpoints, e.g., between the origin client and multiple origin servers. In order to join the same OSCORE group and obtain the corresponding Group OSCORE Security Context, those endpoints can use the approach defined in <span>[<a href="#I-D.ietf-ace-key-groupcomm-oscore" class="cite xref">I-D.ietf-ace-key-groupcomm-oscore</a>]</span> and based on the ACE framework for Authentication and Authorization in constrained environments <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>.<a href="#section-5-3.2.1" class="pilcrow">Â¶</a></p>
<p id="section-5-3.2.2">
For the purposes of this document, there is no need for a proxy to also be a member of the OSCORE group whose Group OSCORE Security Context is used by the origin application endpoints for protecting communications end-to-end.<a href="#section-5-3.2.2" class="pilcrow">Â¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="coap-header-compression-with-schc">
<section id="section-6">
      <h2 id="name-coap-header-compression-wit">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-coap-header-compression-wit" class="section-name selfRef">CoAP Header Compression with SCHC</a>
      </h2>
<p id="section-6-1">The method defined in this document enables and results in the possible protection of the same CoAP message with multiple, nested OSCORE layers. Especially when this happens, it is desirable to compress the header of protected CoAP messages, in order to improve performance and ensure that CoAP is usable also in Low-Power Wide-Area Networks (LPWANs).<a href="#section-6-1" class="pilcrow">Â¶</a></p>
<p id="section-6-2">To this end, it is possible to use the Static Context Header Compression and fragmentation (SCHC) framework <span>[<a href="#RFC8724" class="cite xref">RFC8724</a>]</span>. In particular, <span>[<a href="#I-D.ietf-schc-8824-update" class="cite xref">I-D.ietf-schc-8824-update</a>]</span> specifies how to use SCHC for compressing headers of CoAP messages, also when messages are protected with OSCORE. The SCHC Compression/Decompression is applicable also in the presence of CoAP proxies and especially to the two following cases.<a href="#section-6-2" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-3.1">
          <p id="section-6-3.1.1">In case OSCORE is not used at all, the SCHC processing occurs hop-by-hop, by relying on SCHC Rules that are consistently shared between two adjacent hops.<a href="#section-6-3.1.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-6-3.2">
          <p id="section-6-3.2.1">In case OSCORE is used only end-to-end between the application endpoints, then an Inner SCHC Compression/Decompression and an Outer SCHC Compression/Decompression are performed (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-schc-8824-update-05#section-8.2" class="relref">Section 8.2</a> of [<a href="#I-D.ietf-schc-8824-update" class="cite xref">I-D.ietf-schc-8824-update</a>]</span>). In particular, the following holds.<a href="#section-6-3.2.1" class="pilcrow">Â¶</a></p>
<p id="section-6-3.2.2">
The SCHC processing occurs end-to-end as to the Inner SCHC Compression/Decompression. This relies on Inner SCHC Rules that are shared between the two application endpoints, which act as OSCORE endpoints and share the OSCORE Security Context used.<a href="#section-6-3.2.2" class="pilcrow">Â¶</a></p>
<p id="section-6-3.2.3">
The SCHC processing occurs hop-by-hop as to the Outer SCHC Compression/Decompression. This relies on Outer SCHC Rules that are shared between two adjacent hops.<a href="#section-6-3.2.3" class="pilcrow">Â¶</a></p>
</li>
      </ul>
<p id="section-6-4">When using the method defined in this document, thus enabling also an intermediary proxy to be an OSCORE endpoint, the SCHC processing above is generalized as specified below.<a href="#section-6-4" class="pilcrow">Â¶</a></p>
<p id="section-6-5">When processing an outgoing CoAP message, a sender endpoint proceeds as follows.<a href="#section-6-5" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-6.1">
          <p id="section-6-6.1.1">The sender endpoint performs one Inner SCHC Compression for each OSCORE layer applied to the outgoing message.<a href="#section-6-6.1.1" class="pilcrow">Â¶</a></p>
<p id="section-6-6.1.2">
Each Inner SCHC Compression occurs before protecting the message with that OSCORE layer and relies on the SCHC Rules that are shared with the other OSCORE endpoint.<a href="#section-6-6.1.2" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-6-6.2">
          <p id="section-6-6.2.1">The sender endpoint performs exactly one Outer SCHC Compression.<a href="#section-6-6.2.1" class="pilcrow">Â¶</a></p>
<p id="section-6-6.2.2">
This occurs after having performed all the intended OSCORE protections of the outgoing message and relies on the SCHC Rules that are shared with the (next hop towards the) destination application endpoint.<a href="#section-6-6.2.2" class="pilcrow">Â¶</a></p>
</li>
      </ul>
<p id="section-6-7">That is, with respect to the SCHC Compression/Decompression processing, the following holds.<a href="#section-6-7" class="pilcrow">Â¶</a></p>
<p id="section-6-8">An Inner SCHC Compression is intended for a destination OSCORE endpoint, which performs the following steps.<a href="#section-6-8" class="pilcrow">Â¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-9">
<li id="section-6-9.1">
          <p id="section-6-9.1.1">It decrypts an incoming message with the OSCORE Security Context shared with the other OSCORE endpoint.<a href="#section-6-9.1.1" class="pilcrow">Â¶</a></p>
</li>
        <li id="section-6-9.2">
          <p id="section-6-9.2.1">It performs the corresponding Inner SCHC Decompression, by relying on the SCHC Rules shared with the other OSCORE endpoint.<a href="#section-6-9.2.1" class="pilcrow">Â¶</a></p>
</li>
      </ol>
<p id="section-6-10">An Outer SCHC Compression is intended for the (next hop towards the) destination application endpoint, which performs the following steps.<a href="#section-6-10" class="pilcrow">Â¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-11">
<li id="section-6-11.1">
          <p id="section-6-11.1.1">It performs a corresponding Outer SCHC Decompression on an incoming message, by relying on the SCHC Rules shared with the previous hop towards the destination application endpoint.<a href="#section-6-11.1.1" class="pilcrow">Â¶</a></p>
</li>
        <li id="section-6-11.2">
          <p id="section-6-11.2.1">Unless it is exactly the destination application endpoint, it performs a new Outer SCHC Compression on the result from the previous step, by relying on the SCHC Rules shared with the (next hop towards the) destination application endpoint. Then, it sends the result to the (next-hop towards the) destination application endpoint.<a href="#section-6-11.2.1" class="pilcrow">Â¶</a></p>
</li>
      </ol>
<p id="section-6-12">Note that the generalization above does not alter the core approach, design choices, and features of the SCHC Compression/Decompression applied to CoAP headers.<a href="#section-6-12" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">The same security considerations about CoAP <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> and group communication for CoAP <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span> apply to this document. The same security considerations from <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> and <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span> apply to this document, when using OSCORE or Group OSCORE to protect exchanged messages.<a href="#section-7-1" class="pilcrow">Â¶</a></p>
<p id="section-7-2">Further security considerations to take into account are inherited from the specific CoAP options, extensions, and methods that are used when relying on OSCORE or Group OSCORE.<a href="#section-7-2" class="pilcrow">Â¶</a></p>
<p id="section-7-3">This document does not change the security properties of OSCORE and Group OSCORE. That is, given any two OSCORE endpoints, the method defined in this document provides them with the same security guarantees that OSCORE and Group OSCORE provide in the case where such endpoints are specifically application endpoints.<a href="#section-7-3" class="pilcrow">Â¶</a></p>
<p id="section-7-4">If Group OSCORE is used over a communication leg and the group mode is used to apply a protection layer to a message over that leg (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-groupcomm-26#section-7" class="relref">Section 7</a> of [<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>), then all the members of the OSCORE group that support the group mode are able to remove that protection layer, i.e., to accordingly decrypt and verify the message. Therefore, the OSCORE group should only include OSCORE endpoints for which that is acceptable.<a href="#section-7-4" class="pilcrow">Â¶</a></p>
<div id="preserving-location-anonymity">
<section id="section-7.1">
        <h3 id="name-preserving-location-anonymi">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-preserving-location-anonymi" class="section-name selfRef">Preserving Location Anonymity</a>
        </h3>
<p id="section-7.1-1">Before decrypting an incoming request (see Step 3 in <a href="#incoming-requests" class="auto internal xref">Section 2.4</a>), the recipient endpoint checks whether decrypting the request is an acceptable operation to perform. The performed check is in accordance with the endpoint's configuration and a possible authorization enforcement as well as in the light of the alleged request sender and the OSCORE Security Context to use.<a href="#section-7.1-1" class="pilcrow">Â¶</a></p>
<p id="section-7.1-2">This is particularly relevant for an origin server that expects to receive messages protected end-to-end by origin clients, but only if sent by a reverse-proxy as its adjacent hop.<a href="#section-7.1-2" class="pilcrow">Â¶</a></p>
<p id="section-7.1-3">In such a setup, that check prevents a malicious sender endpoint C from associating the addressing information of the origin server S with the OSCORE Security Context CTX that C and S are sharing. Making such an association would compromise the location anonymity of the origin server, as otherwise afforded by the reverse-proxy.<a href="#section-7.1-3" class="pilcrow">Â¶</a></p>
<p id="section-7.1-4">That is, if C gains knowledge of some addressing information ADDR, then C might send a request directly addressed to ADDR and protected with CTX. A response protected with CTX would prove that ADDR is in fact the addressing information of S.<a href="#section-7.1-4" class="pilcrow">Â¶</a></p>
<p id="section-7.1-5">However, after performing and failing the check on the received request, S replies with a 4.01 (Unauthorized) error response that is not protected with CTX, hence preserving the location anonymity of the origin server.<a href="#section-7.1-5" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="sec-security-considerations-hop-limit">
<section id="section-7.2">
        <h3 id="name-hop-limit-option">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-hop-limit-option" class="section-name selfRef">Hop-Limit Option</a>
        </h3>
<p id="section-7.2-1"><a href="#sec-hop-limit" class="auto internal xref">Section 3</a> of this document defines that the Hop-Limit option <span>[<a href="#RFC8768" class="cite xref">RFC8768</a>]</span> is of Class U for OSCORE. This overrides the default behavior specified in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-4.1" class="relref">Section 4.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, according to which the option would be processed as Class E for OSCORE.<a href="#section-7.2-1" class="pilcrow">Â¶</a></p>
<p id="section-7.2-2">As discussed in <a href="#sec-hop-limit" class="auto internal xref">Section 3</a>, applying the default behavior would result in the Hop-Limit option added by the origin client being protected end-to-end for the origin server. That is, the intention of the client about performing a detection of forwarding loops would be hidden even from the first proxy in chain, which in turn adds an outer Hop-Limit option and thus further contributes to increasing the message size (see <a href="#sec-hop-limit" class="auto internal xref">Section 3</a>).<a href="#section-7.2-2" class="pilcrow">Â¶</a></p>
<p id="section-7.2-3">Instead, having defined the Hop-Limit option as Class U for OSCORE, the following holds by virtue of the procedure defined in <a href="#general-rules" class="auto internal xref">Section 2.2</a>.<a href="#section-7.2-3" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2-4.1">
            <p id="section-7.2-4.1.1">If the origin client and the origin server share an OSCORE Security Context, the client protects the option end-to-end for the server only when sending a request to the server directly (i.e., not via a proxy).<a href="#section-7.2-4.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-7.2-4.2">
            <p id="section-7.2-4.2.1">If the origin client and the first proxy in the chain share an OSCORE Security Context, then the client protects the option for the proxy, while also avoiding the downsides resulting from the default behavior mentioned above.<a href="#section-7.2-4.2.1" class="pilcrow">Â¶</a></p>
<p id="section-7.2-4.2.2">
Otherwise, unless the communication leg between the origin client and the first proxy in the chain relies on another secure association (e.g., a DTLS connection), the Hop-Limit option included in a request sent to the proxy will be unprotected.<a href="#section-7.2-4.2.2" class="pilcrow">Â¶</a></p>
<p id="section-7.2-4.2.3">
Fundamentally, this is not worse then when applying the default behavior mentioned above. In that case, the origin client would not be able to provide the proxy with its intention as to detecting forwarding loops, while an active on-path adversary would be able to tamper with the request and add an outer Hop-Limit option with a fraudulent value for the proxy to use.<a href="#section-7.2-4.2.3" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<p id="section-7.2-5">More generally, if any two adjacent hops share an OSCORE Security Context, then the Hop-Limit option will be protected with OSCORE in the communication leg between those two hops.<a href="#section-7.2-5" class="pilcrow">Â¶</a></p>
<p id="section-7.2-6">If the Hop-Limit option is transported unprotected over the communication leg between two hops, then the following applies.<a href="#section-7.2-6" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2-7.1">
            <p id="section-7.2-7.1.1">A passive on-path adversary can read the option value. By possibly relying on other information such as the option value read in other communication legs, the adversary might be able to infer the topology of the network and the path used for delivering requests from the origin client.<a href="#section-7.2-7.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-7.2-7.2">
            <p id="section-7.2-7.2.1">An active on-path adversary can add or remove the option, or alter its value. Adding the option allows the adversary to trigger an otherwise undesired process for detecting forwarding loops, e.g., as an attempt to probe the topology of the network. Removing the option results in undetectably interrupting the ongoing process for detecting forwarding loops, while altering the option value undetectably interferes with the natural unfolding of such an ongoing process.<a href="#section-7.2-7.2.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-8-1">This document has the following actions for IANA.<a href="#section-8-1" class="pilcrow">Â¶</a></p>
<div id="iana-coap-options">
<section id="section-8.1">
        <h3 id="name-coap-option-numbers-registr">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-coap-option-numbers-registr" class="section-name selfRef">CoAP Option Numbers Registry</a>
        </h3>
<p id="section-8.1-1">IANA is asked to add this document as an additional reference for the Hop-Limit option in the "CoAP Option Numbers" registry within the "Constrained RESTful Environments (CoRE) Parameters" registry group.<a href="#section-8.1-1" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-core-href">[I-D.ietf-core-href]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">H. Birkholz</span>, <span class="refTitle">"Constrained Resource Identifiers"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-href-24</span>, <time datetime="2025-08-30" class="refDate">30 August 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-href-24">https://datatracker.ietf.org/doc/html/draft-ietf-core-href-24</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-oscore-groupcomm">[I-D.ietf-core-oscore-groupcomm]</dt>
        <dd>
<span class="refAuthor">Tiloca, M.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Palombini, F.</span>, <span class="refAuthor">Mattsson, J. P.</span>, and <span class="refAuthor">R. HÃ¶glund</span>, <span class="refTitle">"Group Object Security for Constrained RESTful Environments (Group OSCORE)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-oscore-groupcomm-26</span>, <time datetime="2025-07-05" class="refDate">5 July 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-groupcomm-26">https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-groupcomm-26</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-schc-8824-update">[I-D.ietf-schc-8824-update]</dt>
        <dd>
<span class="refAuthor">Tiloca, M.</span>, <span class="refAuthor">Toutain, L.</span>, <span class="refAuthor">MartÃ­nez, I.</span>, and <span class="refAuthor">A. Minaburo</span>, <span class="refTitle">"Static Context Header Compression (SCHC) for the Constrained Application Protocol (CoAP)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-schc-8824-update-05</span>, <time datetime="2025-07-07" class="refDate">7 July 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-schc-8824-update-05">https://datatracker.ietf.org/doc/html/draft-ietf-schc-8824-update-05</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7252">[RFC7252]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refAuthor">Hartke, K.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7252">https://www.rfc-editor.org/rfc/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8613">[RFC8613]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J.</span>, <span class="refAuthor">Palombini, F.</span>, and <span class="refAuthor">L. Seitz</span>, <span class="refTitle">"Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 8613</span>, <span class="seriesInfo">DOI 10.17487/RFC8613</span>, <time datetime="2019-07" class="refDate">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8613">https://www.rfc-editor.org/rfc/rfc8613</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8724">[RFC8724]</dt>
        <dd>
<span class="refAuthor">Minaburo, A.</span>, <span class="refAuthor">Toutain, L.</span>, <span class="refAuthor">Gomez, C.</span>, <span class="refAuthor">Barthel, D.</span>, and <span class="refAuthor">JC. Zuniga</span>, <span class="refTitle">"SCHC: Generic Framework for Static Context Header Compression and Fragmentation"</span>, <span class="seriesInfo">RFC 8724</span>, <span class="seriesInfo">DOI 10.17487/RFC8724</span>, <time datetime="2020-04" class="refDate">April 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8724">https://www.rfc-editor.org/rfc/rfc8724</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8768">[RFC8768]</dt>
      <dd>
<span class="refAuthor">Boucadair, M.</span>, <span class="refAuthor">Reddy.K, T.</span>, and <span class="refAuthor">J. Shallow</span>, <span class="refTitle">"Constrained Application Protocol (CoAP) Hop-Limit Option"</span>, <span class="seriesInfo">RFC 8768</span>, <span class="seriesInfo">DOI 10.17487/RFC8768</span>, <time datetime="2020-03" class="refDate">March 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8768">https://www.rfc-editor.org/rfc/rfc8768</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.amsuess-core-cachable-oscore">[I-D.amsuess-core-cachable-oscore]</dt>
        <dd>
<span class="refAuthor">AmsÃ¼ss, C.</span> and <span class="refAuthor">M. Tiloca</span>, <span class="refTitle">"Cacheable OSCORE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-amsuess-core-cachable-oscore-11</span>, <time datetime="2025-07-06" class="refDate">6 July 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-amsuess-core-cachable-oscore-11">https://datatracker.ietf.org/doc/html/draft-amsuess-core-cachable-oscore-11</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.amsuess-t2trg-onion-coap">[I-D.amsuess-t2trg-onion-coap]</dt>
        <dd>
<span class="refAuthor">AmsÃ¼ss, C.</span>, <span class="refAuthor">Tiloca, M.</span>, and <span class="refAuthor">R. HÃ¶glund</span>, <span class="refTitle">"Using onion routing with CoAP"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-amsuess-t2trg-onion-coap-04</span>, <time datetime="2025-07-07" class="refDate">7 July 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-amsuess-t2trg-onion-coap-04">https://datatracker.ietf.org/doc/html/draft-amsuess-t2trg-onion-coap-04</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-coap-est-oscore">[I-D.ietf-ace-coap-est-oscore]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Raza, S.</span>, <span class="refAuthor">Furuhed, M.</span>, <span class="refAuthor">VuÄiniÄ, M.</span>, and <span class="refAuthor">T. Claeys</span>, <span class="refTitle">"Protecting EST Payloads with OSCORE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-coap-est-oscore-08</span>, <time datetime="2025-07-07" class="refDate">7 July 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-coap-est-oscore-08">https://datatracker.ietf.org/doc/html/draft-ietf-ace-coap-est-oscore-08</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-key-groupcomm-oscore">[I-D.ietf-ace-key-groupcomm-oscore]</dt>
        <dd>
<span class="refAuthor">Tiloca, M.</span> and <span class="refAuthor">F. Palombini</span>, <span class="refTitle">"Key Management for Group Object Security for Constrained RESTful Environments (Group OSCORE) Using Authentication and Authorization for Constrained Environments (ACE)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-key-groupcomm-oscore-18</span>, <time datetime="2025-08-28" class="refDate">28 August 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-key-groupcomm-oscore-18">https://datatracker.ietf.org/doc/html/draft-ietf-ace-key-groupcomm-oscore-18</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-coap-pm">[I-D.ietf-core-coap-pm]</dt>
        <dd>
<span class="refAuthor">Fioccola, G.</span>, <span class="refAuthor">Zhou, T.</span>, <span class="refAuthor">Cociglio, M.</span>, <span class="refAuthor">Bulgarella, F.</span>, and <span class="refAuthor">Y. Zhu</span>, <span class="refTitle">"Constrained Application Protocol (CoAP) Performance Measurement Option"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-coap-pm-04</span>, <time datetime="2025-04-04" class="refDate">4 April 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-coap-pm-04">https://datatracker.ietf.org/doc/html/draft-ietf-core-coap-pm-04</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-coap-pubsub">[I-D.ietf-core-coap-pubsub]</dt>
        <dd>
<span class="refAuthor">Jimenez, J.</span>, <span class="refAuthor">Koster, M.</span>, and <span class="refAuthor">A. KerÃ¤nen</span>, <span class="refTitle">"A publish-subscribe architecture for the Constrained Application Protocol (CoAP)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-coap-pubsub-18</span>, <time datetime="2025-02-28" class="refDate">28 February 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-coap-pubsub-18">https://datatracker.ietf.org/doc/html/draft-ietf-core-coap-pubsub-18</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-groupcomm-bis">[I-D.ietf-core-groupcomm-bis]</dt>
        <dd>
<span class="refAuthor">Dijk, E.</span> and <span class="refAuthor">M. Tiloca</span>, <span class="refTitle">"Group Communication for the Constrained Application Protocol (CoAP)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-groupcomm-bis-14</span>, <time datetime="2025-07-02" class="refDate">2 July 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-14">https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-14</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-groupcomm-proxy">[I-D.ietf-core-groupcomm-proxy]</dt>
        <dd>
<span class="refAuthor">Tiloca, M.</span> and <span class="refAuthor">E. Dijk</span>, <span class="refTitle">"Proxy Operations for CoAP Group Communication"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-groupcomm-proxy-04</span>, <time datetime="2025-03-03" class="refDate">3 March 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-proxy-04">https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-proxy-04</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-observe-multicast-notifications">[I-D.ietf-core-observe-multicast-notifications]</dt>
        <dd>
<span class="refAuthor">Tiloca, M.</span>, <span class="refAuthor">HÃ¶glund, R.</span>, <span class="refAuthor">AmsÃ¼ss, C.</span>, and <span class="refAuthor">F. Palombini</span>, <span class="refTitle">"Observe Notifications as CoAP Multicast Responses"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-observe-multicast-notifications-12</span>, <time datetime="2025-07-07" class="refDate">7 July 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-observe-multicast-notifications-12">https://datatracker.ietf.org/doc/html/draft-ietf-core-observe-multicast-notifications-12</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-transport-indication">[I-D.ietf-core-transport-indication]</dt>
        <dd>
<span class="refAuthor">AmsÃ¼ss, C.</span> and <span class="refAuthor">M. S. Lenders</span>, <span class="refTitle">"CoAP Transport Indication"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-transport-indication-09</span>, <time datetime="2025-07-07" class="refDate">7 July 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-transport-indication-09">https://datatracker.ietf.org/doc/html/draft-ietf-core-transport-indication-09</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="LwM2M-Core">[LwM2M-Core]</dt>
        <dd>
<span class="refAuthor">Open Mobile Alliance</span>, <span class="refTitle">"Lightweight Machine to Machine Technical Specification - Core, Approved Version 1.2, OMA-TS-LightweightM2M_Core-V1_2-20201110-A"</span>, <time datetime="2020-11" class="refDate">November 2020</time>, <span>&lt;<a href="http://www.openmobilealliance.org/release/LightweightM2M/V1_2-20201110-A/OMA-TS-LightweightM2M_Core-V1_2-20201110-A.pdf">http://www.openmobilealliance.org/release/LightweightM2M/V1_2-20201110-A/OMA-TS-LightweightM2M_Core-V1_2-20201110-A.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="LwM2M-Gateway">[LwM2M-Gateway]</dt>
        <dd>
<span class="refAuthor">Open Mobile Alliance</span>, <span class="refTitle">"Lightweight Machine to Machine Gateway Technical Specification - Approved Version 1.1, OMA-TS-LWM2M_Gateway-V1_1-20210518-A"</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.openmobilealliance.org/release/LwM2M_Gateway/V1_1-20210518-A/OMA-TS-LWM2M_Gateway-V1_1-20210518-A.pdf">https://www.openmobilealliance.org/release/LwM2M_Gateway/V1_1-20210518-A/OMA-TS-LWM2M_Gateway-V1_1-20210518-A.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="LwM2M-Transport">[LwM2M-Transport]</dt>
        <dd>
<span class="refAuthor">Open Mobile Alliance</span>, <span class="refTitle">"Lightweight Machine to Machine Technical Specification - Transport Bindings, Approved Version 1.2, OMA-TS-LightweightM2M_Transport-V1_2-20201110-A"</span>, <time datetime="2020-11" class="refDate">November 2020</time>, <span>&lt;<a href="http://www.openmobilealliance.org/release/LightweightM2M/V1_2-20201110-A/OMA-TS-LightweightM2M_Transport-V1_2-20201110-A.pdf">http://www.openmobilealliance.org/release/LightweightM2M/V1_2-20201110-A/OMA-TS-LightweightM2M_Transport-V1_2-20201110-A.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7030">[RFC7030]</dt>
        <dd>
<span class="refAuthor">Pritikin, M., Ed.</span>, <span class="refAuthor">Yee, P., Ed.</span>, and <span class="refAuthor">D. Harkins, Ed.</span>, <span class="refTitle">"Enrollment over Secure Transport"</span>, <span class="seriesInfo">RFC 7030</span>, <span class="seriesInfo">DOI 10.17487/RFC7030</span>, <time datetime="2013-10" class="refDate">October 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7030">https://www.rfc-editor.org/rfc/rfc7030</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7641">[RFC7641]</dt>
        <dd>
<span class="refAuthor">Hartke, K.</span>, <span class="refTitle">"Observing Resources in the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7641</span>, <span class="seriesInfo">DOI 10.17487/RFC7641</span>, <time datetime="2015-09" class="refDate">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7641">https://www.rfc-editor.org/rfc/rfc7641</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8742">[RFC8742]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR) Sequences"</span>, <span class="seriesInfo">RFC 8742</span>, <span class="seriesInfo">DOI 10.17487/RFC8742</span>, <time datetime="2020-02" class="refDate">February 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8742">https://www.rfc-editor.org/rfc/rfc8742</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9200">[RFC9200]</dt>
        <dd>
<span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Authentication and Authorization for Constrained Environments Using the OAuth 2.0 Framework (ACE-OAuth)"</span>, <span class="seriesInfo">RFC 9200</span>, <span class="seriesInfo">DOI 10.17487/RFC9200</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9200">https://www.rfc-editor.org/rfc/rfc9200</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9528">[RFC9528]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">PreuÃ Mattsson, J.</span>, and <span class="refAuthor">F. Palombini</span>, <span class="refTitle">"Ephemeral Diffie-Hellman Over COSE (EDHOC)"</span>, <span class="seriesInfo">RFC 9528</span>, <span class="seriesInfo">DOI 10.17487/RFC9528</span>, <time datetime="2024-03" class="refDate">March 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9528">https://www.rfc-editor.org/rfc/rfc9528</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9668">[RFC9668]</dt>
        <dd>
<span class="refAuthor">Palombini, F.</span>, <span class="refAuthor">Tiloca, M.</span>, <span class="refAuthor">HÃ¶glund, R.</span>, <span class="refAuthor">Hristozov, S.</span>, and <span class="refAuthor">G. Selander</span>, <span class="refTitle">"Using Ephemeral Diffie-Hellman Over COSE (EDHOC) with the Constrained Application Protocol (CoAP) and Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 9668</span>, <span class="seriesInfo">DOI 10.17487/RFC9668</span>, <time datetime="2024-11" class="refDate">November 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9668">https://www.rfc-editor.org/rfc/rfc9668</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TOR-SPEC">[TOR-SPEC]</dt>
      <dd>
<span class="refAuthor">Tor Project</span>, <span class="refTitle">"Tor Specifications"</span>, <span>&lt;<a href="https://spec.torproject.org/">https://spec.torproject.org/</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="sec-use-cases">
<section id="appendix-A">
      <h2 id="name-use-cases">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-use-cases" class="section-name selfRef">Use Cases</a>
      </h2>
<p id="appendix-A-1">The approach defined in this document has been motivated by a number of use cases, which are summarized below.<a href="#appendix-A-1" class="pilcrow">Â¶</a></p>
<div id="ssec-uc1">
<section id="appendix-A.1">
        <h3 id="name-coap-group-communication-wi">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-coap-group-communication-wi" class="section-name selfRef">CoAP Group Communication with Proxies</a>
        </h3>
<p id="appendix-A.1-1">CoAP supports also one-to-many group communication <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, e.g., over IP multicast, which can be protected end-to-end between origin client and origin servers by using Group OSCORE <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>.<a href="#appendix-A.1-1" class="pilcrow">Â¶</a></p>
<p id="appendix-A.1-2">This communication model can be assisted by intermediaries such as a CoAP forward-proxy or reverse-proxy, which relays a group request to the origin servers. If Group OSCORE is used, the proxy is intentionally not a member of the OSCORE group. Furthermore, <span>[<a href="#I-D.ietf-core-groupcomm-proxy" class="cite xref">I-D.ietf-core-groupcomm-proxy</a>]</span> defines a signaling protocol between origin client and proxy, to ensure that responses from the different origin servers are forwarded back to the origin client within a time interval set by the client and that those responses can be distinguished from one another.<a href="#appendix-A.1-2" class="pilcrow">Â¶</a></p>
<p id="appendix-A.1-3">In particular, it is required that the proxy identifies the origin client as allowed-listed, before forwarding a group request to the servers (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-proxy-04#section-4" class="relref">Section 4</a> of [<a href="#I-D.ietf-core-groupcomm-proxy" class="cite xref">I-D.ietf-core-groupcomm-proxy</a>]</span>). This requires a security association between the origin client and the proxy, which would be convenient to provide with a dedicated OSCORE Security Context between the two, since the client is possibly using also Group OSCORE with the origin servers.<a href="#appendix-A.1-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="ssec-uc2">
<section id="appendix-A.2">
        <h3 id="name-coap-observe-notifications-">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-coap-observe-notifications-" class="section-name selfRef">CoAP Observe Notifications over Multicast</a>
        </h3>
<p id="appendix-A.2-1">The Observe extension for CoAP <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span> allows a client to register its interest in "observing" a resource at a server. The server can then send back notification responses upon changes in the resource representation, all matching with the original observation request.<a href="#appendix-A.2-1" class="pilcrow">Â¶</a></p>
<p id="appendix-A.2-2">In some applications, such as based on publish-subscribe communication <span>[<a href="#I-D.ietf-core-coap-pubsub" class="cite xref">I-D.ietf-core-coap-pubsub</a>]</span>, multiple clients are interested in observing the same resource at the same server. Hence, <span>[<a href="#I-D.ietf-core-observe-multicast-notifications" class="cite xref">I-D.ietf-core-observe-multicast-notifications</a>]</span> defines a method that allows the server to send a multicast notification to all the observer clients at once, e.g., over IP multicast. To this end, the server synchronizes the clients by providing them with a common "phantom observation request", against which the following multicast notifications will match.<a href="#appendix-A.2-2" class="pilcrow">Â¶</a></p>
<p id="appendix-A.2-3">In case the clients and the server use Group OSCORE for end-to-end security and a proxy is also involved, an additional step is required (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-observe-multicast-notifications-12#section-12" class="relref">Section 12</a> of [<a href="#I-D.ietf-core-observe-multicast-notifications" class="cite xref">I-D.ietf-core-observe-multicast-notifications</a>]</span>). That is, clients are in turn required to provide the proxy with the obtained "phantom observation request", thus enabling the proxy to receive the multicast notifications from the server.<a href="#appendix-A.2-3" class="pilcrow">Â¶</a></p>
<p id="appendix-A.2-4">Therefore, it is preferable to have a security association also between each client and the proxy, in order to ensure the integrity of that information provided to the proxy (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-observe-multicast-notifications-12#section-15.3" class="relref">Section 15.3</a> of [<a href="#I-D.ietf-core-observe-multicast-notifications" class="cite xref">I-D.ietf-core-observe-multicast-notifications</a>]</span>). Like for the use case in <a href="#ssec-uc1" class="auto internal xref">Appendix A.1</a>, this would be conveniently achieved with a dedicated OSCORE Security Context between a client and the proxy, since the client is also using Group OSCORE with the origin server.<a href="#appendix-A.2-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="ssec-uc3">
<section id="appendix-A.3">
        <h3 id="name-lwm2m-client-and-external-a">
<a href="#appendix-A.3" class="section-number selfRef">A.3. </a><a href="#name-lwm2m-client-and-external-a" class="section-name selfRef">LwM2M Client and External Application Server</a>
        </h3>
<p id="appendix-A.3-1">The Lightweight Machine-to-Machine (LwM2M) protocol <span>[<a href="#LwM2M-Core" class="cite xref">LwM2M-Core</a>]</span> enables a LwM2M Client device to securely bootstrap and then register at a LwM2M Server, with which it will perform most of its following communication exchanges. As per the transport bindings specification of LwM2M <span>[<a href="#LwM2M-Transport" class="cite xref">LwM2M-Transport</a>]</span>, the LwM2M Client and LwM2M Server can use CoAP and OSCORE to secure their communications at the application layer, including during the device registration process.<a href="#appendix-A.3-1" class="pilcrow">Â¶</a></p>
<p id="appendix-A.3-2">Furthermore, Section 5.5.1 of <span>[<a href="#LwM2M-Transport" class="cite xref">LwM2M-Transport</a>]</span> specifies that:<a href="#appendix-A.3-2" class="pilcrow">Â¶</a></p>
<blockquote id="appendix-A.3-3">
          <p id="appendix-A.3-3.1">OSCORE <span class="bcp14">MAY</span> also be used between LwM2M endpoint and non-LwM2M endpoint, e.g., between an Application Server and a LwM2M Client via a LwM2M server. Both the LwM2M endpoint and non-LwM2M endpoint <span class="bcp14">MUST</span> implement OSCORE and be provisioned with an OSCORE Security Context.<a href="#appendix-A.3-3.1" class="pilcrow">Â¶</a></p>
</blockquote>
<p id="appendix-A.3-4">In such a case, the LwM2M Server can practically act as forward-proxy between the LwM2M Client and the external Application Server. At the same time, the LwM2M Client and LwM2M Server must continue protecting communications on their leg using their OSCORE Security Context. Like for the use case in <a href="#ssec-uc1" class="auto internal xref">Appendix A.1</a>, this also allows the LwM2M Server to identify the LwM2M Client, before forwarding its request outside the LwM2M domain and towards the external Application Server.<a href="#appendix-A.3-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="ssec-uc4">
<section id="appendix-A.4">
        <h3 id="name-lwm2m-gateway">
<a href="#appendix-A.4" class="section-number selfRef">A.4. </a><a href="#name-lwm2m-gateway" class="section-name selfRef">LwM2M Gateway</a>
        </h3>
<p id="appendix-A.4-1">The specification <span>[<a href="#LwM2M-Gateway" class="cite xref">LwM2M-Gateway</a>]</span> extends the LwM2M architecture by defining the LwM2M Gateway functionality. That is, a LwM2M Server can manage end IoT devices that are deployed "behind" the LwM2M Gateway. While it is outside the scope of that specification, it is possible for the LwM2M Gateway to use any suitable protocol with its connected end IoT devices, as well as to carry out any required protocol translation.<a href="#appendix-A.4-1" class="pilcrow">Â¶</a></p>
<p id="appendix-A.4-2">Practically, the LwM2M Server can send a request to the LwM2M Gateway, asking to forward it to an end IoT device. With particular reference to CoAP and the related transport binding specified in <span>[<a href="#LwM2M-Transport" class="cite xref">LwM2M-Transport</a>]</span>, the LwM2M Server acting as a CoAP client sends its request to the LwM2M Gateway acting as a CoAP server.<a href="#appendix-A.4-2" class="pilcrow">Â¶</a></p>
<p id="appendix-A.4-3">If CoAP is used in the communication leg between the LwM2M Gateway and the end IoT devices, then the LwM2M Gateway fundamentally acts as a CoAP reverse-proxy (see <span><a href="https://rfc-editor.org/rfc/rfc7252#section-5.7.3" class="relref">Section 5.7.3</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>). That is, in addition to its own resources, the LwM2M Gateway serves the resources hosted by each end IoT device standing behind it, as exposed by the LwM2M Gateway under a dedicated URI path. As per <span>[<a href="#LwM2M-Gateway" class="cite xref">LwM2M-Gateway</a>]</span>, the first URI path segment is used as a "prefix" to identify the specific IoT device, while the remaining URI path segments specify the target resource at the IoT device.<a href="#appendix-A.4-3" class="pilcrow">Â¶</a></p>
<p id="appendix-A.4-4">As per Section 7 of <span>[<a href="#LwM2M-Gateway" class="cite xref">LwM2M-Gateway</a>]</span>, message exchanges between the LwM2M Server and the LwM2M Gateway are secured using the LwM2M-defined technologies, while the LwM2M protocol does not provide end-to-end security between the LwM2M Server and the end IoT devices. However, the approach defined in this document makes it possible to achieve both goals, by allowing the LwM2M Server to use OSCORE for protecting a message both end-to-end with the targeted end IoT device and with the LwM2M Gateway acting as a reverse-proxy.<a href="#appendix-A.4-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="further-use-cases">
<section id="appendix-A.5">
        <h3 id="name-further-use-cases">
<a href="#appendix-A.5" class="section-number selfRef">A.5. </a><a href="#name-further-use-cases" class="section-name selfRef">Further Use Cases</a>
        </h3>
<p id="appendix-A.5-1">The approach defined in this document can be useful also in the following use cases relying on a proxy.<a href="#appendix-A.5-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.5-2.1">
            <p id="appendix-A.5-2.1.1">A server aware of a suitable cross-proxy can rely on it as a third-party service, in order to indicate transports for CoAP that are available for that server (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-transport-indication-09#section-5" class="relref">Section 5</a> of [<a href="#I-D.ietf-core-transport-indication" class="cite xref">I-D.ietf-core-transport-indication</a>]</span>).<a href="#appendix-A.5-2.1.1" class="pilcrow">Â¶</a></p>
<p id="appendix-A.5-2.1.2">
From a security point of view, it would be convenient if the proxy could provide suitable credentials to the client, as a general trusted proxy for the system. At the same time, it can be desirable to limit the use of such a proxy to a set of clients that have permission to use it, and that the proxy can identify through a secure communication association.<a href="#appendix-A.5-2.1.2" class="pilcrow">Â¶</a></p>
<p id="appendix-A.5-2.1.3">
However, in order for OSCORE to be an applicable security mechanism for this scenario, OSCORE has to be terminated at the proxy. That is, it would be required for a client and the proxy to share a dedicated OSCORE Security Context and to use it for protecting their communication leg.<a href="#appendix-A.5-2.1.3" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-A.5-2.2">
            <p id="appendix-A.5-2.2.1">The method specified in <span>[<a href="#I-D.ietf-core-coap-pm" class="cite xref">I-D.ietf-core-coap-pm</a>]</span> relies on the Performance Measurement option to enable network telemetry for CoAP communications. This makes it possible to efficiently measure Round-Trip Time and message losses, both end-to-end and hop-by-hop. In particular, on-path probes such as intermediary proxies can be deployed to perform measurements hop-by-hop.<a href="#appendix-A.5-2.2.1" class="pilcrow">Â¶</a></p>
<p id="appendix-A.5-2.2.2">
When OSCORE is used in deployments including on-path probes, an inner Performance Measurement option is protected end-to-end between the two application endpoints and enables end-to-end measurements between those. At the same time, an outer Performance Measurement option allows also hop-by-hop measurements to be performed by relying on an on-path probe.<a href="#appendix-A.5-2.2.2" class="pilcrow">Â¶</a></p>
<p id="appendix-A.5-2.2.3">
Therefore, it is preferable to have a secure association with an on-path probe, in order to also ensure the integrity of the hop-by-hop measurements exchanged with the probe.<a href="#appendix-A.5-2.2.3" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-A.5-2.3">
            <p id="appendix-A.5-2.3.1">The method specified in <span>[<a href="#I-D.ietf-ace-coap-est-oscore" class="cite xref">I-D.ietf-ace-coap-est-oscore</a>]</span> enables public-key certificate enrollment for Internet of Things deployments. This leverages payload formats defined in Enrollment over Secure Transport (EST) <span>[<a href="#RFC7030" class="cite xref">RFC7030</a>]</span>, while relying on CoAP for message transfer and on OSCORE for message protection.<a href="#appendix-A.5-2.3.1" class="pilcrow">Â¶</a></p>
<p id="appendix-A.5-2.3.2">
In real-world deployments, an EST server issuing public-key certificates may reside outside a constrained network that includes devices acting as EST clients. In particular, the EST clients are expected to support only CoAP, while the EST server in a non-constrained network is expected to support only HTTP. This requires a CoAP-to-HTTP proxy to be deployed between the EST clients and the EST server, in order to map CoAP messages with HTTP messages across the two networks.<a href="#appendix-A.5-2.3.2" class="pilcrow">Â¶</a></p>
<p id="appendix-A.5-2.3.3">
Even in such a scenario, the EST server and every EST client can still effectively use OSCORE to protect their communications end-to-end. At the same time, it is desirable to have an additional secure association between the EST client and the CoAP-to-HTTP proxy, especially in order for the proxy to identify the EST client before forwarding EST messages out of the CoAP boundary of the constrained network and towards the EST server.<a href="#appendix-A.5-2.3.3" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-A.5-2.4">
            <p id="appendix-A.5-2.4.1">A proxy may be deployed to act as an entry point to a firewalled network that only authenticated clients can join. In particular, authentication can rely on the secure communication association used between a client and the proxy. If the proxy could share a different OSCORE Security Context with each different client, then the proxy can rely on it to identify a client before forwarding messages from that client to other members of the firewalled network.<a href="#appendix-A.5-2.4.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-A.5-2.5">
            <p id="appendix-A.5-2.5.1">The approach defined in this document does not pose a limit to the number of OSCORE protections applied to the same CoAP message.<a href="#appendix-A.5-2.5.1" class="pilcrow">Â¶</a></p>
<p id="appendix-A.5-2.5.2">
This enables more privacy-oriented scenarios based on proxy chains, where the origin client protects a CoAP request first by using the OSCORE Security Context shared with the origin server, and then by using different OSCORE Security Contexts shared with the different hops in the chain. Once received at a chain hop, the request would be stripped of the OSCORE protection associated with that hop before being forwarded to the next one.<a href="#appendix-A.5-2.5.2" class="pilcrow">Â¶</a></p>
<p id="appendix-A.5-2.5.3">
Building on that, it is also possible to enable the operation of hidden services and clients through onion routing with CoAP <span>[<a href="#I-D.amsuess-t2trg-onion-coap" class="cite xref">I-D.amsuess-t2trg-onion-coap</a>]</span>, similarly to how Tor (The Onion Router) <span>[<a href="#TOR-SPEC" class="cite xref">TOR-SPEC</a>]</span> enables it for TCP-based protocols.<a href="#appendix-A.5-2.5.3" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="sec-examples">
<section id="appendix-B">
      <h2 id="name-examples-of-message-exchang">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-examples-of-message-exchang" class="section-name selfRef">Examples of Message Exchanges</a>
      </h2>
<p id="appendix-B-1">This section provides a number of examples where the approach defined in this document is used to protect message exchanges.<a href="#appendix-B-1" class="pilcrow">Â¶</a></p>
<p id="appendix-B-2">The presented examples build on the example shown in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-A.1" class="relref">Appendix A.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, which illustrates an origin client requesting the alarm status from an origin server through a forward-proxy.<a href="#appendix-B-2" class="pilcrow">Â¶</a></p>
<p id="appendix-B-3">The abbreviations "REQ" and "RESP" are used to denote a request message and a response message, respectively.<a href="#appendix-B-3" class="pilcrow">Â¶</a></p>
<div id="with-forward-proxy-oscore-c-s-c-p">
<section id="appendix-B.1">
        <h3 id="name-with-forward-proxy-oscore-c">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-with-forward-proxy-oscore-c" class="section-name selfRef">With Forward-Proxy; OSCORE: C-S, C-P</a>
        </h3>
<p id="appendix-B.1-1">In the example shown in <a href="#fig-example-client-proxy" class="auto internal xref">Figure 1</a>, message exchanges are protected with OSCORE as follows.<a href="#appendix-B.1-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.1-2.1">
            <p id="appendix-B.1-2.1.1">End-to-end, between the client and the server, using the OSCORE Security Context CTX_C_S. The client uses the OSCORE Sender ID 0x5f when using OSCORE with the server.<a href="#appendix-B.1-2.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-2.2">
            <p id="appendix-B.1-2.2.1">Between the client and the proxy, using the OSCORE Security Context CTX_C_P. The client uses the OSCORE Sender ID 0x20 when using OSCORE with the proxy.<a href="#appendix-B.1-2.2.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<span id="name-use-of-oscore-between-clien"></span><div id="fig-example-client-proxy">
<figure id="figure-1">
          <div id="appendix-B.1-3.1">
            <div class="alignLeft art-svg artwork" id="appendix-B.1-3.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="1360" width="544" viewBox="0 0 544 1360" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 24,104 L 24,112" fill="none" stroke="black"></path>
                <path d="M 24,168 L 24,1168" fill="none" stroke="black"></path>
                <path d="M 24,1224 L 24,1232" fill="none" stroke="black"></path>
                <path d="M 24,1288 L 24,1296" fill="none" stroke="black"></path>
                <path d="M 88,48 L 88,400" fill="none" stroke="black"></path>
                <path d="M 88,456 L 88,896" fill="none" stroke="black"></path>
                <path d="M 88,952 L 88,1296" fill="none" stroke="black"></path>
                <path d="M 152,48 L 152,624" fill="none" stroke="black"></path>
                <path d="M 152,680 L 152,688" fill="none" stroke="black"></path>
                <path d="M 152,744 L 152,1296" fill="none" stroke="black"></path>
                <path d="M 24,192 L 80,192" fill="none" stroke="black"></path>
                <path d="M 88,480 L 144,480" fill="none" stroke="black"></path>
                <path d="M 96,768 L 152,768" fill="none" stroke="black"></path>
                <path d="M 32,976 L 88,976" fill="none" stroke="black"></path>
                <path d="M 264,384 L 272,368" fill="none" stroke="black"></path>
                <path d="M 272,384 L 284,360" fill="none" stroke="black"></path>
                <path d="M 264,1152 L 272,1136" fill="none" stroke="black"></path>
                <path d="M 272,1152 L 280,1136" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="152,480 140,474.4 140,485.6" fill="black" transform="rotate(0,144,480)"></polygon>
                <polygon class="arrowhead" points="104,768 92,762.4 92,773.6" fill="black" transform="rotate(180,96,768)"></polygon>
                <polygon class="arrowhead" points="88,192 76,186.4 76,197.6" fill="black" transform="rotate(0,80,192)"></polygon>
                <polygon class="arrowhead" points="40,976 28,970.4 28,981.6" fill="black" transform="rotate(180,32,976)"></polygon>
                <g class="text">
                  <text x="28" y="36">Client</text>
                  <text x="88" y="36">Proxy</text>
                  <text x="148" y="36">Server</text>
                  <text x="24" y="52">|</text>
                  <text x="32" y="68">Encrypt</text>
                  <text x="16" y="84">REQ</text>
                  <text x="52" y="84">with</text>
                  <text x="32" y="100">CTX_C_S</text>
                  <text x="32" y="132">Encrypt</text>
                  <text x="16" y="148">REQ</text>
                  <text x="52" y="148">with</text>
                  <text x="32" y="164">CTX_C_P</text>
                  <text x="216" y="196">Code:</text>
                  <text x="260" y="196">0.02</text>
                  <text x="308" y="196">(POST)</text>
                  <text x="52" y="212">POST</text>
                  <text x="212" y="212">Token:</text>
                  <text x="260" y="212">0x8c</text>
                  <text x="208" y="228">OSCORE:</text>
                  <text x="284" y="228">[kid:0x20,</text>
                  <text x="360" y="228">Partial</text>
                  <text x="420" y="228">IV:31]</text>
                  <text x="212" y="244">0xff</text>
                  <text x="204" y="260">Payload:</text>
                  <text x="268" y="260">{Code:</text>
                  <text x="316" y="260">0.02</text>
                  <text x="368" y="260">(POST),</text>
                  <text x="280" y="276">OSCORE:</text>
                  <text x="356" y="276">[kid:0x5f,</text>
                  <text x="432" y="276">Partial</text>
                  <text x="496" y="276">IV:42],</text>
                  <text x="288" y="292">Uri-Host:</text>
                  <text x="388" y="292">"example.com",</text>
                  <text x="304" y="308">Proxy-Scheme:</text>
                  <text x="392" y="308">"coap",</text>
                  <text x="272" y="324">0xff,</text>
                  <text x="276" y="340">{Code:</text>
                  <text x="324" y="340">0.01</text>
                  <text x="372" y="340">(GET),</text>
                  <text x="296" y="356">Uri-Path:</text>
                  <text x="396" y="356">"alarm_status"</text>
                  <text x="256" y="372">}</text>
                  <text x="328" y="372">Encrypted</text>
                  <text x="388" y="372">with</text>
                  <text x="440" y="372">CTX_C_S</text>
                  <text x="248" y="388">}</text>
                  <text x="320" y="388">Encrypted</text>
                  <text x="380" y="388">with</text>
                  <text x="432" y="388">CTX_C_P</text>
                  <text x="96" y="420">Decrypt</text>
                  <text x="80" y="436">REQ</text>
                  <text x="116" y="436">with</text>
                  <text x="96" y="452">CTX_C_P</text>
                  <text x="216" y="484">Code:</text>
                  <text x="260" y="484">0.02</text>
                  <text x="308" y="484">(POST)</text>
                  <text x="116" y="500">POST</text>
                  <text x="212" y="500">Token:</text>
                  <text x="260" y="500">0x7b</text>
                  <text x="200" y="516">Uri-Host:</text>
                  <text x="296" y="516">"example.com"</text>
                  <text x="208" y="532">OSCORE:</text>
                  <text x="284" y="532">[kid:0x5f,</text>
                  <text x="360" y="532">Partial</text>
                  <text x="420" y="532">IV:42]</text>
                  <text x="212" y="548">0xff</text>
                  <text x="204" y="564">Payload:</text>
                  <text x="248" y="564">{</text>
                  <text x="272" y="580">Code:</text>
                  <text x="316" y="580">0.01</text>
                  <text x="364" y="580">(GET),</text>
                  <text x="288" y="596">Uri-Path:</text>
                  <text x="388" y="596">"alarm_status"</text>
                  <text x="248" y="612">}</text>
                  <text x="268" y="612">//</text>
                  <text x="320" y="612">Encrypted</text>
                  <text x="380" y="612">with</text>
                  <text x="432" y="612">CTX_C_S</text>
                  <text x="160" y="644">Decrypt</text>
                  <text x="144" y="660">REQ</text>
                  <text x="180" y="660">with</text>
                  <text x="160" y="676">CTX_C_S</text>
                  <text x="160" y="708">Encrypt</text>
                  <text x="148" y="724">RESP</text>
                  <text x="188" y="724">with</text>
                  <text x="160" y="740">CTX_C_S</text>
                  <text x="216" y="772">Code:</text>
                  <text x="260" y="772">2.04</text>
                  <text x="320" y="772">(Changed)</text>
                  <text x="124" y="788">2.04</text>
                  <text x="212" y="788">Token:</text>
                  <text x="260" y="788">0x7b</text>
                  <text x="208" y="804">OSCORE:</text>
                  <text x="248" y="804">-</text>
                  <text x="212" y="820">0xff</text>
                  <text x="204" y="836">Payload:</text>
                  <text x="268" y="836">{Code:</text>
                  <text x="316" y="836">2.05</text>
                  <text x="380" y="836">(Content),</text>
                  <text x="272" y="852">0xff,</text>
                  <text x="264" y="868">"0"</text>
                  <text x="248" y="884">}</text>
                  <text x="268" y="884">//</text>
                  <text x="320" y="884">Encrypted</text>
                  <text x="380" y="884">with</text>
                  <text x="432" y="884">CTX_C_S</text>
                  <text x="96" y="916">Encrypt</text>
                  <text x="84" y="932">RESP</text>
                  <text x="124" y="932">with</text>
                  <text x="96" y="948">CTX_C_P</text>
                  <text x="216" y="980">Code:</text>
                  <text x="260" y="980">2.04</text>
                  <text x="320" y="980">(Changed)</text>
                  <text x="60" y="996">2.04</text>
                  <text x="212" y="996">Token:</text>
                  <text x="260" y="996">0x8c</text>
                  <text x="208" y="1012">OSCORE:</text>
                  <text x="248" y="1012">-</text>
                  <text x="212" y="1028">0xff</text>
                  <text x="204" y="1044">Payload:</text>
                  <text x="268" y="1044">{Code:</text>
                  <text x="316" y="1044">2.04</text>
                  <text x="380" y="1044">(Changed),</text>
                  <text x="280" y="1060">OSCORE:</text>
                  <text x="324" y="1060">-,</text>
                  <text x="272" y="1076">0xff,</text>
                  <text x="276" y="1092">{Code:</text>
                  <text x="324" y="1092">2.05</text>
                  <text x="388" y="1092">(Content),</text>
                  <text x="280" y="1108">0xff,</text>
                  <text x="272" y="1124">"0"</text>
                  <text x="256" y="1140">}</text>
                  <text x="328" y="1140">Encrypted</text>
                  <text x="388" y="1140">with</text>
                  <text x="440" y="1140">CTX_C_S</text>
                  <text x="248" y="1156">}</text>
                  <text x="320" y="1156">Encrypted</text>
                  <text x="380" y="1156">with</text>
                  <text x="432" y="1156">CTX_C_P</text>
                  <text x="32" y="1188">Decrypt</text>
                  <text x="20" y="1204">RESP</text>
                  <text x="60" y="1204">with</text>
                  <text x="32" y="1220">CTX_C_P</text>
                  <text x="32" y="1252">Decrypt</text>
                  <text x="20" y="1268">RESP</text>
                  <text x="60" y="1268">with</text>
                  <text x="32" y="1284">CTX_C_S</text>
                  <text x="28" y="1332">Square</text>
                  <text x="92" y="1332">brackets</text>
                  <text x="136" y="1332">[</text>
                  <text x="160" y="1332">...</text>
                  <text x="184" y="1332">]</text>
                  <text x="228" y="1332">indicate</text>
                  <text x="296" y="1332">content</text>
                  <text x="340" y="1332">of</text>
                  <text x="396" y="1332">compressed</text>
                  <text x="460" y="1332">COSE</text>
                  <text x="512" y="1332">object.</text>
                  <text x="24" y="1348">Curly</text>
                  <text x="84" y="1348">brackets</text>
                  <text x="128" y="1348">{</text>
                  <text x="152" y="1348">...</text>
                  <text x="176" y="1348">}</text>
                  <text x="220" y="1348">indicate</text>
                  <text x="296" y="1348">encrypted</text>
                  <text x="360" y="1348">data.</text>
                </g>
              </svg><a href="#appendix-B.1-3.1.1" class="pilcrow">Â¶</a>
</div>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-use-of-oscore-between-clien" class="selfRef">Use of OSCORE between Client-Server and Client-Proxy</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="with-forward-proxy-oscore-c-s-p-s">
<section id="appendix-B.2">
        <h3 id="name-with-forward-proxy-oscore-c-">
<a href="#appendix-B.2" class="section-number selfRef">B.2. </a><a href="#name-with-forward-proxy-oscore-c-" class="section-name selfRef">With Forward-Proxy; OSCORE: C-S, P-S</a>
        </h3>
<p id="appendix-B.2-1">In the example shown in <a href="#fig-example-proxy-server" class="auto internal xref">Figure 2</a>, message exchanges are protected with OSCORE as follows.<a href="#appendix-B.2-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.2-2.1">
            <p id="appendix-B.2-2.1.1">End-to-end between the client and the server, using the OSCORE Security Context CTX_C_S. The client uses the OSCORE Sender ID 0x5f when using OSCORE with the server.<a href="#appendix-B.2-2.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-2.2">
            <p id="appendix-B.2-2.2.1">Between the proxy and the server, using the OSCORE Security Context CTX_P_S. The proxy uses the OSCORE Sender ID 0xd4 when using OSCORE with the server.<a href="#appendix-B.2-2.2.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<span id="name-use-of-oscore-between-client"></span><div id="fig-example-proxy-server">
<figure id="figure-2">
          <div id="appendix-B.2-3.1">
            <div class="alignLeft art-svg artwork" id="appendix-B.2-3.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="1344" width="560" viewBox="0 0 560 1344" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 24,104 L 24,1216" fill="none" stroke="black"></path>
                <path d="M 24,1272 L 24,1280" fill="none" stroke="black"></path>
                <path d="M 88,48 L 88,272" fill="none" stroke="black"></path>
                <path d="M 88,328 L 88,1008" fill="none" stroke="black"></path>
                <path d="M 88,1064 L 88,1280" fill="none" stroke="black"></path>
                <path d="M 152,48 L 152,544" fill="none" stroke="black"></path>
                <path d="M 152,600 L 152,608" fill="none" stroke="black"></path>
                <path d="M 152,664 L 152,672" fill="none" stroke="black"></path>
                <path d="M 152,728 L 152,736" fill="none" stroke="black"></path>
                <path d="M 152,792 L 152,1280" fill="none" stroke="black"></path>
                <path d="M 24,128 L 80,128" fill="none" stroke="black"></path>
                <path d="M 88,352 L 144,352" fill="none" stroke="black"></path>
                <path d="M 96,816 L 152,816" fill="none" stroke="black"></path>
                <path d="M 32,1088 L 88,1088" fill="none" stroke="black"></path>
                <path d="M 296,528 L 304,512" fill="none" stroke="black"></path>
                <path d="M 304,528 L 316,504" fill="none" stroke="black"></path>
                <path d="M 296,992 L 304,976" fill="none" stroke="black"></path>
                <path d="M 304,992 L 312,976" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="152,352 140,346.4 140,357.6" fill="black" transform="rotate(0,144,352)"></polygon>
                <polygon class="arrowhead" points="104,816 92,810.4 92,821.6" fill="black" transform="rotate(180,96,816)"></polygon>
                <polygon class="arrowhead" points="88,128 76,122.4 76,133.6" fill="black" transform="rotate(0,80,128)"></polygon>
                <polygon class="arrowhead" points="40,1088 28,1082.4 28,1093.6" fill="black" transform="rotate(180,32,1088)"></polygon>
                <g class="text">
                  <text x="28" y="36">Client</text>
                  <text x="88" y="36">Proxy</text>
                  <text x="148" y="36">Server</text>
                  <text x="24" y="52">|</text>
                  <text x="32" y="68">Encrypt</text>
                  <text x="16" y="84">REQ</text>
                  <text x="52" y="84">with</text>
                  <text x="32" y="100">CTX_C_S</text>
                  <text x="248" y="132">Code:</text>
                  <text x="292" y="132">0.02</text>
                  <text x="340" y="132">(POST)</text>
                  <text x="52" y="148">POST</text>
                  <text x="244" y="148">Token:</text>
                  <text x="292" y="148">0x8c</text>
                  <text x="232" y="164">Uri-Host:</text>
                  <text x="328" y="164">"example.com"</text>
                  <text x="216" y="180">Proxy-Scheme:</text>
                  <text x="300" y="180">"coap"</text>
                  <text x="240" y="196">OSCORE:</text>
                  <text x="316" y="196">[kid:0x5f,</text>
                  <text x="392" y="196">Partial</text>
                  <text x="452" y="196">IV:42]</text>
                  <text x="244" y="212">0xff</text>
                  <text x="236" y="228">Payload:</text>
                  <text x="300" y="228">{Code:</text>
                  <text x="348" y="228">0.01</text>
                  <text x="396" y="228">(GET),</text>
                  <text x="320" y="244">Uri-Path:</text>
                  <text x="420" y="244">"alarm_status"</text>
                  <text x="280" y="260">}</text>
                  <text x="300" y="260">//</text>
                  <text x="352" y="260">Encrypted</text>
                  <text x="412" y="260">with</text>
                  <text x="464" y="260">CTX_C_S</text>
                  <text x="96" y="292">Encrypt</text>
                  <text x="80" y="308">REQ</text>
                  <text x="116" y="308">with</text>
                  <text x="96" y="324">CTX_P_S</text>
                  <text x="248" y="356">Code:</text>
                  <text x="292" y="356">0.02</text>
                  <text x="340" y="356">(POST)</text>
                  <text x="116" y="372">POST</text>
                  <text x="244" y="372">Token:</text>
                  <text x="292" y="372">0x7b</text>
                  <text x="232" y="388">Uri-Host:</text>
                  <text x="328" y="388">"example.com"</text>
                  <text x="240" y="404">OSCORE:</text>
                  <text x="316" y="404">[kid:0xd4,</text>
                  <text x="392" y="404">Partial</text>
                  <text x="452" y="404">IV:31]</text>
                  <text x="244" y="420">0xff</text>
                  <text x="236" y="436">Payload:</text>
                  <text x="300" y="436">{Code:</text>
                  <text x="348" y="436">0.02</text>
                  <text x="400" y="436">(POST),</text>
                  <text x="312" y="452">OSCORE:</text>
                  <text x="388" y="452">[kid:0x5f,</text>
                  <text x="464" y="452">Partial</text>
                  <text x="528" y="452">IV:42],</text>
                  <text x="304" y="468">0xff,</text>
                  <text x="308" y="484">{Code:</text>
                  <text x="356" y="484">0.01</text>
                  <text x="404" y="484">(GET),</text>
                  <text x="328" y="500">Uri-Path:</text>
                  <text x="428" y="500">"alarm_status"</text>
                  <text x="288" y="516">}</text>
                  <text x="360" y="516">Encrypted</text>
                  <text x="420" y="516">with</text>
                  <text x="472" y="516">CTX_C_S</text>
                  <text x="280" y="532">}</text>
                  <text x="352" y="532">Encrypted</text>
                  <text x="412" y="532">with</text>
                  <text x="464" y="532">CTX_P_S</text>
                  <text x="160" y="564">Decrypt</text>
                  <text x="144" y="580">REQ</text>
                  <text x="180" y="580">with</text>
                  <text x="160" y="596">CTX_P_S</text>
                  <text x="160" y="628">Decrypt</text>
                  <text x="144" y="644">REQ</text>
                  <text x="180" y="644">with</text>
                  <text x="160" y="660">CTX_C_S</text>
                  <text x="160" y="692">Encrypt</text>
                  <text x="148" y="708">RESP</text>
                  <text x="188" y="708">with</text>
                  <text x="160" y="724">CTX_C_S</text>
                  <text x="160" y="756">Encrypt</text>
                  <text x="148" y="772">RESP</text>
                  <text x="188" y="772">with</text>
                  <text x="160" y="788">CTX_P_S</text>
                  <text x="248" y="820">Code:</text>
                  <text x="292" y="820">2.04</text>
                  <text x="352" y="820">(Changed)</text>
                  <text x="124" y="836">2.04</text>
                  <text x="244" y="836">Token:</text>
                  <text x="292" y="836">0x7b</text>
                  <text x="240" y="852">OSCORE:</text>
                  <text x="280" y="852">-</text>
                  <text x="244" y="868">0xff</text>
                  <text x="236" y="884">Payload:</text>
                  <text x="300" y="884">{Code:</text>
                  <text x="348" y="884">2.04</text>
                  <text x="412" y="884">(Changed),</text>
                  <text x="312" y="900">OSCORE:</text>
                  <text x="356" y="900">-,</text>
                  <text x="304" y="916">0xff,</text>
                  <text x="308" y="932">{Code:</text>
                  <text x="356" y="932">2.05</text>
                  <text x="420" y="932">(Content),</text>
                  <text x="312" y="948">0xff,</text>
                  <text x="304" y="964">"0"</text>
                  <text x="288" y="980">}</text>
                  <text x="360" y="980">Encrypted</text>
                  <text x="420" y="980">with</text>
                  <text x="472" y="980">CTX_C_S</text>
                  <text x="280" y="996">}</text>
                  <text x="352" y="996">Encrypted</text>
                  <text x="412" y="996">with</text>
                  <text x="464" y="996">CTX_P_S</text>
                  <text x="96" y="1028">Decrypt</text>
                  <text x="84" y="1044">RESP</text>
                  <text x="124" y="1044">with</text>
                  <text x="96" y="1060">CTX_P_S</text>
                  <text x="248" y="1092">Code:</text>
                  <text x="292" y="1092">2.04</text>
                  <text x="352" y="1092">(Changed)</text>
                  <text x="60" y="1108">2.04</text>
                  <text x="244" y="1108">Token:</text>
                  <text x="292" y="1108">0x8c</text>
                  <text x="240" y="1124">OSCORE:</text>
                  <text x="280" y="1124">-</text>
                  <text x="244" y="1140">0xff</text>
                  <text x="236" y="1156">Payload:</text>
                  <text x="300" y="1156">{Code:</text>
                  <text x="348" y="1156">2.05</text>
                  <text x="412" y="1156">(Content),</text>
                  <text x="304" y="1172">0xff,</text>
                  <text x="296" y="1188">"0"</text>
                  <text x="280" y="1204">}</text>
                  <text x="300" y="1204">//</text>
                  <text x="352" y="1204">Encrypted</text>
                  <text x="412" y="1204">with</text>
                  <text x="464" y="1204">CTX_C_S</text>
                  <text x="32" y="1236">Decrypt</text>
                  <text x="20" y="1252">RESP</text>
                  <text x="60" y="1252">with</text>
                  <text x="32" y="1268">CTX_C_S</text>
                  <text x="28" y="1316">Square</text>
                  <text x="92" y="1316">brackets</text>
                  <text x="136" y="1316">[</text>
                  <text x="160" y="1316">...</text>
                  <text x="184" y="1316">]</text>
                  <text x="228" y="1316">indicate</text>
                  <text x="296" y="1316">content</text>
                  <text x="340" y="1316">of</text>
                  <text x="396" y="1316">compressed</text>
                  <text x="460" y="1316">COSE</text>
                  <text x="512" y="1316">object.</text>
                  <text x="24" y="1332">Curly</text>
                  <text x="84" y="1332">brackets</text>
                  <text x="128" y="1332">{</text>
                  <text x="152" y="1332">...</text>
                  <text x="176" y="1332">}</text>
                  <text x="220" y="1332">indicate</text>
                  <text x="296" y="1332">encrypted</text>
                  <text x="360" y="1332">data.</text>
                </g>
              </svg><a href="#appendix-B.2-3.1.1" class="pilcrow">Â¶</a>
</div>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-use-of-oscore-between-client" class="selfRef">Use of OSCORE between Client-Server and Proxy-Server</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="with-forward-proxy-oscore-c-s-c-p-p-s">
<section id="appendix-B.3">
        <h3 id="name-with-forward-proxy-oscore-c-s">
<a href="#appendix-B.3" class="section-number selfRef">B.3. </a><a href="#name-with-forward-proxy-oscore-c-s" class="section-name selfRef">With Forward-Proxy; OSCORE: C-S, C-P, P-S</a>
        </h3>
<p id="appendix-B.3-1">In the example shown in <a href="#fig-example-client-proxy-server" class="auto internal xref">Figure 3</a>, message exchanges are protected with OSCORE as follows.<a href="#appendix-B.3-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.3-2.1">
            <p id="appendix-B.3-2.1.1">End-to-end between the client and the server, using the OSCORE Security Context CTX_C_S. The client uses the OSCORE Sender ID 0x5f when using OSCORE with the server.<a href="#appendix-B.3-2.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-2.2">
            <p id="appendix-B.3-2.2.1">Between the client and the proxy, using the OSCORE Security Context CTX_C_P. The client uses the OSCORE Sender ID 0x20 when using OSCORE with the proxy.<a href="#appendix-B.3-2.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-2.3">
            <p id="appendix-B.3-2.3.1">Between the proxy and the server, using the OSCORE Security Context CTX_P_S. The proxy uses the OSCORE Sender ID 0xd4 when using OSCORE with the server.<a href="#appendix-B.3-2.3.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<span id="name-use-of-oscore-between-client-"></span><div id="fig-example-client-proxy-server">
<figure id="figure-3">
          <div id="appendix-B.3-3.1">
            <div class="alignLeft art-svg artwork" id="appendix-B.3-3.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="1728" width="544" viewBox="0 0 544 1728" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 24,104 L 24,112" fill="none" stroke="black"></path>
                <path d="M 24,168 L 24,1536" fill="none" stroke="black"></path>
                <path d="M 24,1592 L 24,1600" fill="none" stroke="black"></path>
                <path d="M 24,1656 L 24,1664" fill="none" stroke="black"></path>
                <path d="M 88,48 L 88,400" fill="none" stroke="black"></path>
                <path d="M 88,456 L 88,464" fill="none" stroke="black"></path>
                <path d="M 88,520 L 88,1200" fill="none" stroke="black"></path>
                <path d="M 88,1256 L 88,1264" fill="none" stroke="black"></path>
                <path d="M 88,1320 L 88,1664" fill="none" stroke="black"></path>
                <path d="M 152,48 L 152,736" fill="none" stroke="black"></path>
                <path d="M 152,792 L 152,800" fill="none" stroke="black"></path>
                <path d="M 152,856 L 152,864" fill="none" stroke="black"></path>
                <path d="M 152,920 L 152,928" fill="none" stroke="black"></path>
                <path d="M 152,984 L 152,1664" fill="none" stroke="black"></path>
                <path d="M 24,192 L 80,192" fill="none" stroke="black"></path>
                <path d="M 88,544 L 144,544" fill="none" stroke="black"></path>
                <path d="M 96,1008 L 152,1008" fill="none" stroke="black"></path>
                <path d="M 32,1344 L 88,1344" fill="none" stroke="black"></path>
                <path d="M 264,384 L 272,368" fill="none" stroke="black"></path>
                <path d="M 272,384 L 284,360" fill="none" stroke="black"></path>
                <path d="M 256,720 L 264,704" fill="none" stroke="black"></path>
                <path d="M 264,720 L 276,696" fill="none" stroke="black"></path>
                <path d="M 256,1184 L 264,1168" fill="none" stroke="black"></path>
                <path d="M 264,1184 L 272,1168" fill="none" stroke="black"></path>
                <path d="M 256,1520 L 264,1504" fill="none" stroke="black"></path>
                <path d="M 264,1520 L 272,1504" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="152,544 140,538.4 140,549.6" fill="black" transform="rotate(0,144,544)"></polygon>
                <polygon class="arrowhead" points="104,1008 92,1002.4 92,1013.6" fill="black" transform="rotate(180,96,1008)"></polygon>
                <polygon class="arrowhead" points="88,192 76,186.4 76,197.6" fill="black" transform="rotate(0,80,192)"></polygon>
                <polygon class="arrowhead" points="40,1344 28,1338.4 28,1349.6" fill="black" transform="rotate(180,32,1344)"></polygon>
                <g class="text">
                  <text x="28" y="36">Client</text>
                  <text x="88" y="36">Proxy</text>
                  <text x="148" y="36">Server</text>
                  <text x="24" y="52">|</text>
                  <text x="32" y="68">Encrypt</text>
                  <text x="16" y="84">REQ</text>
                  <text x="52" y="84">with</text>
                  <text x="32" y="100">CTX_C_S</text>
                  <text x="32" y="132">Encrypt</text>
                  <text x="16" y="148">REQ</text>
                  <text x="52" y="148">with</text>
                  <text x="32" y="164">CTX_C_P</text>
                  <text x="216" y="196">Code:</text>
                  <text x="260" y="196">0.02</text>
                  <text x="308" y="196">(POST)</text>
                  <text x="52" y="212">POST</text>
                  <text x="212" y="212">Token:</text>
                  <text x="260" y="212">0x8c</text>
                  <text x="200" y="228">Uri-Host:</text>
                  <text x="300" y="228">"example.com",</text>
                  <text x="208" y="244">OSCORE:</text>
                  <text x="284" y="244">[kid:0x20,</text>
                  <text x="360" y="244">Partial</text>
                  <text x="420" y="244">IV:31]</text>
                  <text x="212" y="260">0xff</text>
                  <text x="204" y="276">Payload:</text>
                  <text x="268" y="276">{Code:</text>
                  <text x="316" y="276">0.02</text>
                  <text x="368" y="276">(POST),</text>
                  <text x="280" y="292">OSCORE:</text>
                  <text x="356" y="292">[kid:0x5f,</text>
                  <text x="432" y="292">Partial</text>
                  <text x="496" y="292">IV:42],</text>
                  <text x="304" y="308">Proxy-Scheme:</text>
                  <text x="392" y="308">"coap",</text>
                  <text x="272" y="324">0xff,</text>
                  <text x="276" y="340">{Code:</text>
                  <text x="324" y="340">0.01</text>
                  <text x="372" y="340">(GET),</text>
                  <text x="296" y="356">Uri-Path:</text>
                  <text x="396" y="356">"alarm_status"</text>
                  <text x="256" y="372">}</text>
                  <text x="328" y="372">Encrypted</text>
                  <text x="388" y="372">with</text>
                  <text x="440" y="372">CTX_C_S</text>
                  <text x="248" y="388">}</text>
                  <text x="320" y="388">Encrypted</text>
                  <text x="380" y="388">with</text>
                  <text x="432" y="388">CTX_C_P</text>
                  <text x="96" y="420">Decrypt</text>
                  <text x="80" y="436">REQ</text>
                  <text x="116" y="436">with</text>
                  <text x="96" y="452">CTX_C_P</text>
                  <text x="96" y="484">Encrypt</text>
                  <text x="80" y="500">REQ</text>
                  <text x="116" y="500">with</text>
                  <text x="96" y="516">CTX_P_S</text>
                  <text x="208" y="548">Code:</text>
                  <text x="252" y="548">0.02</text>
                  <text x="300" y="548">(POST)</text>
                  <text x="116" y="564">POST</text>
                  <text x="204" y="564">Token:</text>
                  <text x="252" y="564">0x7b</text>
                  <text x="200" y="580">OSCORE:</text>
                  <text x="276" y="580">[kid:0xd4,</text>
                  <text x="352" y="580">Partial</text>
                  <text x="412" y="580">IV:53]</text>
                  <text x="204" y="596">0xff</text>
                  <text x="196" y="612">Payload:</text>
                  <text x="260" y="612">{Code:</text>
                  <text x="308" y="612">0.02</text>
                  <text x="360" y="612">(POST),</text>
                  <text x="280" y="628">Uri-Host:</text>
                  <text x="380" y="628">"example.com",</text>
                  <text x="272" y="644">OSCORE:</text>
                  <text x="348" y="644">[kid:0x5f,</text>
                  <text x="424" y="644">Partial</text>
                  <text x="488" y="644">IV:42],</text>
                  <text x="264" y="660">0xff,</text>
                  <text x="268" y="676">{Code:</text>
                  <text x="316" y="676">0.01</text>
                  <text x="364" y="676">(GET),</text>
                  <text x="288" y="692">Uri-Path:</text>
                  <text x="388" y="692">"alarm_status"</text>
                  <text x="248" y="708">}</text>
                  <text x="320" y="708">Encrypted</text>
                  <text x="380" y="708">with</text>
                  <text x="432" y="708">CTX_C_S</text>
                  <text x="240" y="724">}</text>
                  <text x="312" y="724">Encrypted</text>
                  <text x="372" y="724">with</text>
                  <text x="424" y="724">CTX_P_S</text>
                  <text x="160" y="756">Decrypt</text>
                  <text x="144" y="772">REQ</text>
                  <text x="180" y="772">with</text>
                  <text x="160" y="788">CTX_P_S</text>
                  <text x="160" y="820">Decrypt</text>
                  <text x="144" y="836">REQ</text>
                  <text x="180" y="836">with</text>
                  <text x="160" y="852">CTX_C_S</text>
                  <text x="160" y="884">Encrypt</text>
                  <text x="148" y="900">RESP</text>
                  <text x="188" y="900">with</text>
                  <text x="160" y="916">CTX_C_S</text>
                  <text x="160" y="948">Encrypt</text>
                  <text x="148" y="964">RESP</text>
                  <text x="188" y="964">with</text>
                  <text x="160" y="980">CTX_P_S</text>
                  <text x="208" y="1012">Code:</text>
                  <text x="252" y="1012">2.04</text>
                  <text x="312" y="1012">(Changed)</text>
                  <text x="124" y="1028">2.04</text>
                  <text x="204" y="1028">Token:</text>
                  <text x="252" y="1028">0x7b</text>
                  <text x="200" y="1044">OSCORE:</text>
                  <text x="240" y="1044">-</text>
                  <text x="204" y="1060">0xff</text>
                  <text x="196" y="1076">Payload:</text>
                  <text x="260" y="1076">{Code:</text>
                  <text x="308" y="1076">2.04</text>
                  <text x="372" y="1076">(Changed),</text>
                  <text x="272" y="1092">OSCORE:</text>
                  <text x="316" y="1092">-,</text>
                  <text x="264" y="1108">0xff,</text>
                  <text x="268" y="1124">{Code:</text>
                  <text x="316" y="1124">2.05</text>
                  <text x="380" y="1124">(Content),</text>
                  <text x="272" y="1140">0xff,</text>
                  <text x="264" y="1156">"0"</text>
                  <text x="248" y="1172">}</text>
                  <text x="320" y="1172">Encrypted</text>
                  <text x="380" y="1172">with</text>
                  <text x="432" y="1172">CTX_C_S</text>
                  <text x="240" y="1188">}</text>
                  <text x="312" y="1188">Encrypted</text>
                  <text x="372" y="1188">with</text>
                  <text x="424" y="1188">CTX_P_S</text>
                  <text x="96" y="1220">Decrypt</text>
                  <text x="84" y="1236">RESP</text>
                  <text x="124" y="1236">with</text>
                  <text x="96" y="1252">CTX_P_S</text>
                  <text x="96" y="1284">Encrypt</text>
                  <text x="84" y="1300">RESP</text>
                  <text x="124" y="1300">with</text>
                  <text x="96" y="1316">CTX_C_P</text>
                  <text x="208" y="1348">Code:</text>
                  <text x="252" y="1348">2.04</text>
                  <text x="312" y="1348">(Changed)</text>
                  <text x="60" y="1364">2.04</text>
                  <text x="204" y="1364">Token:</text>
                  <text x="252" y="1364">0x8c</text>
                  <text x="200" y="1380">OSCORE:</text>
                  <text x="240" y="1380">-</text>
                  <text x="204" y="1396">0xff</text>
                  <text x="196" y="1412">Payload:</text>
                  <text x="260" y="1412">{Code:</text>
                  <text x="308" y="1412">2.04</text>
                  <text x="372" y="1412">(Changed),</text>
                  <text x="272" y="1428">OSCORE:</text>
                  <text x="316" y="1428">-,</text>
                  <text x="264" y="1444">0xff,</text>
                  <text x="268" y="1460">{Code:</text>
                  <text x="316" y="1460">2.05</text>
                  <text x="380" y="1460">(Content),</text>
                  <text x="272" y="1476">0xff,</text>
                  <text x="264" y="1492">"0"</text>
                  <text x="248" y="1508">}</text>
                  <text x="320" y="1508">Encrypted</text>
                  <text x="380" y="1508">with</text>
                  <text x="432" y="1508">CTX_C_S</text>
                  <text x="240" y="1524">}</text>
                  <text x="312" y="1524">Encrypted</text>
                  <text x="372" y="1524">with</text>
                  <text x="424" y="1524">CTX_C_P</text>
                  <text x="32" y="1556">Decrypt</text>
                  <text x="20" y="1572">RESP</text>
                  <text x="60" y="1572">with</text>
                  <text x="32" y="1588">CTX_C_P</text>
                  <text x="32" y="1620">Decrypt</text>
                  <text x="20" y="1636">RESP</text>
                  <text x="60" y="1636">with</text>
                  <text x="32" y="1652">CTX_C_S</text>
                  <text x="28" y="1700">Square</text>
                  <text x="92" y="1700">brackets</text>
                  <text x="136" y="1700">[</text>
                  <text x="160" y="1700">...</text>
                  <text x="184" y="1700">]</text>
                  <text x="228" y="1700">indicate</text>
                  <text x="296" y="1700">content</text>
                  <text x="340" y="1700">of</text>
                  <text x="396" y="1700">compressed</text>
                  <text x="460" y="1700">COSE</text>
                  <text x="512" y="1700">object.</text>
                  <text x="24" y="1716">Curly</text>
                  <text x="84" y="1716">brackets</text>
                  <text x="128" y="1716">{</text>
                  <text x="152" y="1716">...</text>
                  <text x="176" y="1716">}</text>
                  <text x="220" y="1716">indicate</text>
                  <text x="296" y="1716">encrypted</text>
                  <text x="360" y="1716">data.</text>
                </g>
              </svg><a href="#appendix-B.3-3.1.1" class="pilcrow">Â¶</a>
</div>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-use-of-oscore-between-client-" class="selfRef">Use of OSCORE between Client-Server, Client-Proxy, and Proxy-Server</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sec-example-edhoc">
<section id="appendix-B.4">
        <h3 id="name-with-forward-proxy-and-edho">
<a href="#appendix-B.4" class="section-number selfRef">B.4. </a><a href="#name-with-forward-proxy-and-edho" class="section-name selfRef">With Forward-Proxy and EDHOC; OSCORE: C-S, C-P</a>
        </h3>
<p id="appendix-B.4-1">In the example shown in <a href="#fig-example-edhoc" class="auto internal xref">Figure 4</a>, message exchanges are protected as follows.<a href="#appendix-B.4-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.4-2.1">
            <p id="appendix-B.4-2.1.1">End-to-end, between the client and the server, using the OSCORE Security Context CTX_C_S. The client uses the OSCORE Sender ID 0x5f when using OSCORE with the server.<a href="#appendix-B.4-2.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-B.4-2.2">
            <p id="appendix-B.4-2.2.1">Between the client and the proxy, using the OSCORE Security Context CTX_C_P. The client uses the OSCORE Sender ID 0x20 when using OSCORE with the proxy.<a href="#appendix-B.4-2.2.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<p id="appendix-B.4-3">The example also shows how the client establishes the OSCORE Security Contexts CTX_C_P with the proxy and CTX_C_S with the server, by using the key exchange protocol EDHOC <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>.<a href="#appendix-B.4-3" class="pilcrow">Â¶</a></p>
<span id="name-use-of-oscore-between-client-s"></span><div id="fig-example-edhoc">
<figure id="figure-4">
          <div id="appendix-B.4-4.1">
            <div class="alignLeft art-svg artwork" id="appendix-B.4-4.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="3312" width="544" viewBox="0 0 544 3312" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 24,48 L 24,240" fill="none" stroke="black"></path>
                <path d="M 24,280 L 24,496" fill="none" stroke="black"></path>
                <path d="M 24,552 L 24,1248" fill="none" stroke="black"></path>
                <path d="M 24,1304 L 24,1312" fill="none" stroke="black"></path>
                <path d="M 24,1352 L 24,1360" fill="none" stroke="black"></path>
                <path d="M 24,1416 L 24,1968" fill="none" stroke="black"></path>
                <path d="M 24,2024 L 24,2032" fill="none" stroke="black"></path>
                <path d="M 24,2088 L 24,3072" fill="none" stroke="black"></path>
                <path d="M 24,3128 L 24,3136" fill="none" stroke="black"></path>
                <path d="M 24,3192 L 24,3200" fill="none" stroke="black"></path>
                <path d="M 88,48 L 88,400" fill="none" stroke="black"></path>
                <path d="M 88,440 L 88,768" fill="none" stroke="black"></path>
                <path d="M 88,824 L 88,1040" fill="none" stroke="black"></path>
                <path d="M 88,1096 L 88,1632" fill="none" stroke="black"></path>
                <path d="M 88,1688 L 88,2320" fill="none" stroke="black"></path>
                <path d="M 88,2376 L 88,2800" fill="none" stroke="black"></path>
                <path d="M 88,2856 L 88,3200" fill="none" stroke="black"></path>
                <path d="M 152,48 L 152,1824" fill="none" stroke="black"></path>
                <path d="M 152,1864 L 152,2528" fill="none" stroke="black"></path>
                <path d="M 152,2584 L 152,2592" fill="none" stroke="black"></path>
                <path d="M 152,2648 L 152,3200" fill="none" stroke="black"></path>
                <path d="M 24,64 L 80,64" fill="none" stroke="black"></path>
                <path d="M 32,176 L 88,176" fill="none" stroke="black"></path>
                <path d="M 24,304 L 80,304" fill="none" stroke="black"></path>
                <path d="M 32,464 L 88,464" fill="none" stroke="black"></path>
                <path d="M 24,576 L 80,576" fill="none" stroke="black"></path>
                <path d="M 88,848 L 144,848" fill="none" stroke="black"></path>
                <path d="M 96,976 L 152,976" fill="none" stroke="black"></path>
                <path d="M 32,1120 L 88,1120" fill="none" stroke="black"></path>
                <path d="M 24,1440 L 80,1440" fill="none" stroke="black"></path>
                <path d="M 88,1712 L 144,1712" fill="none" stroke="black"></path>
                <path d="M 96,1888 L 152,1888" fill="none" stroke="black"></path>
                <path d="M 32,1936 L 88,1936" fill="none" stroke="black"></path>
                <path d="M 24,2112 L 80,2112" fill="none" stroke="black"></path>
                <path d="M 88,2400 L 144,2400" fill="none" stroke="black"></path>
                <path d="M 96,2672 L 152,2672" fill="none" stroke="black"></path>
                <path d="M 32,2880 L 88,2880" fill="none" stroke="black"></path>
                <path d="M 264,1616 L 268,1608" fill="none" stroke="black"></path>
                <path d="M 264,2304 L 272,2288" fill="none" stroke="black"></path>
                <path d="M 272,2304 L 284,2280" fill="none" stroke="black"></path>
                <path d="M 264,3056 L 272,3040" fill="none" stroke="black"></path>
                <path d="M 272,3056 L 280,3040" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="152,2400 140,2394.4 140,2405.6" fill="black" transform="rotate(0,144,2400)"></polygon>
                <polygon class="arrowhead" points="152,1712 140,1706.4 140,1717.6" fill="black" transform="rotate(0,144,1712)"></polygon>
                <polygon class="arrowhead" points="152,848 140,842.4 140,853.6" fill="black" transform="rotate(0,144,848)"></polygon>
                <polygon class="arrowhead" points="104,2672 92,2666.4 92,2677.6" fill="black" transform="rotate(180,96,2672)"></polygon>
                <polygon class="arrowhead" points="104,1888 92,1882.4 92,1893.6" fill="black" transform="rotate(180,96,1888)"></polygon>
                <polygon class="arrowhead" points="104,976 92,970.4 92,981.6" fill="black" transform="rotate(180,96,976)"></polygon>
                <polygon class="arrowhead" points="88,2112 76,2106.4 76,2117.6" fill="black" transform="rotate(0,80,2112)"></polygon>
                <polygon class="arrowhead" points="88,1440 76,1434.4 76,1445.6" fill="black" transform="rotate(0,80,1440)"></polygon>
                <polygon class="arrowhead" points="88,576 76,570.4 76,581.6" fill="black" transform="rotate(0,80,576)"></polygon>
                <polygon class="arrowhead" points="88,304 76,298.4 76,309.6" fill="black" transform="rotate(0,80,304)"></polygon>
                <polygon class="arrowhead" points="88,64 76,58.4 76,69.6" fill="black" transform="rotate(0,80,64)"></polygon>
                <polygon class="arrowhead" points="40,2880 28,2874.4 28,2885.6" fill="black" transform="rotate(180,32,2880)"></polygon>
                <polygon class="arrowhead" points="40,1936 28,1930.4 28,1941.6" fill="black" transform="rotate(180,32,1936)"></polygon>
                <polygon class="arrowhead" points="40,1120 28,1114.4 28,1125.6" fill="black" transform="rotate(180,32,1120)"></polygon>
                <polygon class="arrowhead" points="40,464 28,458.4 28,469.6" fill="black" transform="rotate(180,32,464)"></polygon>
                <polygon class="arrowhead" points="40,176 28,170.4 28,181.6" fill="black" transform="rotate(180,32,176)"></polygon>
                <g class="text">
                  <text x="28" y="36">Client</text>
                  <text x="88" y="36">Proxy</text>
                  <text x="148" y="36">Server</text>
                  <text x="216" y="68">Code:</text>
                  <text x="260" y="68">0.02</text>
                  <text x="308" y="68">(POST)</text>
                  <text x="52" y="84">POST</text>
                  <text x="212" y="84">Token:</text>
                  <text x="260" y="84">0xf3</text>
                  <text x="200" y="100">Uri-Path:</text>
                  <text x="296" y="100">".well-known"</text>
                  <text x="200" y="116">Uri-Path:</text>
                  <text x="272" y="116">"edhoc"</text>
                  <text x="212" y="132">0xff</text>
                  <text x="204" y="148">Payload:</text>
                  <text x="268" y="148">(true,</text>
                  <text x="320" y="148">EDHOC</text>
                  <text x="388" y="148">message_1)</text>
                  <text x="216" y="180">Code:</text>
                  <text x="260" y="180">2.04</text>
                  <text x="320" y="180">(Changed)</text>
                  <text x="60" y="196">2.04</text>
                  <text x="212" y="196">Token:</text>
                  <text x="260" y="196">0xf3</text>
                  <text x="212" y="212">0xff</text>
                  <text x="204" y="228">Payload:</text>
                  <text x="264" y="228">EDHOC</text>
                  <text x="328" y="228">message_2</text>
                  <text x="40" y="260">Establish</text>
                  <text x="32" y="276">CTX_C_P</text>
                  <text x="216" y="308">Code:</text>
                  <text x="260" y="308">0.02</text>
                  <text x="308" y="308">(POST)</text>
                  <text x="52" y="324">POST</text>
                  <text x="212" y="324">Token:</text>
                  <text x="260" y="324">0x82</text>
                  <text x="200" y="340">Uri-Path:</text>
                  <text x="296" y="340">".well-known"</text>
                  <text x="200" y="356">Uri-Path:</text>
                  <text x="272" y="356">"edhoc"</text>
                  <text x="212" y="372">0xff</text>
                  <text x="204" y="388">Payload:</text>
                  <text x="264" y="388">(C_R,</text>
                  <text x="312" y="388">EDHOC</text>
                  <text x="380" y="388">message_3)</text>
                  <text x="104" y="420">Establish</text>
                  <text x="96" y="436">CTX_C_P</text>
                  <text x="56" y="484">ACK</text>
                  <text x="32" y="516">Encrypt</text>
                  <text x="16" y="532">REQ</text>
                  <text x="52" y="532">with</text>
                  <text x="32" y="548">CTX_C_P</text>
                  <text x="216" y="580">Code:</text>
                  <text x="260" y="580">0.02</text>
                  <text x="308" y="580">(POST)</text>
                  <text x="52" y="596">POST</text>
                  <text x="212" y="596">Token:</text>
                  <text x="260" y="596">0xbe</text>
                  <text x="208" y="612">OSCORE:</text>
                  <text x="284" y="612">[kid:0x20,</text>
                  <text x="360" y="612">Partial</text>
                  <text x="416" y="612">IV:0]</text>
                  <text x="212" y="628">0xff</text>
                  <text x="204" y="644">Payload:</text>
                  <text x="268" y="644">{Code:</text>
                  <text x="316" y="644">0.02</text>
                  <text x="368" y="644">(POST),</text>
                  <text x="288" y="660">Uri-Host:</text>
                  <text x="388" y="660">"example.com",</text>
                  <text x="288" y="676">Uri-Path:</text>
                  <text x="388" y="676">".well-known",</text>
                  <text x="288" y="692">Uri-Path:</text>
                  <text x="364" y="692">"edhoc",</text>
                  <text x="304" y="708">Proxy-Scheme:</text>
                  <text x="392" y="708">"coap",</text>
                  <text x="272" y="724">0xff,</text>
                  <text x="276" y="740">(true,</text>
                  <text x="328" y="740">EDHOC</text>
                  <text x="396" y="740">message_1)</text>
                  <text x="248" y="756">}</text>
                  <text x="268" y="756">//</text>
                  <text x="320" y="756">Encrypted</text>
                  <text x="380" y="756">with</text>
                  <text x="432" y="756">CTX_C_P</text>
                  <text x="96" y="788">Decrypt</text>
                  <text x="80" y="804">REQ</text>
                  <text x="116" y="804">with</text>
                  <text x="96" y="820">CTX_C_P</text>
                  <text x="216" y="852">Code:</text>
                  <text x="260" y="852">0.02</text>
                  <text x="308" y="852">(POST)</text>
                  <text x="116" y="868">POST</text>
                  <text x="212" y="868">Token:</text>
                  <text x="260" y="868">0xa5</text>
                  <text x="200" y="884">Uri-Host:</text>
                  <text x="300" y="884">"example.com",</text>
                  <text x="200" y="900">Uri-Path:</text>
                  <text x="296" y="900">".well-known"</text>
                  <text x="200" y="916">Uri-Path:</text>
                  <text x="272" y="916">"edhoc"</text>
                  <text x="212" y="932">0xff</text>
                  <text x="204" y="948">Payload:</text>
                  <text x="268" y="948">(true,</text>
                  <text x="320" y="948">EDHOC</text>
                  <text x="388" y="948">message_1)</text>
                  <text x="216" y="980">Code:</text>
                  <text x="260" y="980">2.04</text>
                  <text x="320" y="980">(Changed)</text>
                  <text x="124" y="996">2.04</text>
                  <text x="212" y="996">Token:</text>
                  <text x="260" y="996">0xa5</text>
                  <text x="212" y="1012">0xff</text>
                  <text x="204" y="1028">Payload:</text>
                  <text x="264" y="1028">EDHOC</text>
                  <text x="328" y="1028">message_2</text>
                  <text x="96" y="1060">Encrypt</text>
                  <text x="84" y="1076">RESP</text>
                  <text x="124" y="1076">with</text>
                  <text x="96" y="1092">CTX_C_P</text>
                  <text x="216" y="1124">Code:</text>
                  <text x="260" y="1124">2.04</text>
                  <text x="320" y="1124">(Changed)</text>
                  <text x="60" y="1140">2.04</text>
                  <text x="212" y="1140">Token:</text>
                  <text x="260" y="1140">0xbe</text>
                  <text x="208" y="1156">OSCORE:</text>
                  <text x="248" y="1156">-</text>
                  <text x="212" y="1172">0xff</text>
                  <text x="204" y="1188">Payload:</text>
                  <text x="268" y="1188">{Code:</text>
                  <text x="316" y="1188">2.04</text>
                  <text x="380" y="1188">(Changed),</text>
                  <text x="272" y="1204">0xff,</text>
                  <text x="272" y="1220">EDHOC</text>
                  <text x="336" y="1220">message_2</text>
                  <text x="248" y="1236">}</text>
                  <text x="268" y="1236">//</text>
                  <text x="320" y="1236">Encrypted</text>
                  <text x="380" y="1236">with</text>
                  <text x="432" y="1236">CTX_C_P</text>
                  <text x="32" y="1268">Decrypt</text>
                  <text x="20" y="1284">RESP</text>
                  <text x="60" y="1284">with</text>
                  <text x="32" y="1300">CTX_C_P</text>
                  <text x="40" y="1332">Establish</text>
                  <text x="32" y="1348">CTX_C_S</text>
                  <text x="32" y="1380">Encrypt</text>
                  <text x="16" y="1396">REQ</text>
                  <text x="52" y="1396">with</text>
                  <text x="32" y="1412">CTX_C_P</text>
                  <text x="216" y="1444">Code:</text>
                  <text x="260" y="1444">0.02</text>
                  <text x="308" y="1444">(POST)</text>
                  <text x="52" y="1460">POST</text>
                  <text x="212" y="1460">Token:</text>
                  <text x="260" y="1460">0xb9</text>
                  <text x="208" y="1476">OSCORE:</text>
                  <text x="284" y="1476">[kid:0x20,</text>
                  <text x="360" y="1476">Partial</text>
                  <text x="416" y="1476">IV:1]</text>
                  <text x="212" y="1492">0xff</text>
                  <text x="204" y="1508">Payload:</text>
                  <text x="268" y="1508">{Code:</text>
                  <text x="316" y="1508">0.02</text>
                  <text x="368" y="1508">(POST),</text>
                  <text x="288" y="1524">Uri-Host:</text>
                  <text x="388" y="1524">"example.com",</text>
                  <text x="288" y="1540">Uri-Path:</text>
                  <text x="388" y="1540">".well-known",</text>
                  <text x="288" y="1556">Uri-Path:</text>
                  <text x="364" y="1556">"edhoc",</text>
                  <text x="304" y="1572">Proxy-Scheme:</text>
                  <text x="392" y="1572">"coap",</text>
                  <text x="272" y="1588">0xff,</text>
                  <text x="272" y="1604">(C_R,</text>
                  <text x="320" y="1604">EDHOC</text>
                  <text x="388" y="1604">message_3)</text>
                  <text x="248" y="1620">}</text>
                  <text x="272" y="1620">/</text>
                  <text x="320" y="1620">Encrypted</text>
                  <text x="380" y="1620">with</text>
                  <text x="432" y="1620">CTX_C_P</text>
                  <text x="96" y="1652">Decrypt</text>
                  <text x="80" y="1668">REQ</text>
                  <text x="116" y="1668">with</text>
                  <text x="96" y="1684">CTX_C_P</text>
                  <text x="216" y="1716">Code:</text>
                  <text x="260" y="1716">0.02</text>
                  <text x="308" y="1716">(POST)</text>
                  <text x="116" y="1732">POST</text>
                  <text x="212" y="1732">Token:</text>
                  <text x="260" y="1732">0xdd</text>
                  <text x="200" y="1748">Uri-Host:</text>
                  <text x="300" y="1748">"example.com",</text>
                  <text x="200" y="1764">Uri-Path:</text>
                  <text x="296" y="1764">".well-known"</text>
                  <text x="200" y="1780">Uri-Path:</text>
                  <text x="272" y="1780">"edhoc"</text>
                  <text x="212" y="1796">0xff</text>
                  <text x="204" y="1812">Payload:</text>
                  <text x="264" y="1812">(C_R,</text>
                  <text x="312" y="1812">EDHOC</text>
                  <text x="380" y="1812">message_3)</text>
                  <text x="168" y="1844">Establish</text>
                  <text x="160" y="1860">CTX_C_S</text>
                  <text x="120" y="1908">ACK</text>
                  <text x="56" y="1956">ACK</text>
                  <text x="32" y="1988">Encrypt</text>
                  <text x="16" y="2004">REQ</text>
                  <text x="52" y="2004">with</text>
                  <text x="32" y="2020">CTX_C_S</text>
                  <text x="32" y="2052">Encrypt</text>
                  <text x="16" y="2068">REQ</text>
                  <text x="52" y="2068">with</text>
                  <text x="32" y="2084">CTX_C_P</text>
                  <text x="216" y="2116">Code:</text>
                  <text x="260" y="2116">0.02</text>
                  <text x="308" y="2116">(POST)</text>
                  <text x="52" y="2132">POST</text>
                  <text x="212" y="2132">Token:</text>
                  <text x="260" y="2132">0x8c</text>
                  <text x="208" y="2148">OSCORE:</text>
                  <text x="284" y="2148">[kid:0x20,</text>
                  <text x="360" y="2148">Partial</text>
                  <text x="416" y="2148">IV:2]</text>
                  <text x="212" y="2164">0xff</text>
                  <text x="204" y="2180">Payload:</text>
                  <text x="268" y="2180">{Code:</text>
                  <text x="316" y="2180">0.02</text>
                  <text x="368" y="2180">(POST),</text>
                  <text x="280" y="2196">OSCORE:</text>
                  <text x="356" y="2196">[kid:0x5f,</text>
                  <text x="432" y="2196">Partial</text>
                  <text x="492" y="2196">IV:0],</text>
                  <text x="288" y="2212">Uri-Host:</text>
                  <text x="388" y="2212">"example.com",</text>
                  <text x="304" y="2228">Proxy-Scheme:</text>
                  <text x="392" y="2228">"coap",</text>
                  <text x="272" y="2244">0xff,</text>
                  <text x="276" y="2260">{Code:</text>
                  <text x="324" y="2260">0.01</text>
                  <text x="372" y="2260">(GET),</text>
                  <text x="296" y="2276">Uri-Path:</text>
                  <text x="396" y="2276">"alarm_status"</text>
                  <text x="256" y="2292">}</text>
                  <text x="328" y="2292">Encrypted</text>
                  <text x="388" y="2292">with</text>
                  <text x="440" y="2292">CTX_C_S</text>
                  <text x="248" y="2308">}</text>
                  <text x="320" y="2308">Encrypted</text>
                  <text x="380" y="2308">with</text>
                  <text x="432" y="2308">CTX_C_P</text>
                  <text x="96" y="2340">Decrypt</text>
                  <text x="80" y="2356">REQ</text>
                  <text x="116" y="2356">with</text>
                  <text x="96" y="2372">CTX_C_P</text>
                  <text x="216" y="2404">Code:</text>
                  <text x="260" y="2404">0.02</text>
                  <text x="308" y="2404">(POST)</text>
                  <text x="116" y="2420">POST</text>
                  <text x="212" y="2420">Token:</text>
                  <text x="260" y="2420">0x7b</text>
                  <text x="200" y="2436">Uri-Host:</text>
                  <text x="300" y="2436">"example.com",</text>
                  <text x="208" y="2452">OSCORE:</text>
                  <text x="284" y="2452">[kid:0x5f,</text>
                  <text x="360" y="2452">Partial</text>
                  <text x="416" y="2452">IV:0]</text>
                  <text x="212" y="2468">0xff</text>
                  <text x="204" y="2484">Payload:</text>
                  <text x="268" y="2484">{Code:</text>
                  <text x="316" y="2484">0.01</text>
                  <text x="364" y="2484">(GET),</text>
                  <text x="288" y="2500">Uri-Path:</text>
                  <text x="388" y="2500">"alarm_status"</text>
                  <text x="248" y="2516">}</text>
                  <text x="268" y="2516">//</text>
                  <text x="320" y="2516">Encrypted</text>
                  <text x="380" y="2516">with</text>
                  <text x="432" y="2516">CTX_C_S</text>
                  <text x="160" y="2548">Decrypt</text>
                  <text x="144" y="2564">REQ</text>
                  <text x="180" y="2564">with</text>
                  <text x="160" y="2580">CTX_C_S</text>
                  <text x="160" y="2612">Encrypt</text>
                  <text x="148" y="2628">RESP</text>
                  <text x="188" y="2628">with</text>
                  <text x="160" y="2644">CTX_C_S</text>
                  <text x="216" y="2676">Code:</text>
                  <text x="260" y="2676">2.04</text>
                  <text x="320" y="2676">(Changed)</text>
                  <text x="124" y="2692">2.04</text>
                  <text x="212" y="2692">Token:</text>
                  <text x="260" y="2692">0x7b</text>
                  <text x="208" y="2708">OSCORE:</text>
                  <text x="248" y="2708">-</text>
                  <text x="212" y="2724">0xff</text>
                  <text x="204" y="2740">Payload:</text>
                  <text x="268" y="2740">{Code:</text>
                  <text x="316" y="2740">2.05</text>
                  <text x="380" y="2740">(Content),</text>
                  <text x="272" y="2756">0xff,</text>
                  <text x="264" y="2772">"0"</text>
                  <text x="248" y="2788">}</text>
                  <text x="268" y="2788">//</text>
                  <text x="320" y="2788">Encrypted</text>
                  <text x="380" y="2788">with</text>
                  <text x="432" y="2788">CTX_C_S</text>
                  <text x="96" y="2820">Encrypt</text>
                  <text x="84" y="2836">RESP</text>
                  <text x="124" y="2836">with</text>
                  <text x="96" y="2852">CTX_C_P</text>
                  <text x="216" y="2884">Code:</text>
                  <text x="260" y="2884">2.04</text>
                  <text x="320" y="2884">(Changed)</text>
                  <text x="60" y="2900">2.04</text>
                  <text x="212" y="2900">Token:</text>
                  <text x="260" y="2900">0x8c</text>
                  <text x="208" y="2916">OSCORE:</text>
                  <text x="248" y="2916">-</text>
                  <text x="212" y="2932">0xff</text>
                  <text x="204" y="2948">Payload:</text>
                  <text x="268" y="2948">{Code:</text>
                  <text x="316" y="2948">2.04</text>
                  <text x="380" y="2948">(Changed),</text>
                  <text x="280" y="2964">OSCORE:</text>
                  <text x="324" y="2964">-,</text>
                  <text x="272" y="2980">0xff,</text>
                  <text x="276" y="2996">{Code:</text>
                  <text x="324" y="2996">2.05</text>
                  <text x="388" y="2996">(Content),</text>
                  <text x="280" y="3012">0xff,</text>
                  <text x="272" y="3028">"0"</text>
                  <text x="256" y="3044">}</text>
                  <text x="328" y="3044">Encrypted</text>
                  <text x="388" y="3044">with</text>
                  <text x="440" y="3044">CTX_C_S</text>
                  <text x="248" y="3060">}</text>
                  <text x="320" y="3060">Encrypted</text>
                  <text x="380" y="3060">with</text>
                  <text x="432" y="3060">CTX_C_P</text>
                  <text x="32" y="3092">Decrypt</text>
                  <text x="20" y="3108">RESP</text>
                  <text x="60" y="3108">with</text>
                  <text x="32" y="3124">CTX_C_P</text>
                  <text x="32" y="3156">Decrypt</text>
                  <text x="20" y="3172">RESP</text>
                  <text x="60" y="3172">with</text>
                  <text x="32" y="3188">CTX_C_S</text>
                  <text x="28" y="3236">Square</text>
                  <text x="92" y="3236">brackets</text>
                  <text x="136" y="3236">[</text>
                  <text x="160" y="3236">...</text>
                  <text x="184" y="3236">]</text>
                  <text x="228" y="3236">indicate</text>
                  <text x="296" y="3236">content</text>
                  <text x="340" y="3236">of</text>
                  <text x="396" y="3236">compressed</text>
                  <text x="460" y="3236">COSE</text>
                  <text x="512" y="3236">object.</text>
                  <text x="24" y="3252">Curly</text>
                  <text x="84" y="3252">brackets</text>
                  <text x="128" y="3252">{</text>
                  <text x="152" y="3252">...</text>
                  <text x="176" y="3252">}</text>
                  <text x="220" y="3252">indicate</text>
                  <text x="296" y="3252">encrypted</text>
                  <text x="360" y="3252">data.</text>
                  <text x="16" y="3284">(A,</text>
                  <text x="44" y="3284">B)</text>
                  <text x="96" y="3284">indicates</text>
                  <text x="144" y="3284">a</text>
                  <text x="172" y="3284">CBOR</text>
                  <text x="228" y="3284">sequence</text>
                  <text x="304" y="3284">[RFC8742]</text>
                  <text x="68" y="3300">of</text>
                  <text x="96" y="3300">two</text>
                  <text x="132" y="3300">CBOR</text>
                  <text x="172" y="3300">data</text>
                  <text x="216" y="3300">items</text>
                  <text x="248" y="3300">A</text>
                  <text x="272" y="3300">and</text>
                  <text x="300" y="3300">B.</text>
                </g>
              </svg><a href="#appendix-B.4-4.1.1" class="pilcrow">Â¶</a>
</div>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-use-of-oscore-between-client-s" class="selfRef">Use of OSCORE between Client-Server and Proxy-Server, with OSCORE Security Contexts established through EDHOC</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sec-example-edhoc-comb-req">
<section id="appendix-B.5">
        <h3 id="name-with-forward-proxy-and-edhoc">
<a href="#appendix-B.5" class="section-number selfRef">B.5. </a><a href="#name-with-forward-proxy-and-edhoc" class="section-name selfRef">With Forward-Proxy and EDHOC (optimized); OSCORE: C-S, C-P</a>
        </h3>
<p id="appendix-B.5-1">In the example shown in <a href="#fig-example-edhoc-comb-req" class="auto internal xref">Figure 5</a>, message exchanges are protected as follows.<a href="#appendix-B.5-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.5-2.1">
            <p id="appendix-B.5-2.1.1">End-to-end, between the client and the server, using the OSCORE Security Context CTX_C_S. The client uses the OSCORE Sender ID 0x5f when using OSCORE with the server.<a href="#appendix-B.5-2.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-B.5-2.2">
            <p id="appendix-B.5-2.2.1">Between the client and the proxy, using the OSCORE Security Context CTX_C_P. The client uses the OSCORE Sender ID 0x20 when using OSCORE with the proxy.<a href="#appendix-B.5-2.2.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<p id="appendix-B.5-3">The example also shows how the client establishes the OSCORE Security Contexts CTX_C_P with the proxy and CTX_C_S with the server, by using the key exchange protocol EDHOC <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>.<a href="#appendix-B.5-3" class="pilcrow">Â¶</a></p>
<p id="appendix-B.5-4">In particular, the client relies on the EDHOC + OSCORE request defined in <span>[<a href="#RFC9668" class="cite xref">RFC9668</a>]</span> and denoted as COMB_REQ, in order to transport the last EDHOC message_3 and the first OSCORE-protected application CoAP request combined together.<a href="#appendix-B.5-4" class="pilcrow">Â¶</a></p>
<span id="name-use-of-oscore-between-client-se"></span><div id="fig-example-edhoc-comb-req">
<figure id="figure-5">
          <div id="appendix-B.5-5.1">
            <div class="alignLeft art-svg artwork" id="appendix-B.5-5.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="3040" width="544" viewBox="0 0 544 3040" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 24,48 L 24,240" fill="none" stroke="black"></path>
                <path d="M 24,280 L 24,288" fill="none" stroke="black"></path>
                <path d="M 24,344 L 24,352" fill="none" stroke="black"></path>
                <path d="M 24,432 L 24,1264" fill="none" stroke="black"></path>
                <path d="M 24,1320 L 24,1328" fill="none" stroke="black"></path>
                <path d="M 24,1368 L 24,1376" fill="none" stroke="black"></path>
                <path d="M 24,1432 L 24,1440" fill="none" stroke="black"></path>
                <path d="M 24,1592 L 24,2800" fill="none" stroke="black"></path>
                <path d="M 24,2856 L 24,2864" fill="none" stroke="black"></path>
                <path d="M 24,2920 L 24,2928" fill="none" stroke="black"></path>
                <path d="M 88,48 L 88,672" fill="none" stroke="black"></path>
                <path d="M 88,712 L 88,720" fill="none" stroke="black"></path>
                <path d="M 88,840 L 88,1056" fill="none" stroke="black"></path>
                <path d="M 88,1112 L 88,1872" fill="none" stroke="black"></path>
                <path d="M 88,1944 L 88,2528" fill="none" stroke="black"></path>
                <path d="M 88,2584 L 88,2928" fill="none" stroke="black"></path>
                <path d="M 152,48 L 152,2144" fill="none" stroke="black"></path>
                <path d="M 152,2184 L 152,2192" fill="none" stroke="black"></path>
                <path d="M 152,2312 L 152,2320" fill="none" stroke="black"></path>
                <path d="M 152,2376 L 152,2928" fill="none" stroke="black"></path>
                <path d="M 24,64 L 80,64" fill="none" stroke="black"></path>
                <path d="M 32,176 L 88,176" fill="none" stroke="black"></path>
                <path d="M 24,448 L 80,448" fill="none" stroke="black"></path>
                <path d="M 88,864 L 144,864" fill="none" stroke="black"></path>
                <path d="M 96,992 L 152,992" fill="none" stroke="black"></path>
                <path d="M 32,1136 L 88,1136" fill="none" stroke="black"></path>
                <path d="M 24,1616 L 80,1616" fill="none" stroke="black"></path>
                <path d="M 88,1968 L 144,1968" fill="none" stroke="black"></path>
                <path d="M 96,2400 L 152,2400" fill="none" stroke="black"></path>
                <path d="M 32,2608 L 88,2608" fill="none" stroke="black"></path>
                <path d="M 264,1856 L 272,1840" fill="none" stroke="black"></path>
                <path d="M 272,1856 L 284,1832" fill="none" stroke="black"></path>
                <path d="M 264,2784 L 272,2768" fill="none" stroke="black"></path>
                <path d="M 272,2784 L 280,2768" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="152,1968 140,1962.4 140,1973.6" fill="black" transform="rotate(0,144,1968)"></polygon>
                <polygon class="arrowhead" points="152,864 140,858.4 140,869.6" fill="black" transform="rotate(0,144,864)"></polygon>
                <polygon class="arrowhead" points="104,2400 92,2394.4 92,2405.6" fill="black" transform="rotate(180,96,2400)"></polygon>
                <polygon class="arrowhead" points="104,992 92,986.4 92,997.6" fill="black" transform="rotate(180,96,992)"></polygon>
                <polygon class="arrowhead" points="88,1616 76,1610.4 76,1621.6" fill="black" transform="rotate(0,80,1616)"></polygon>
                <polygon class="arrowhead" points="88,448 76,442.4 76,453.6" fill="black" transform="rotate(0,80,448)"></polygon>
                <polygon class="arrowhead" points="88,64 76,58.4 76,69.6" fill="black" transform="rotate(0,80,64)"></polygon>
                <polygon class="arrowhead" points="40,2608 28,2602.4 28,2613.6" fill="black" transform="rotate(180,32,2608)"></polygon>
                <polygon class="arrowhead" points="40,1136 28,1130.4 28,1141.6" fill="black" transform="rotate(180,32,1136)"></polygon>
                <polygon class="arrowhead" points="40,176 28,170.4 28,181.6" fill="black" transform="rotate(180,32,176)"></polygon>
                <g class="text">
                  <text x="28" y="36">Client</text>
                  <text x="88" y="36">Proxy</text>
                  <text x="148" y="36">Server</text>
                  <text x="216" y="68">Code:</text>
                  <text x="260" y="68">0.02</text>
                  <text x="308" y="68">(POST)</text>
                  <text x="52" y="84">POST</text>
                  <text x="212" y="84">Token:</text>
                  <text x="260" y="84">0xf3</text>
                  <text x="200" y="100">Uri-Path:</text>
                  <text x="296" y="100">".well-known"</text>
                  <text x="200" y="116">Uri-Path:</text>
                  <text x="272" y="116">"edhoc"</text>
                  <text x="212" y="132">0xff</text>
                  <text x="204" y="148">Payload:</text>
                  <text x="268" y="148">(true,</text>
                  <text x="320" y="148">EDHOC</text>
                  <text x="388" y="148">message_1)</text>
                  <text x="208" y="180">Code:</text>
                  <text x="252" y="180">2.04</text>
                  <text x="312" y="180">(Changed)</text>
                  <text x="60" y="196">2.04</text>
                  <text x="204" y="196">Token:</text>
                  <text x="252" y="196">0xf3</text>
                  <text x="204" y="212">0xff</text>
                  <text x="196" y="228">Payload:</text>
                  <text x="256" y="228">EDHOC</text>
                  <text x="320" y="228">message_2</text>
                  <text x="40" y="260">Establish</text>
                  <text x="32" y="276">CTX_C_P</text>
                  <text x="32" y="308">Encrypt</text>
                  <text x="16" y="324">REQ</text>
                  <text x="52" y="324">with</text>
                  <text x="32" y="340">CTX_C_P</text>
                  <text x="32" y="372">Prepare</text>
                  <text x="36" y="388">COMB_REQ</text>
                  <text x="16" y="404">for</text>
                  <text x="40" y="404">P</text>
                  <text x="20" y="420">from</text>
                  <text x="56" y="420">REQ</text>
                  <text x="216" y="452">Code:</text>
                  <text x="260" y="452">0.02</text>
                  <text x="308" y="452">(POST)</text>
                  <text x="52" y="468">POST</text>
                  <text x="212" y="468">Token:</text>
                  <text x="260" y="468">0x82</text>
                  <text x="208" y="484">OSCORE:</text>
                  <text x="284" y="484">[kid:0x20,</text>
                  <text x="360" y="484">Partial</text>
                  <text x="416" y="484">IV:0]</text>
                  <text x="212" y="500">EDHOC:</text>
                  <text x="248" y="500">-</text>
                  <text x="212" y="516">0xff</text>
                  <text x="204" y="532">Payload:</text>
                  <text x="264" y="532">EDHOC</text>
                  <text x="332" y="532">message_3,</text>
                  <text x="388" y="532">//</text>
                  <text x="436" y="532">Intended</text>
                  <text x="488" y="532">for</text>
                  <text x="512" y="532">P</text>
                  <text x="268" y="548">{Code:</text>
                  <text x="316" y="548">0.02</text>
                  <text x="368" y="548">(POST),</text>
                  <text x="288" y="564">Uri-Host:</text>
                  <text x="388" y="564">"example.com",</text>
                  <text x="288" y="580">Uri-Path:</text>
                  <text x="388" y="580">".well-known",</text>
                  <text x="288" y="596">Uri-Path:</text>
                  <text x="364" y="596">"edhoc",</text>
                  <text x="304" y="612">Proxy-Scheme:</text>
                  <text x="392" y="612">"coap",</text>
                  <text x="272" y="628">0xff,</text>
                  <text x="276" y="644">(true,</text>
                  <text x="328" y="644">EDHOC</text>
                  <text x="396" y="644">message_1)</text>
                  <text x="248" y="660">}</text>
                  <text x="268" y="660">//</text>
                  <text x="320" y="660">Encrypted</text>
                  <text x="380" y="660">with</text>
                  <text x="432" y="660">CTX_C_P</text>
                  <text x="104" y="692">Establish</text>
                  <text x="96" y="708">CTX_C_P</text>
                  <text x="96" y="740">Rebuild</text>
                  <text x="80" y="756">REQ</text>
                  <text x="116" y="756">from</text>
                  <text x="100" y="772">COMB_REQ</text>
                  <text x="88" y="788">|</text>
                  <text x="96" y="804">Decrypt</text>
                  <text x="80" y="820">REQ</text>
                  <text x="116" y="820">with</text>
                  <text x="96" y="836">CTX_C_P</text>
                  <text x="216" y="868">Code:</text>
                  <text x="260" y="868">0.02</text>
                  <text x="308" y="868">(POST)</text>
                  <text x="116" y="884">POST</text>
                  <text x="212" y="884">Token:</text>
                  <text x="260" y="884">0xa5</text>
                  <text x="200" y="900">Uri-Host:</text>
                  <text x="300" y="900">"example.com",</text>
                  <text x="200" y="916">Uri-Path:</text>
                  <text x="296" y="916">".well-known"</text>
                  <text x="200" y="932">Uri-Path:</text>
                  <text x="272" y="932">"edhoc"</text>
                  <text x="212" y="948">0xff</text>
                  <text x="204" y="964">Payload:</text>
                  <text x="268" y="964">(true,</text>
                  <text x="320" y="964">EDHOC</text>
                  <text x="388" y="964">message_1)</text>
                  <text x="208" y="996">Code:</text>
                  <text x="252" y="996">2.04</text>
                  <text x="312" y="996">(Changed)</text>
                  <text x="124" y="1012">2.04</text>
                  <text x="204" y="1012">Token:</text>
                  <text x="252" y="1012">0xa5</text>
                  <text x="204" y="1028">0xff</text>
                  <text x="196" y="1044">Payload:</text>
                  <text x="256" y="1044">EDHOC</text>
                  <text x="320" y="1044">message_2</text>
                  <text x="96" y="1076">Encrypt</text>
                  <text x="84" y="1092">RESP</text>
                  <text x="124" y="1092">with</text>
                  <text x="96" y="1108">CTX_C_P</text>
                  <text x="216" y="1140">Code:</text>
                  <text x="260" y="1140">2.04</text>
                  <text x="320" y="1140">(Changed)</text>
                  <text x="60" y="1156">2.04</text>
                  <text x="212" y="1156">Token:</text>
                  <text x="260" y="1156">0x82</text>
                  <text x="208" y="1172">OSCORE:</text>
                  <text x="248" y="1172">-</text>
                  <text x="212" y="1188">0xff</text>
                  <text x="204" y="1204">Payload:</text>
                  <text x="268" y="1204">{Code:</text>
                  <text x="316" y="1204">2.04</text>
                  <text x="380" y="1204">(Changed),</text>
                  <text x="272" y="1220">0xff,</text>
                  <text x="272" y="1236">EDHOC</text>
                  <text x="336" y="1236">message_2</text>
                  <text x="248" y="1252">}</text>
                  <text x="268" y="1252">//</text>
                  <text x="320" y="1252">Encrypted</text>
                  <text x="380" y="1252">with</text>
                  <text x="432" y="1252">CTX_C_P</text>
                  <text x="32" y="1284">Decrypt</text>
                  <text x="20" y="1300">RESP</text>
                  <text x="60" y="1300">with</text>
                  <text x="32" y="1316">CTX_C_P</text>
                  <text x="40" y="1348">Establish</text>
                  <text x="32" y="1364">CTX_C_S</text>
                  <text x="32" y="1396">Encrypt</text>
                  <text x="16" y="1412">REQ</text>
                  <text x="52" y="1412">with</text>
                  <text x="32" y="1428">CTX_C_S</text>
                  <text x="32" y="1460">Prepare</text>
                  <text x="36" y="1476">COMB_REQ</text>
                  <text x="16" y="1492">for</text>
                  <text x="40" y="1492">S</text>
                  <text x="20" y="1508">from</text>
                  <text x="56" y="1508">REQ</text>
                  <text x="24" y="1524">|</text>
                  <text x="32" y="1540">Encrypt</text>
                  <text x="36" y="1556">COMB_REQ</text>
                  <text x="20" y="1572">with</text>
                  <text x="32" y="1588">CTX_C_P</text>
                  <text x="216" y="1620">Code:</text>
                  <text x="260" y="1620">0.02</text>
                  <text x="308" y="1620">(POST)</text>
                  <text x="52" y="1636">POST</text>
                  <text x="212" y="1636">Token:</text>
                  <text x="260" y="1636">0x83</text>
                  <text x="208" y="1652">OSCORE:</text>
                  <text x="284" y="1652">[kid:0x20,</text>
                  <text x="360" y="1652">Partial</text>
                  <text x="416" y="1652">IV:1]</text>
                  <text x="212" y="1668">0xff</text>
                  <text x="204" y="1684">Payload:</text>
                  <text x="268" y="1684">{Code:</text>
                  <text x="316" y="1684">0.02</text>
                  <text x="368" y="1684">(POST),</text>
                  <text x="288" y="1700">Uri-Host:</text>
                  <text x="388" y="1700">"example.com",</text>
                  <text x="280" y="1716">OSCORE:</text>
                  <text x="356" y="1716">[kid:0x5f,</text>
                  <text x="432" y="1716">Partial</text>
                  <text x="492" y="1716">IV:0],</text>
                  <text x="276" y="1732">EDHOC:</text>
                  <text x="316" y="1732">-,</text>
                  <text x="304" y="1748">Proxy-Scheme:</text>
                  <text x="392" y="1748">"coap",</text>
                  <text x="272" y="1764">0xff,</text>
                  <text x="272" y="1780">EDHOC</text>
                  <text x="340" y="1780">message_3,</text>
                  <text x="396" y="1780">//</text>
                  <text x="444" y="1780">Intended</text>
                  <text x="496" y="1780">for</text>
                  <text x="520" y="1780">S</text>
                  <text x="256" y="1796">{</text>
                  <text x="280" y="1812">Code:</text>
                  <text x="324" y="1812">0.01</text>
                  <text x="372" y="1812">(GET),</text>
                  <text x="352" y="1828">Uri-Path:"alarm_status"</text>
                  <text x="256" y="1844">}</text>
                  <text x="328" y="1844">Encrypted</text>
                  <text x="388" y="1844">with</text>
                  <text x="440" y="1844">CTX_C_S</text>
                  <text x="248" y="1860">}</text>
                  <text x="320" y="1860">Encrypted</text>
                  <text x="380" y="1860">with</text>
                  <text x="432" y="1860">CTX_C_P</text>
                  <text x="96" y="1892">Decrypt</text>
                  <text x="100" y="1908">COMB_REQ</text>
                  <text x="84" y="1924">with</text>
                  <text x="96" y="1940">CTX_C_P</text>
                  <text x="216" y="1972">Code:</text>
                  <text x="260" y="1972">0.02</text>
                  <text x="308" y="1972">(POST)</text>
                  <text x="116" y="1988">POST</text>
                  <text x="212" y="1988">Token:</text>
                  <text x="260" y="1988">0xa6</text>
                  <text x="200" y="2004">Uri-Host:</text>
                  <text x="300" y="2004">"example.com",</text>
                  <text x="208" y="2020">OSCORE:</text>
                  <text x="284" y="2020">[kid:0x5f,</text>
                  <text x="360" y="2020">Partial</text>
                  <text x="416" y="2020">IV:0]</text>
                  <text x="212" y="2036">EDHOC:</text>
                  <text x="248" y="2036">-</text>
                  <text x="212" y="2052">0xff</text>
                  <text x="204" y="2068">Payload:</text>
                  <text x="264" y="2068">EDHOC</text>
                  <text x="332" y="2068">message_3,</text>
                  <text x="388" y="2068">//</text>
                  <text x="436" y="2068">Intended</text>
                  <text x="488" y="2068">for</text>
                  <text x="512" y="2068">S</text>
                  <text x="248" y="2084">{</text>
                  <text x="272" y="2100">Code:</text>
                  <text x="316" y="2100">0.01</text>
                  <text x="364" y="2100">(GET),</text>
                  <text x="288" y="2116">Uri-Path:</text>
                  <text x="388" y="2116">"alarm_status"</text>
                  <text x="248" y="2132">}</text>
                  <text x="268" y="2132">//</text>
                  <text x="320" y="2132">Encrypted</text>
                  <text x="380" y="2132">with</text>
                  <text x="432" y="2132">CTX_C_S</text>
                  <text x="168" y="2164">Establish</text>
                  <text x="160" y="2180">CTX_C_S</text>
                  <text x="160" y="2212">Rebuild</text>
                  <text x="144" y="2228">REQ</text>
                  <text x="180" y="2228">from</text>
                  <text x="164" y="2244">COMB_REQ</text>
                  <text x="152" y="2260">|</text>
                  <text x="160" y="2276">Decrypt</text>
                  <text x="144" y="2292">REQ</text>
                  <text x="180" y="2292">with</text>
                  <text x="160" y="2308">CTX_C_S</text>
                  <text x="160" y="2340">Encrypt</text>
                  <text x="148" y="2356">RESP</text>
                  <text x="188" y="2356">with</text>
                  <text x="160" y="2372">CTX_C_S</text>
                  <text x="216" y="2404">Code:</text>
                  <text x="260" y="2404">2.04</text>
                  <text x="320" y="2404">(Changed)</text>
                  <text x="124" y="2420">2.04</text>
                  <text x="212" y="2420">Token:</text>
                  <text x="260" y="2420">0xa6</text>
                  <text x="208" y="2436">OSCORE:</text>
                  <text x="248" y="2436">-</text>
                  <text x="212" y="2452">0xff</text>
                  <text x="204" y="2468">Payload:</text>
                  <text x="268" y="2468">{Code:</text>
                  <text x="316" y="2468">2.05</text>
                  <text x="380" y="2468">(Content),</text>
                  <text x="272" y="2484">0xff,</text>
                  <text x="264" y="2500">"0"</text>
                  <text x="248" y="2516">}</text>
                  <text x="268" y="2516">//</text>
                  <text x="320" y="2516">Encrypted</text>
                  <text x="380" y="2516">with</text>
                  <text x="432" y="2516">CTX_C_S</text>
                  <text x="96" y="2548">Encrypt</text>
                  <text x="84" y="2564">RESP</text>
                  <text x="124" y="2564">with</text>
                  <text x="96" y="2580">CTX_C_P</text>
                  <text x="216" y="2612">Code:</text>
                  <text x="260" y="2612">2.04</text>
                  <text x="320" y="2612">(Changed)</text>
                  <text x="60" y="2628">2.04</text>
                  <text x="212" y="2628">Token:</text>
                  <text x="260" y="2628">0x83</text>
                  <text x="208" y="2644">OSCORE:</text>
                  <text x="248" y="2644">-</text>
                  <text x="212" y="2660">0xff</text>
                  <text x="204" y="2676">Payload:</text>
                  <text x="268" y="2676">{Code:</text>
                  <text x="316" y="2676">2.04</text>
                  <text x="380" y="2676">(Changed),</text>
                  <text x="280" y="2692">OSCORE:</text>
                  <text x="324" y="2692">-,</text>
                  <text x="272" y="2708">0xff,</text>
                  <text x="276" y="2724">{Code:</text>
                  <text x="324" y="2724">2.05</text>
                  <text x="388" y="2724">(Content),</text>
                  <text x="280" y="2740">0xff,</text>
                  <text x="272" y="2756">"0"</text>
                  <text x="256" y="2772">}</text>
                  <text x="328" y="2772">Encrypted</text>
                  <text x="388" y="2772">with</text>
                  <text x="440" y="2772">CTX_C_S</text>
                  <text x="248" y="2788">}</text>
                  <text x="320" y="2788">Encrypted</text>
                  <text x="380" y="2788">with</text>
                  <text x="432" y="2788">CTX_C_P</text>
                  <text x="32" y="2820">Decrypt</text>
                  <text x="20" y="2836">RESP</text>
                  <text x="60" y="2836">with</text>
                  <text x="32" y="2852">CTX_C_P</text>
                  <text x="32" y="2884">Decrypt</text>
                  <text x="20" y="2900">RESP</text>
                  <text x="60" y="2900">with</text>
                  <text x="32" y="2916">CTX_C_S</text>
                  <text x="28" y="2964">Square</text>
                  <text x="92" y="2964">brackets</text>
                  <text x="136" y="2964">[</text>
                  <text x="160" y="2964">...</text>
                  <text x="184" y="2964">]</text>
                  <text x="228" y="2964">indicate</text>
                  <text x="296" y="2964">content</text>
                  <text x="340" y="2964">of</text>
                  <text x="396" y="2964">compressed</text>
                  <text x="460" y="2964">COSE</text>
                  <text x="512" y="2964">object.</text>
                  <text x="24" y="2980">Curly</text>
                  <text x="84" y="2980">brackets</text>
                  <text x="128" y="2980">{</text>
                  <text x="152" y="2980">...</text>
                  <text x="176" y="2980">}</text>
                  <text x="220" y="2980">indicate</text>
                  <text x="296" y="2980">encrypted</text>
                  <text x="360" y="2980">data.</text>
                  <text x="16" y="3012">(A,</text>
                  <text x="44" y="3012">B)</text>
                  <text x="96" y="3012">indicates</text>
                  <text x="144" y="3012">a</text>
                  <text x="172" y="3012">CBOR</text>
                  <text x="228" y="3012">sequence</text>
                  <text x="304" y="3012">[RFC8742]</text>
                  <text x="68" y="3028">of</text>
                  <text x="96" y="3028">two</text>
                  <text x="132" y="3028">CBOR</text>
                  <text x="172" y="3028">data</text>
                  <text x="216" y="3028">items</text>
                  <text x="248" y="3028">A</text>
                  <text x="272" y="3028">and</text>
                  <text x="300" y="3028">B.</text>
                </g>
              </svg><a href="#appendix-B.5-5.1.1" class="pilcrow">Â¶</a>
</div>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-use-of-oscore-between-client-se" class="selfRef">Use of OSCORE between Client-Server and Proxy-Server, with OSCORE Security Contexts established through EDHOC using the EDHOC + OSCORE request</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="with-reverse-proxy-oscore-c-p-p-s">
<section id="appendix-B.6">
        <h3 id="name-with-reverse-proxy-oscore-c">
<a href="#appendix-B.6" class="section-number selfRef">B.6. </a><a href="#name-with-reverse-proxy-oscore-c" class="section-name selfRef">With Reverse-Proxy; OSCORE: C-P, P-S</a>
        </h3>
<p id="appendix-B.6-1">In the example shown in <a href="#fig-example-reverse-proxy-without-end-to-end" class="auto internal xref">Figure 6</a>, message exchanges are protected with OSCORE as follows.<a href="#appendix-B.6-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.6-2.1">
            <p id="appendix-B.6-2.1.1">Between the client and the proxy, using the OSCORE Security Context CTX_C_P. The client uses the OSCORE Sender ID 0x20 when using OSCORE with the proxy.<a href="#appendix-B.6-2.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-B.6-2.2">
            <p id="appendix-B.6-2.2.1">Between the proxy and the server, using the OSCORE Security Context CTX_P_S. The proxy uses the OSCORE Sender ID 0xd4 when using OSCORE with the server.<a href="#appendix-B.6-2.2.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<p id="appendix-B.6-3">In this example, the proxy is specifically a reverse-proxy. Like typically expected in such a case, the client is not aware of that and believes to communicate with an origin server.<a href="#appendix-B.6-3" class="pilcrow">Â¶</a></p>
<p id="appendix-B.6-4">In order to determine where it has to forward an incoming request to, the proxy relies on the hostname that clients specify in the Uri-Host option of their sent requests. In particular, upon receiving a request that includes the Uri-Host option with value "dev.example", the proxy forwards the request to the origin server shown in the example.<a href="#appendix-B.6-4" class="pilcrow">Â¶</a></p>
<p id="appendix-B.6-5">Furthermore, this example assumes that, in the URI identifying the target resource at the server, the host component represents the destination IP address of the request as an IP-literal. Therefore, the request from the proxy to the server does not include a Uri-Host option (see <span><a href="https://rfc-editor.org/rfc/rfc7252#section-6.4" class="relref">Section 6.4</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>).<a href="#appendix-B.6-5" class="pilcrow">Â¶</a></p>
<span id="name-use-of-oscore-between-client-p"></span><div id="fig-example-reverse-proxy-without-end-to-end">
<figure id="figure-6">
          <div id="appendix-B.6-6.1">
            <div class="alignLeft art-svg artwork" id="appendix-B.6-6.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="1200" width="544" viewBox="0 0 544 1200" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 24,104 L 24,1072" fill="none" stroke="black"></path>
                <path d="M 24,1128 L 24,1136" fill="none" stroke="black"></path>
                <path d="M 88,48 L 88,256" fill="none" stroke="black"></path>
                <path d="M 88,312 L 88,320" fill="none" stroke="black"></path>
                <path d="M 88,376 L 88,800" fill="none" stroke="black"></path>
                <path d="M 88,856 L 88,864" fill="none" stroke="black"></path>
                <path d="M 88,920 L 88,1136" fill="none" stroke="black"></path>
                <path d="M 152,48 L 152,528" fill="none" stroke="black"></path>
                <path d="M 152,584 L 152,592" fill="none" stroke="black"></path>
                <path d="M 152,648 L 152,1136" fill="none" stroke="black"></path>
                <path d="M 24,128 L 80,128" fill="none" stroke="black"></path>
                <path d="M 88,400 L 144,400" fill="none" stroke="black"></path>
                <path d="M 96,672 L 152,672" fill="none" stroke="black"></path>
                <path d="M 32,944 L 88,944" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="152,400 140,394.4 140,405.6" fill="black" transform="rotate(0,144,400)"></polygon>
                <polygon class="arrowhead" points="104,672 92,666.4 92,677.6" fill="black" transform="rotate(180,96,672)"></polygon>
                <polygon class="arrowhead" points="88,128 76,122.4 76,133.6" fill="black" transform="rotate(0,80,128)"></polygon>
                <polygon class="arrowhead" points="40,944 28,938.4 28,949.6" fill="black" transform="rotate(180,32,944)"></polygon>
                <g class="text">
                  <text x="28" y="36">Client</text>
                  <text x="88" y="36">Proxy</text>
                  <text x="148" y="36">Server</text>
                  <text x="24" y="52">|</text>
                  <text x="32" y="68">Encrypt</text>
                  <text x="16" y="84">REQ</text>
                  <text x="52" y="84">with</text>
                  <text x="32" y="100">CTX_C_P</text>
                  <text x="216" y="132">Code:</text>
                  <text x="260" y="132">0.02</text>
                  <text x="308" y="132">(POST)</text>
                  <text x="52" y="148">POST</text>
                  <text x="212" y="148">Token:</text>
                  <text x="260" y="148">0x8c</text>
                  <text x="200" y="164">Uri-Host:</text>
                  <text x="296" y="164">"dev.example"</text>
                  <text x="208" y="180">OSCORE:</text>
                  <text x="284" y="180">[kid:0x20,</text>
                  <text x="360" y="180">Partial</text>
                  <text x="420" y="180">IV:31]</text>
                  <text x="212" y="196">0xff</text>
                  <text x="204" y="212">Payload:</text>
                  <text x="268" y="212">{Code:</text>
                  <text x="316" y="212">0.01</text>
                  <text x="364" y="212">(GET),</text>
                  <text x="288" y="228">Uri-Path:</text>
                  <text x="388" y="228">"alarm_status"</text>
                  <text x="248" y="244">}</text>
                  <text x="268" y="244">//</text>
                  <text x="320" y="244">Encrypted</text>
                  <text x="380" y="244">with</text>
                  <text x="432" y="244">CTX_C_P</text>
                  <text x="96" y="276">Decrypt</text>
                  <text x="80" y="292">REQ</text>
                  <text x="116" y="292">with</text>
                  <text x="96" y="308">CTX_C_P</text>
                  <text x="96" y="340">Encrypt</text>
                  <text x="80" y="356">REQ</text>
                  <text x="116" y="356">with</text>
                  <text x="96" y="372">CTX_P_S</text>
                  <text x="216" y="404">Code:</text>
                  <text x="260" y="404">0.02</text>
                  <text x="308" y="404">(POST)</text>
                  <text x="116" y="420">POST</text>
                  <text x="212" y="420">Token:</text>
                  <text x="260" y="420">0x7b</text>
                  <text x="208" y="436">OSCORE:</text>
                  <text x="284" y="436">[kid:0xd4,</text>
                  <text x="360" y="436">Partial</text>
                  <text x="420" y="436">IV:42]</text>
                  <text x="212" y="452">0xff</text>
                  <text x="204" y="468">Payload:</text>
                  <text x="248" y="468">{</text>
                  <text x="272" y="484">Code:</text>
                  <text x="316" y="484">0.01</text>
                  <text x="364" y="484">(GET),</text>
                  <text x="288" y="500">Uri-Path:</text>
                  <text x="388" y="500">"alarm_status"</text>
                  <text x="248" y="516">}</text>
                  <text x="268" y="516">//</text>
                  <text x="320" y="516">Encrypted</text>
                  <text x="380" y="516">with</text>
                  <text x="432" y="516">CTX_P_S</text>
                  <text x="160" y="548">Decrypt</text>
                  <text x="144" y="564">REQ</text>
                  <text x="180" y="564">with</text>
                  <text x="160" y="580">CTX_P_S</text>
                  <text x="160" y="612">Encrypt</text>
                  <text x="148" y="628">RESP</text>
                  <text x="188" y="628">with</text>
                  <text x="160" y="644">CTX_P_S</text>
                  <text x="216" y="676">Code:</text>
                  <text x="260" y="676">2.04</text>
                  <text x="320" y="676">(Changed)</text>
                  <text x="124" y="692">2.04</text>
                  <text x="212" y="692">Token:</text>
                  <text x="260" y="692">0x7b</text>
                  <text x="208" y="708">OSCORE:</text>
                  <text x="248" y="708">-</text>
                  <text x="212" y="724">0xff</text>
                  <text x="204" y="740">Payload:</text>
                  <text x="268" y="740">{Code:</text>
                  <text x="316" y="740">2.05</text>
                  <text x="380" y="740">(Content),</text>
                  <text x="272" y="756">0xff,</text>
                  <text x="264" y="772">"0"</text>
                  <text x="248" y="788">}</text>
                  <text x="268" y="788">//</text>
                  <text x="320" y="788">Encrypted</text>
                  <text x="380" y="788">with</text>
                  <text x="432" y="788">CTX_P_S</text>
                  <text x="96" y="820">Decrypt</text>
                  <text x="84" y="836">RESP</text>
                  <text x="124" y="836">with</text>
                  <text x="96" y="852">CTX_P_S</text>
                  <text x="96" y="884">Encrypt</text>
                  <text x="84" y="900">RESP</text>
                  <text x="124" y="900">with</text>
                  <text x="96" y="916">CTX_C_P</text>
                  <text x="216" y="948">Code:</text>
                  <text x="260" y="948">2.04</text>
                  <text x="320" y="948">(Changed)</text>
                  <text x="60" y="964">2.04</text>
                  <text x="212" y="964">Token:</text>
                  <text x="260" y="964">0x8c</text>
                  <text x="208" y="980">OSCORE:</text>
                  <text x="248" y="980">-</text>
                  <text x="212" y="996">0xff</text>
                  <text x="204" y="1012">Payload:</text>
                  <text x="268" y="1012">{Code:</text>
                  <text x="316" y="1012">2.05</text>
                  <text x="380" y="1012">(Content),</text>
                  <text x="272" y="1028">0xff,</text>
                  <text x="264" y="1044">"0"</text>
                  <text x="248" y="1060">}</text>
                  <text x="268" y="1060">//</text>
                  <text x="320" y="1060">Encrypted</text>
                  <text x="380" y="1060">with</text>
                  <text x="432" y="1060">CTX_C_P</text>
                  <text x="32" y="1092">Decrypt</text>
                  <text x="20" y="1108">RESP</text>
                  <text x="60" y="1108">with</text>
                  <text x="32" y="1124">CTX_C_P</text>
                  <text x="28" y="1172">Square</text>
                  <text x="92" y="1172">brackets</text>
                  <text x="136" y="1172">[</text>
                  <text x="160" y="1172">...</text>
                  <text x="184" y="1172">]</text>
                  <text x="228" y="1172">indicate</text>
                  <text x="296" y="1172">content</text>
                  <text x="340" y="1172">of</text>
                  <text x="396" y="1172">compressed</text>
                  <text x="460" y="1172">COSE</text>
                  <text x="512" y="1172">object.</text>
                  <text x="24" y="1188">Curly</text>
                  <text x="84" y="1188">brackets</text>
                  <text x="128" y="1188">{</text>
                  <text x="152" y="1188">...</text>
                  <text x="176" y="1188">}</text>
                  <text x="220" y="1188">indicate</text>
                  <text x="296" y="1188">encrypted</text>
                  <text x="360" y="1188">data.</text>
                </g>
              </svg><a href="#appendix-B.6-6.1.1" class="pilcrow">Â¶</a>
</div>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-use-of-oscore-between-client-p" class="selfRef">Use of OSCORE between Client-Proxy and Proxy-Server (the Proxy is a Reverse-Proxy)</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="with-reverse-proxy-oscore-c-s-c-p-p-s">
<section id="appendix-B.7">
        <h3 id="name-with-reverse-proxy-oscore-c-">
<a href="#appendix-B.7" class="section-number selfRef">B.7. </a><a href="#name-with-reverse-proxy-oscore-c-" class="section-name selfRef">With Reverse-Proxy; OSCORE: C-S, C-P, P-S</a>
        </h3>
<p id="appendix-B.7-1">In the example shown in <a href="#fig-example-reverse-proxy-with-end-to-end" class="auto internal xref">Figure 7</a>, message exchanges are protected with OSCORE as follows.<a href="#appendix-B.7-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.7-2.1">
            <p id="appendix-B.7-2.1.1">End-to-end between the client and the server, using the OSCORE Security Context CTX_C_S. The client uses the OSCORE Sender ID 0x5f when using OSCORE with the server.<a href="#appendix-B.7-2.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-B.7-2.2">
            <p id="appendix-B.7-2.2.1">Between the client and the proxy, using the OSCORE Security Context CTX_C_P. The client uses the OSCORE Sender ID 0x20 when using OSCORE with the proxy.<a href="#appendix-B.7-2.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-B.7-2.3">
            <p id="appendix-B.7-2.3.1">Between the proxy and the server, using the OSCORE Security Context CTX_P_S. The proxy uses the OSCORE Sender ID 0xd4 when using OSCORE with the server.<a href="#appendix-B.7-2.3.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<p id="appendix-B.7-3">In this example, the proxy is specifically a reverse-proxy. However, unlike typically expected, the client is aware to communicate with a reverse-proxy. This is the case, e.g., in the LwM2M scenario considered in <a href="#ssec-uc4" class="auto internal xref">Appendix A.4</a>, where the LwM2M Server acts as a CoAP client and uses a LwM2M Gateway acting as a CoAP-to-CoAP reverse-proxy in order to reach an end IoT device.<a href="#appendix-B.7-3" class="pilcrow">Â¶</a></p>
<p id="appendix-B.7-4">In order to determine where it has to forward an incoming request to, the proxy relies on the URI path components that are specified as value of the Uri-Path options included in the request. In particular, the proxy relies on the first URI path segment to identify the specific IoT device to which the request has to be forwarded, while the remaining URI path segments specify the target resource at the IoT device.<a href="#appendix-B.7-4" class="pilcrow">Â¶</a></p>
<p id="appendix-B.7-5">However, as shown in the example, the URI path segments that specify the target resource are hidden from the proxy, since they are protected by the additional use of OSCORE end-to-end between the client and the server.<a href="#appendix-B.7-5" class="pilcrow">Â¶</a></p>
<p id="appendix-B.7-6">Furthermore, this example assumes that, in the URIs identifying the target resource at the proxy as well as in the URI identifying the target resource at the server, the host component represents the destination IP address of the request as an IP-literal. Therefore, both the request from the client to the proxy and the request from the proxy to the server do not include a Uri-Host option (see <span><a href="https://rfc-editor.org/rfc/rfc7252#section-6.4" class="relref">Section 6.4</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>).<a href="#appendix-B.7-6" class="pilcrow">Â¶</a></p>
<span id="name-use-of-oscore-between-client-pr"></span><div id="fig-example-reverse-proxy-with-end-to-end">
<figure id="figure-7">
          <div id="appendix-B.7-7.1">
            <div class="alignLeft art-svg artwork" id="appendix-B.7-7.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="1696" width="544" viewBox="0 0 544 1696" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 24,104 L 24,112" fill="none" stroke="black"></path>
                <path d="M 24,168 L 24,1504" fill="none" stroke="black"></path>
                <path d="M 24,1560 L 24,1568" fill="none" stroke="black"></path>
                <path d="M 24,1624 L 24,1632" fill="none" stroke="black"></path>
                <path d="M 88,48 L 88,384" fill="none" stroke="black"></path>
                <path d="M 88,440 L 88,448" fill="none" stroke="black"></path>
                <path d="M 88,504 L 88,1168" fill="none" stroke="black"></path>
                <path d="M 88,1224 L 88,1232" fill="none" stroke="black"></path>
                <path d="M 88,1288 L 88,1632" fill="none" stroke="black"></path>
                <path d="M 152,48 L 152,704" fill="none" stroke="black"></path>
                <path d="M 152,760 L 152,768" fill="none" stroke="black"></path>
                <path d="M 152,824 L 152,832" fill="none" stroke="black"></path>
                <path d="M 152,888 L 152,896" fill="none" stroke="black"></path>
                <path d="M 152,952 L 152,1632" fill="none" stroke="black"></path>
                <path d="M 24,192 L 80,192" fill="none" stroke="black"></path>
                <path d="M 88,528 L 144,528" fill="none" stroke="black"></path>
                <path d="M 96,976 L 152,976" fill="none" stroke="black"></path>
                <path d="M 32,1312 L 88,1312" fill="none" stroke="black"></path>
                <path d="M 256,368 L 264,352" fill="none" stroke="black"></path>
                <path d="M 264,368 L 276,344" fill="none" stroke="black"></path>
                <path d="M 256,688 L 264,672" fill="none" stroke="black"></path>
                <path d="M 264,688 L 276,664" fill="none" stroke="black"></path>
                <path d="M 256,1152 L 264,1136" fill="none" stroke="black"></path>
                <path d="M 264,1152 L 272,1136" fill="none" stroke="black"></path>
                <path d="M 256,1488 L 264,1472" fill="none" stroke="black"></path>
                <path d="M 264,1488 L 272,1472" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="152,528 140,522.4 140,533.6" fill="black" transform="rotate(0,144,528)"></polygon>
                <polygon class="arrowhead" points="104,976 92,970.4 92,981.6" fill="black" transform="rotate(180,96,976)"></polygon>
                <polygon class="arrowhead" points="88,192 76,186.4 76,197.6" fill="black" transform="rotate(0,80,192)"></polygon>
                <polygon class="arrowhead" points="40,1312 28,1306.4 28,1317.6" fill="black" transform="rotate(180,32,1312)"></polygon>
                <g class="text">
                  <text x="28" y="36">Client</text>
                  <text x="88" y="36">Proxy</text>
                  <text x="148" y="36">Server</text>
                  <text x="24" y="52">|</text>
                  <text x="32" y="68">Encrypt</text>
                  <text x="16" y="84">REQ</text>
                  <text x="52" y="84">with</text>
                  <text x="32" y="100">CTX_C_S</text>
                  <text x="32" y="132">Encrypt</text>
                  <text x="16" y="148">REQ</text>
                  <text x="52" y="148">with</text>
                  <text x="32" y="164">CTX_C_P</text>
                  <text x="208" y="196">Code:</text>
                  <text x="252" y="196">0.02</text>
                  <text x="300" y="196">(POST)</text>
                  <text x="52" y="212">POST</text>
                  <text x="204" y="212">Token:</text>
                  <text x="252" y="212">0x8c</text>
                  <text x="200" y="228">OSCORE:</text>
                  <text x="276" y="228">[kid:0x20,</text>
                  <text x="352" y="228">Partial</text>
                  <text x="412" y="228">IV:31]</text>
                  <text x="204" y="244">0xff</text>
                  <text x="196" y="260">Payload:</text>
                  <text x="260" y="260">{Code:</text>
                  <text x="308" y="260">0.02</text>
                  <text x="360" y="260">(POST),</text>
                  <text x="272" y="276">OSCORE:</text>
                  <text x="348" y="276">[kid:0x5f,</text>
                  <text x="424" y="276">Partial</text>
                  <text x="488" y="276">IV:42],</text>
                  <text x="280" y="292">Uri-Path:</text>
                  <text x="352" y="292">"dev1",</text>
                  <text x="264" y="308">0xff,</text>
                  <text x="268" y="324">{Code:</text>
                  <text x="316" y="324">0.01</text>
                  <text x="364" y="324">(GET),</text>
                  <text x="288" y="340">Uri-Path:</text>
                  <text x="388" y="340">"alarm_status"</text>
                  <text x="248" y="356">}</text>
                  <text x="320" y="356">Encrypted</text>
                  <text x="380" y="356">with</text>
                  <text x="432" y="356">CTX_C_S</text>
                  <text x="240" y="372">}</text>
                  <text x="312" y="372">Encrypted</text>
                  <text x="372" y="372">with</text>
                  <text x="424" y="372">CTX_C_P</text>
                  <text x="96" y="404">Decrypt</text>
                  <text x="80" y="420">REQ</text>
                  <text x="116" y="420">with</text>
                  <text x="96" y="436">CTX_C_P</text>
                  <text x="96" y="468">Encrypt</text>
                  <text x="80" y="484">REQ</text>
                  <text x="116" y="484">with</text>
                  <text x="96" y="500">CTX_P_S</text>
                  <text x="208" y="532">Code:</text>
                  <text x="252" y="532">0.02</text>
                  <text x="300" y="532">(POST)</text>
                  <text x="116" y="548">POST</text>
                  <text x="204" y="548">Token:</text>
                  <text x="252" y="548">0x7b</text>
                  <text x="200" y="564">OSCORE:</text>
                  <text x="276" y="564">[kid:0xd4,</text>
                  <text x="352" y="564">Partial</text>
                  <text x="412" y="564">IV:53]</text>
                  <text x="204" y="580">0xff</text>
                  <text x="196" y="596">Payload:</text>
                  <text x="260" y="596">{Code:</text>
                  <text x="308" y="596">0.02</text>
                  <text x="360" y="596">(POST),</text>
                  <text x="272" y="612">OSCORE:</text>
                  <text x="348" y="612">[kid:0x5f,</text>
                  <text x="424" y="612">Partial</text>
                  <text x="488" y="612">IV:42],</text>
                  <text x="264" y="628">0xff,</text>
                  <text x="268" y="644">{Code:</text>
                  <text x="316" y="644">0.01</text>
                  <text x="364" y="644">(GET),</text>
                  <text x="288" y="660">Uri-Path:</text>
                  <text x="388" y="660">"alarm_status"</text>
                  <text x="248" y="676">}</text>
                  <text x="320" y="676">Encrypted</text>
                  <text x="380" y="676">with</text>
                  <text x="432" y="676">CTX_C_S</text>
                  <text x="240" y="692">}</text>
                  <text x="312" y="692">Encrypted</text>
                  <text x="372" y="692">with</text>
                  <text x="424" y="692">CTX_P_S</text>
                  <text x="160" y="724">Decrypt</text>
                  <text x="144" y="740">REQ</text>
                  <text x="180" y="740">with</text>
                  <text x="160" y="756">CTX_P_S</text>
                  <text x="160" y="788">Decrypt</text>
                  <text x="144" y="804">REQ</text>
                  <text x="180" y="804">with</text>
                  <text x="160" y="820">CTX_C_S</text>
                  <text x="160" y="852">Encrypt</text>
                  <text x="148" y="868">RESP</text>
                  <text x="188" y="868">with</text>
                  <text x="160" y="884">CTX_C_S</text>
                  <text x="160" y="916">Encrypt</text>
                  <text x="148" y="932">RESP</text>
                  <text x="188" y="932">with</text>
                  <text x="160" y="948">CTX_P_S</text>
                  <text x="208" y="980">Code:</text>
                  <text x="252" y="980">2.04</text>
                  <text x="312" y="980">(Changed)</text>
                  <text x="124" y="996">2.04</text>
                  <text x="204" y="996">Token:</text>
                  <text x="252" y="996">0x7b</text>
                  <text x="200" y="1012">OSCORE:</text>
                  <text x="240" y="1012">-</text>
                  <text x="204" y="1028">0xff</text>
                  <text x="196" y="1044">Payload:</text>
                  <text x="260" y="1044">{Code:</text>
                  <text x="308" y="1044">2.04</text>
                  <text x="372" y="1044">(Changed),</text>
                  <text x="272" y="1060">OSCORE:</text>
                  <text x="316" y="1060">-,</text>
                  <text x="264" y="1076">0xff,</text>
                  <text x="268" y="1092">{Code:</text>
                  <text x="316" y="1092">2.05</text>
                  <text x="380" y="1092">(Content),</text>
                  <text x="272" y="1108">0xff,</text>
                  <text x="264" y="1124">"0"</text>
                  <text x="248" y="1140">}</text>
                  <text x="320" y="1140">Encrypted</text>
                  <text x="380" y="1140">with</text>
                  <text x="432" y="1140">CTX_C_S</text>
                  <text x="240" y="1156">}</text>
                  <text x="312" y="1156">Encrypted</text>
                  <text x="372" y="1156">with</text>
                  <text x="424" y="1156">CTX_P_S</text>
                  <text x="96" y="1188">Decrypt</text>
                  <text x="84" y="1204">RESP</text>
                  <text x="124" y="1204">with</text>
                  <text x="96" y="1220">CTX_P_S</text>
                  <text x="96" y="1252">Encrypt</text>
                  <text x="84" y="1268">RESP</text>
                  <text x="124" y="1268">with</text>
                  <text x="96" y="1284">CTX_C_P</text>
                  <text x="208" y="1316">Code:</text>
                  <text x="252" y="1316">2.04</text>
                  <text x="312" y="1316">(Changed)</text>
                  <text x="60" y="1332">2.04</text>
                  <text x="204" y="1332">Token:</text>
                  <text x="252" y="1332">0x8c</text>
                  <text x="200" y="1348">OSCORE:</text>
                  <text x="240" y="1348">-</text>
                  <text x="204" y="1364">0xff</text>
                  <text x="196" y="1380">Payload:</text>
                  <text x="260" y="1380">{Code:</text>
                  <text x="308" y="1380">2.04</text>
                  <text x="372" y="1380">(Changed),</text>
                  <text x="272" y="1396">OSCORE:</text>
                  <text x="316" y="1396">-,</text>
                  <text x="264" y="1412">0xff,</text>
                  <text x="268" y="1428">{Code:</text>
                  <text x="316" y="1428">2.05</text>
                  <text x="380" y="1428">(Content),</text>
                  <text x="272" y="1444">0xff,</text>
                  <text x="264" y="1460">"0"</text>
                  <text x="248" y="1476">}</text>
                  <text x="320" y="1476">Encrypted</text>
                  <text x="380" y="1476">with</text>
                  <text x="432" y="1476">CTX_C_S</text>
                  <text x="240" y="1492">}</text>
                  <text x="312" y="1492">Encrypted</text>
                  <text x="372" y="1492">with</text>
                  <text x="424" y="1492">CTX_C_P</text>
                  <text x="32" y="1524">Decrypt</text>
                  <text x="20" y="1540">RESP</text>
                  <text x="60" y="1540">with</text>
                  <text x="32" y="1556">CTX_C_P</text>
                  <text x="32" y="1588">Decrypt</text>
                  <text x="20" y="1604">RESP</text>
                  <text x="60" y="1604">with</text>
                  <text x="32" y="1620">CTX_C_S</text>
                  <text x="28" y="1668">Square</text>
                  <text x="92" y="1668">brackets</text>
                  <text x="136" y="1668">[</text>
                  <text x="160" y="1668">...</text>
                  <text x="184" y="1668">]</text>
                  <text x="228" y="1668">indicate</text>
                  <text x="296" y="1668">content</text>
                  <text x="340" y="1668">of</text>
                  <text x="396" y="1668">compressed</text>
                  <text x="460" y="1668">COSE</text>
                  <text x="512" y="1668">object.</text>
                  <text x="24" y="1684">Curly</text>
                  <text x="84" y="1684">brackets</text>
                  <text x="128" y="1684">{</text>
                  <text x="152" y="1684">...</text>
                  <text x="176" y="1684">}</text>
                  <text x="220" y="1684">indicate</text>
                  <text x="296" y="1684">encrypted</text>
                  <text x="360" y="1684">data.</text>
                </g>
              </svg><a href="#appendix-B.7-7.1.1" class="pilcrow">Â¶</a>
</div>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-use-of-oscore-between-client-pr" class="selfRef">Use of OSCORE between Client-Proxy and Proxy-Server (the Proxy is a Reverse-Proxy)</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="sec-option-protection-diag">
<section id="appendix-C">
      <h2 id="name-state-diagram-protection-of">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-state-diagram-protection-of" class="section-name selfRef">State Diagram: Protection of CoAP Options</a>
      </h2>
<p id="appendix-C-1"><a href="#fig-option-protection-diagram" class="auto internal xref">Figure 8</a> overviews the rules defined in <a href="#general-rules" class="auto internal xref">Section 2.2</a>, which are used to determine whether a CoAP option that is originally specified only as an outer option (Class U or I) for OSCORE has to be processed as Class E, when protecting an outgoing message.<a href="#appendix-C-1" class="pilcrow">Â¶</a></p>
<span id="name-protection-of-coap-options-"></span><div id="fig-option-protection-diagram">
<figure id="figure-8">
        <div id="appendix-C-2.1">
          <div class="alignCenter art-svg artwork" id="appendix-C-2.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="1136" width="576" viewBox="0 0 576 1136" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 8,160 L 8,272" fill="none" stroke="black"></path>
              <path d="M 8,336 L 8,384" fill="none" stroke="black"></path>
              <path d="M 24,496 L 24,656" fill="none" stroke="black"></path>
              <path d="M 48,280 L 48,328" fill="none" stroke="black"></path>
              <path d="M 48,392 L 48,432" fill="none" stroke="black"></path>
              <path d="M 48,464 L 48,488" fill="none" stroke="black"></path>
              <path d="M 48,704 L 48,1104" fill="none" stroke="black"></path>
              <path d="M 80,752 L 80,784" fill="none" stroke="black"></path>
              <path d="M 104,336 L 104,384" fill="none" stroke="black"></path>
              <path d="M 104,1008 L 104,1040" fill="none" stroke="black"></path>
              <path d="M 104,1088 L 104,1120" fill="none" stroke="black"></path>
              <path d="M 120,832 L 120,1000" fill="none" stroke="black"></path>
              <path d="M 144,880 L 144,928" fill="none" stroke="black"></path>
              <path d="M 184,336 L 184,400" fill="none" stroke="black"></path>
              <path d="M 208,408 L 208,432" fill="none" stroke="black"></path>
              <path d="M 208,464 L 208,488" fill="none" stroke="black"></path>
              <path d="M 208,704 L 208,744" fill="none" stroke="black"></path>
              <path d="M 208,976 L 208,1000" fill="none" stroke="black"></path>
              <path d="M 232,496 L 232,656" fill="none" stroke="black"></path>
              <path d="M 304,1008 L 304,1040" fill="none" stroke="black"></path>
              <path d="M 320,496 L 320,576" fill="none" stroke="black"></path>
              <path d="M 336,336 L 336,400" fill="none" stroke="black"></path>
              <path d="M 352,624 L 352,744" fill="none" stroke="black"></path>
              <path d="M 352,832 L 352,872" fill="none" stroke="black"></path>
              <path d="M 352,976 L 352,1080" fill="none" stroke="black"></path>
              <path d="M 416,336 L 416,416" fill="none" stroke="black"></path>
              <path d="M 416,752 L 416,784" fill="none" stroke="black"></path>
              <path d="M 416,880 L 416,928" fill="none" stroke="black"></path>
              <path d="M 456,464 L 456,488" fill="none" stroke="black"></path>
              <path d="M 456,624 L 456,1080" fill="none" stroke="black"></path>
              <path d="M 480,1088 L 480,1120" fill="none" stroke="black"></path>
              <path d="M 496,496 L 496,576" fill="none" stroke="black"></path>
              <path d="M 536,464 L 536,1104" fill="none" stroke="black"></path>
              <path d="M 568,160 L 568,272" fill="none" stroke="black"></path>
              <path d="M 568,336 L 568,416" fill="none" stroke="black"></path>
              <path d="M 8,160 L 88,160" fill="none" stroke="black"></path>
              <path d="M 104,160 L 568,160" fill="none" stroke="black"></path>
              <path d="M 8,272 L 568,272" fill="none" stroke="black"></path>
              <path d="M 8,336 L 104,336" fill="none" stroke="black"></path>
              <path d="M 184,336 L 336,336" fill="none" stroke="black"></path>
              <path d="M 416,336 L 568,336" fill="none" stroke="black"></path>
              <path d="M 112,352 L 128,352" fill="none" stroke="black"></path>
              <path d="M 160,352 L 176,352" fill="none" stroke="black"></path>
              <path d="M 344,352 L 360,352" fill="none" stroke="black"></path>
              <path d="M 392,352 L 408,352" fill="none" stroke="black"></path>
              <path d="M 8,384 L 104,384" fill="none" stroke="black"></path>
              <path d="M 184,400 L 336,400" fill="none" stroke="black"></path>
              <path d="M 416,416 L 568,416" fill="none" stroke="black"></path>
              <path d="M 24,496 L 232,496" fill="none" stroke="black"></path>
              <path d="M 320,496 L 496,496" fill="none" stroke="black"></path>
              <path d="M 320,576 L 496,576" fill="none" stroke="black"></path>
              <path d="M 24,656 L 232,656" fill="none" stroke="black"></path>
              <path d="M 80,752 L 416,752" fill="none" stroke="black"></path>
              <path d="M 80,784 L 416,784" fill="none" stroke="black"></path>
              <path d="M 144,880 L 416,880" fill="none" stroke="black"></path>
              <path d="M 144,928 L 416,928" fill="none" stroke="black"></path>
              <path d="M 104,1008 L 304,1008" fill="none" stroke="black"></path>
              <path d="M 104,1040 L 304,1040" fill="none" stroke="black"></path>
              <path d="M 104,1088 L 480,1088" fill="none" stroke="black"></path>
              <path d="M 48,1104 L 96,1104" fill="none" stroke="black"></path>
              <path d="M 488,1104 L 536,1104" fill="none" stroke="black"></path>
              <path d="M 104,1120 L 480,1120" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="496,1104 484,1098.4 484,1109.6" fill="black" transform="rotate(180,488,1104)"></polygon>
              <polygon class="arrowhead" points="464,1080 452,1074.4 452,1085.6" fill="black" transform="rotate(90,456,1080)"></polygon>
              <polygon class="arrowhead" points="464,488 452,482.4 452,493.6" fill="black" transform="rotate(90,456,488)"></polygon>
              <polygon class="arrowhead" points="416,352 404,346.4 404,357.6" fill="black" transform="rotate(0,408,352)"></polygon>
              <polygon class="arrowhead" points="360,1080 348,1074.4 348,1085.6" fill="black" transform="rotate(90,352,1080)"></polygon>
              <polygon class="arrowhead" points="360,872 348,866.4 348,877.6" fill="black" transform="rotate(90,352,872)"></polygon>
              <polygon class="arrowhead" points="360,744 348,738.4 348,749.6" fill="black" transform="rotate(90,352,744)"></polygon>
              <polygon class="arrowhead" points="216,1000 204,994.4 204,1005.6" fill="black" transform="rotate(90,208,1000)"></polygon>
              <polygon class="arrowhead" points="216,744 204,738.4 204,749.6" fill="black" transform="rotate(90,208,744)"></polygon>
              <polygon class="arrowhead" points="216,488 204,482.4 204,493.6" fill="black" transform="rotate(90,208,488)"></polygon>
              <polygon class="arrowhead" points="184,352 172,346.4 172,357.6" fill="black" transform="rotate(0,176,352)"></polygon>
              <polygon class="arrowhead" points="128,1000 116,994.4 116,1005.6" fill="black" transform="rotate(90,120,1000)"></polygon>
              <polygon class="arrowhead" points="104,1104 92,1098.4 92,1109.6" fill="black" transform="rotate(0,96,1104)"></polygon>
              <polygon class="arrowhead" points="56,488 44,482.4 44,493.6" fill="black" transform="rotate(90,48,488)"></polygon>
              <polygon class="arrowhead" points="56,328 44,322.4 44,333.6" fill="black" transform="rotate(90,48,328)"></polygon>
              <circle cx="40" cy="512" r="6" class="closeddot" fill="black"></circle>
              <circle cx="40" cy="592" r="6" class="closeddot" fill="black"></circle>
              <circle cx="96" cy="96" r="6" class="opendot" fill="white" stroke="black"></circle>
              <circle cx="96" cy="112" r="6" class="opendot" fill="white" stroke="black"></circle>
              <circle cx="96" cy="128" r="6" class="opendot" fill="white" stroke="black"></circle>
              <circle cx="96" cy="144" r="6" class="opendot" fill="white" stroke="black"></circle>
              <circle cx="96" cy="160" r="6" class="opendot" fill="white" stroke="black"></circle>
              <g class="text">
                <text x="108" y="36">..........................</text>
                <text x="8" y="52">:</text>
                <text x="208" y="52">:</text>
                <text x="8" y="68">:</text>
                <text x="44" y="68">Source</text>
                <text x="100" y="68">OSCORE</text>
                <text x="164" y="68">endpoint</text>
                <text x="208" y="68">:</text>
                <text x="8" y="84">:</text>
                <text x="208" y="84">:</text>
                <text x="48" y="100">:..........</text>
                <text x="156" y="100">.............:</text>
                <text x="24" y="196">I</text>
                <text x="52" y="196">must</text>
                <text x="104" y="196">protect</text>
                <text x="148" y="196">an</text>
                <text x="196" y="196">outgoing</text>
                <text x="264" y="196">message</text>
                <text x="304" y="196">M</text>
                <text x="328" y="196">for</text>
                <text x="376" y="196">another</text>
                <text x="436" y="196">OSCORE</text>
                <text x="500" y="196">endpoint</text>
                <text x="548" y="196">X.</text>
                <text x="24" y="228">M</text>
                <text x="68" y="228">includes</text>
                <text x="112" y="228">a</text>
                <text x="140" y="228">CoAP</text>
                <text x="188" y="228">option</text>
                <text x="232" y="228">OPT</text>
                <text x="268" y="228">that</text>
                <text x="300" y="228">is</text>
                <text x="356" y="228">originally</text>
                <text x="440" y="228">specified</text>
                <text x="500" y="228">only</text>
                <text x="532" y="228">as</text>
                <text x="28" y="244">an</text>
                <text x="64" y="244">outer</text>
                <text x="116" y="244">option</text>
                <text x="172" y="244">(Class</text>
                <text x="208" y="244">U</text>
                <text x="228" y="244">or</text>
                <text x="252" y="244">I)</text>
                <text x="280" y="244">for</text>
                <text x="328" y="244">OSCORE.</text>
                <text x="32" y="356">Did</text>
                <text x="56" y="356">I</text>
                <text x="80" y="356">add</text>
                <text x="144" y="356">YES</text>
                <text x="204" y="356">As</text>
                <text x="232" y="356">far</text>
                <text x="260" y="356">as</text>
                <text x="280" y="356">I</text>
                <text x="304" y="356">can</text>
                <text x="376" y="356">YES</text>
                <text x="436" y="356">As</text>
                <text x="464" y="356">far</text>
                <text x="492" y="356">as</text>
                <text x="512" y="356">I</text>
                <text x="536" y="356">can</text>
                <text x="32" y="372">OPT</text>
                <text x="60" y="372">to</text>
                <text x="84" y="372">M?</text>
                <text x="216" y="372">tell,</text>
                <text x="252" y="372">is</text>
                <text x="272" y="372">X</text>
                <text x="288" y="372">a</text>
                <text x="448" y="372">tell,</text>
                <text x="484" y="372">is</text>
                <text x="504" y="372">X</text>
                <text x="528" y="372">the</text>
                <text x="228" y="388">consumer</text>
                <text x="276" y="388">of</text>
                <text x="308" y="388">OPT?</text>
                <text x="472" y="388">immediately</text>
                <text x="540" y="388">next</text>
                <text x="460" y="404">consumer</text>
                <text x="508" y="404">of</text>
                <text x="540" y="404">OPT?</text>
                <text x="456" y="436">|</text>
                <text x="536" y="436">|</text>
                <text x="52" y="452">NO</text>
                <text x="212" y="452">NO</text>
                <text x="456" y="452">YES</text>
                <text x="540" y="452">NO</text>
                <text x="60" y="516">As</text>
                <text x="88" y="516">far</text>
                <text x="116" y="516">as</text>
                <text x="136" y="516">I</text>
                <text x="160" y="516">can</text>
                <text x="200" y="516">tell,</text>
                <text x="348" y="516">Does</text>
                <text x="376" y="516">X</text>
                <text x="404" y="516">need</text>
                <text x="436" y="516">to</text>
                <text x="56" y="532">X</text>
                <text x="76" y="532">is</text>
                <text x="100" y="532">my</text>
                <text x="132" y="532">next</text>
                <text x="172" y="532">hop;</text>
                <text x="356" y="532">access</text>
                <text x="400" y="532">OPT</text>
                <text x="444" y="532">before</text>
                <text x="372" y="548">decrypting</text>
                <text x="424" y="548">M</text>
                <text x="444" y="548">or</text>
                <text x="468" y="548">in</text>
                <text x="44" y="564">OR</text>
                <text x="352" y="564">order</text>
                <text x="388" y="564">to</text>
                <text x="432" y="564">decrypt</text>
                <text x="476" y="564">M?</text>
                <text x="60" y="596">As</text>
                <text x="88" y="596">far</text>
                <text x="116" y="596">as</text>
                <text x="136" y="596">I</text>
                <text x="160" y="596">can</text>
                <text x="200" y="596">tell,</text>
                <text x="352" y="596">|</text>
                <text x="456" y="596">|</text>
                <text x="60" y="612">my</text>
                <text x="92" y="612">next</text>
                <text x="128" y="612">hop</text>
                <text x="156" y="612">is</text>
                <text x="184" y="612">not</text>
                <text x="356" y="612">NO</text>
                <text x="456" y="612">YES</text>
                <text x="64" y="628">the</text>
                <text x="128" y="628">immediately</text>
                <text x="196" y="628">next</text>
                <text x="84" y="644">consumer</text>
                <text x="132" y="644">of</text>
                <text x="160" y="644">OPT</text>
                <text x="48" y="676">|</text>
                <text x="208" y="676">|</text>
                <text x="52" y="692">NO</text>
                <text x="208" y="692">YES</text>
                <text x="100" y="772">Is</text>
                <text x="128" y="772">OPT</text>
                <text x="160" y="772">the</text>
                <text x="212" y="772">Uri-Host</text>
                <text x="260" y="772">or</text>
                <text x="308" y="772">Uri-Port</text>
                <text x="376" y="772">option?</text>
                <text x="120" y="804">|</text>
                <text x="352" y="804">|</text>
                <text x="124" y="820">NO</text>
                <text x="352" y="820">YES</text>
                <text x="172" y="900">Does</text>
                <text x="200" y="900">M</text>
                <text x="240" y="900">include</text>
                <text x="288" y="900">the</text>
                <text x="356" y="900">Proxy-Scheme</text>
                <text x="164" y="916">or</text>
                <text x="256" y="916">Proxy-Scheme-Number</text>
                <text x="368" y="916">option?</text>
                <text x="208" y="948">|</text>
                <text x="352" y="948">|</text>
                <text x="208" y="964">YES</text>
                <text x="356" y="964">NO</text>
                <text x="144" y="1028">Process</text>
                <text x="192" y="1028">OPT</text>
                <text x="220" y="1028">as</text>
                <text x="256" y="1028">Class</text>
                <text x="288" y="1028">E</text>
                <text x="144" y="1108">Process</text>
                <text x="192" y="1108">OPT</text>
                <text x="220" y="1108">as</text>
                <text x="248" y="1108">per</text>
                <text x="280" y="1108">its</text>
                <text x="332" y="1108">original</text>
                <text x="392" y="1108">Class</text>
                <text x="424" y="1108">U</text>
                <text x="444" y="1108">or</text>
                <text x="464" y="1108">I</text>
              </g>
            </svg><a href="#appendix-C-2.1.1" class="pilcrow">Â¶</a>
</div>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-protection-of-coap-options-" class="selfRef">Protection of CoAP Options Originally Specified only as Outer Options (Class U or I) for OSCORE</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="sec-incoming-req-diag">
<section id="appendix-D">
      <h2 id="name-state-diagram-processing-of">
<a href="#appendix-D" class="section-number selfRef">Appendix D. </a><a href="#name-state-diagram-processing-of" class="section-name selfRef">State Diagram: Processing of Incoming Requests</a>
      </h2>
<p id="appendix-D-1"><a href="#fig-incoming-request-diagram" class="auto internal xref">Figure 9</a> overviews the processing of an incoming request, which is specified in <a href="#incoming-requests" class="auto internal xref">Section 2.4</a>. The dotted boxes indicate ending states where the processing terminates.<a href="#appendix-D-1" class="pilcrow">Â¶</a></p>
<span id="name-processing-of-an-incoming-req"></span><div id="fig-incoming-request-diagram">
<figure id="figure-9">
        <div id="appendix-D-2.1">
          <div class="alignCenter art-svg artwork" id="appendix-D-2.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="1712" width="576" viewBox="0 0 576 1712" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 8,224 L 8,304" fill="none" stroke="black"></path>
              <path d="M 8,512 L 8,624" fill="none" stroke="black"></path>
              <path d="M 8,1040 L 8,1136" fill="none" stroke="black"></path>
              <path d="M 8,1552 L 8,1632" fill="none" stroke="black"></path>
              <path d="M 32,352 L 32,504" fill="none" stroke="black"></path>
              <path d="M 32,672 L 32,1032" fill="none" stroke="black"></path>
              <path d="M 32,1144 L 32,1544" fill="none" stroke="black"></path>
              <path d="M 80,1392 L 80,1472" fill="none" stroke="black"></path>
              <path d="M 112,32 L 112,64" fill="none" stroke="black"></path>
              <path d="M 120,112 L 120,216" fill="none" stroke="black"></path>
              <path d="M 128,224 L 128,304" fill="none" stroke="black"></path>
              <path d="M 136,880 L 136,944" fill="none" stroke="black"></path>
              <path d="M 136,1312 L 136,1344" fill="none" stroke="black"></path>
              <path d="M 136,1480 L 136,1504" fill="none" stroke="black"></path>
              <path d="M 152,272 L 152,464" fill="none" stroke="black"></path>
              <path d="M 184,512 L 184,624" fill="none" stroke="black"></path>
              <path d="M 184,704 L 184,768" fill="none" stroke="black"></path>
              <path d="M 200,224 L 200,288" fill="none" stroke="black"></path>
              <path d="M 200,512 L 200,592" fill="none" stroke="black"></path>
              <path d="M 208,1248 L 208,1312" fill="none" stroke="black"></path>
              <path d="M 208,1392 L 208,1472" fill="none" stroke="black"></path>
              <path d="M 216,336 L 216,504" fill="none" stroke="black"></path>
              <path d="M 224,1040 L 224,1136" fill="none" stroke="black"></path>
              <path d="M 232,160 L 232,176" fill="none" stroke="black"></path>
              <path d="M 272,448 L 272,464" fill="none" stroke="black"></path>
              <path d="M 272,1552 L 272,1632" fill="none" stroke="black"></path>
              <path d="M 280,224 L 280,288" fill="none" stroke="black"></path>
              <path d="M 280,640 L 280,696" fill="none" stroke="black"></path>
              <path d="M 280,776 L 280,872" fill="none" stroke="black"></path>
              <path d="M 280,992 L 280,1032" fill="none" stroke="black"></path>
              <path d="M 280,1120 L 280,1240" fill="none" stroke="black"></path>
              <path d="M 280,1320 L 280,1424" fill="none" stroke="black"></path>
              <path d="M 312,704 L 312,768" fill="none" stroke="black"></path>
              <path d="M 328,512 L 328,592" fill="none" stroke="black"></path>
              <path d="M 336,1248 L 336,1312" fill="none" stroke="black"></path>
              <path d="M 344,72 L 344,832" fill="none" stroke="black"></path>
              <path d="M 352,880 L 352,944" fill="none" stroke="black"></path>
              <path d="M 368,224 L 368,272" fill="none" stroke="black"></path>
              <path d="M 376,280 L 376,1584" fill="none" stroke="black"></path>
              <path d="M 400,1344 L 400,1392" fill="none" stroke="black"></path>
              <path d="M 408,320 L 408,1336" fill="none" stroke="black"></path>
              <path d="M 424,704 L 424,784" fill="none" stroke="black"></path>
              <path d="M 424,1440 L 424,1544" fill="none" stroke="black"></path>
              <path d="M 432,112 L 432,216" fill="none" stroke="black"></path>
              <path d="M 448,432 L 448,496" fill="none" stroke="black"></path>
              <path d="M 448,832 L 448,904" fill="none" stroke="black"></path>
              <path d="M 448,1104 L 448,1136" fill="none" stroke="black"></path>
              <path d="M 456,544 L 456,568" fill="none" stroke="black"></path>
              <path d="M 456,1008 L 456,1040" fill="none" stroke="black"></path>
              <path d="M 456,1184 L 456,1240" fill="none" stroke="black"></path>
              <path d="M 472,320 L 472,424" fill="none" stroke="black"></path>
              <path d="M 496,32 L 496,64" fill="none" stroke="black"></path>
              <path d="M 496,1048 L 496,1096" fill="none" stroke="black"></path>
              <path d="M 496,1144 L 496,1200" fill="none" stroke="black"></path>
              <path d="M 496,1440 L 496,1464" fill="none" stroke="black"></path>
              <path d="M 504,224 L 504,272" fill="none" stroke="black"></path>
              <path d="M 520,1344 L 520,1392" fill="none" stroke="black"></path>
              <path d="M 528,832 L 528,1000" fill="none" stroke="black"></path>
              <path d="M 536,544 L 536,696" fill="none" stroke="black"></path>
              <path d="M 536,1008 L 536,1040" fill="none" stroke="black"></path>
              <path d="M 536,1104 L 536,1136" fill="none" stroke="black"></path>
              <path d="M 544,432 L 544,496" fill="none" stroke="black"></path>
              <path d="M 552,704 L 552,784" fill="none" stroke="black"></path>
              <path d="M 568,48 L 568,1200" fill="none" stroke="black"></path>
              <path d="M 112,32 L 496,32" fill="none" stroke="black"></path>
              <path d="M 80,48 L 104,48" fill="none" stroke="black"></path>
              <path d="M 504,48 L 568,48" fill="none" stroke="black"></path>
              <path d="M 112,64 L 496,64" fill="none" stroke="black"></path>
              <path d="M 8,224 L 128,224" fill="none" stroke="black"></path>
              <path d="M 200,224 L 280,224" fill="none" stroke="black"></path>
              <path d="M 368,224 L 504,224" fill="none" stroke="black"></path>
              <path d="M 136,240 L 192,240" fill="none" stroke="black"></path>
              <path d="M 152,272 L 192,272" fill="none" stroke="black"></path>
              <path d="M 368,272 L 504,272" fill="none" stroke="black"></path>
              <path d="M 200,288 L 280,288" fill="none" stroke="black"></path>
              <path d="M 8,304 L 128,304" fill="none" stroke="black"></path>
              <path d="M 448,432 L 544,432" fill="none" stroke="black"></path>
              <path d="M 448,496 L 544,496" fill="none" stroke="black"></path>
              <path d="M 8,512 L 184,512" fill="none" stroke="black"></path>
              <path d="M 200,512 L 328,512" fill="none" stroke="black"></path>
              <path d="M 200,592 L 328,592" fill="none" stroke="black"></path>
              <path d="M 8,624 L 184,624" fill="none" stroke="black"></path>
              <path d="M 184,704 L 312,704" fill="none" stroke="black"></path>
              <path d="M 424,704 L 552,704" fill="none" stroke="black"></path>
              <path d="M 184,768 L 312,768" fill="none" stroke="black"></path>
              <path d="M 424,784 L 552,784" fill="none" stroke="black"></path>
              <path d="M 136,880 L 352,880" fill="none" stroke="black"></path>
              <path d="M 136,944 L 352,944" fill="none" stroke="black"></path>
              <path d="M 456,1008 L 536,1008" fill="none" stroke="black"></path>
              <path d="M 8,1040 L 224,1040" fill="none" stroke="black"></path>
              <path d="M 456,1040 L 536,1040" fill="none" stroke="black"></path>
              <path d="M 448,1104 L 536,1104" fill="none" stroke="black"></path>
              <path d="M 8,1136 L 224,1136" fill="none" stroke="black"></path>
              <path d="M 448,1136 L 536,1136" fill="none" stroke="black"></path>
              <path d="M 496,1200 L 520,1200" fill="none" stroke="black"></path>
              <path d="M 552,1200 L 568,1200" fill="none" stroke="black"></path>
              <path d="M 208,1248 L 336,1248" fill="none" stroke="black"></path>
              <path d="M 208,1312 L 336,1312" fill="none" stroke="black"></path>
              <path d="M 400,1344 L 520,1344" fill="none" stroke="black"></path>
              <path d="M 80,1392 L 208,1392" fill="none" stroke="black"></path>
              <path d="M 400,1392 L 520,1392" fill="none" stroke="black"></path>
              <path d="M 216,1424 L 232,1424" fill="none" stroke="black"></path>
              <path d="M 264,1424 L 280,1424" fill="none" stroke="black"></path>
              <path d="M 80,1472 L 208,1472" fill="none" stroke="black"></path>
              <path d="M 8,1552 L 272,1552" fill="none" stroke="black"></path>
              <path d="M 280,1584 L 296,1584" fill="none" stroke="black"></path>
              <path d="M 320,1584 L 376,1584" fill="none" stroke="black"></path>
              <path d="M 8,1632 L 272,1632" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="544,696 532,690.4 532,701.6" fill="black" transform="rotate(90,536,696)"></polygon>
              <polygon class="arrowhead" points="536,1000 524,994.4 524,1005.6" fill="black" transform="rotate(90,528,1000)"></polygon>
              <polygon class="arrowhead" points="512,48 500,42.4 500,53.6" fill="black" transform="rotate(180,504,48)"></polygon>
              <polygon class="arrowhead" points="504,1464 492,1458.4 492,1469.6" fill="black" transform="rotate(90,496,1464)"></polygon>
              <polygon class="arrowhead" points="504,1096 492,1090.4 492,1101.6" fill="black" transform="rotate(90,496,1096)"></polygon>
              <polygon class="arrowhead" points="480,424 468,418.4 468,429.6" fill="black" transform="rotate(90,472,424)"></polygon>
              <polygon class="arrowhead" points="464,1240 452,1234.4 452,1245.6" fill="black" transform="rotate(90,456,1240)"></polygon>
              <polygon class="arrowhead" points="464,568 452,562.4 452,573.6" fill="black" transform="rotate(90,456,568)"></polygon>
              <polygon class="arrowhead" points="456,904 444,898.4 444,909.6" fill="black" transform="rotate(90,448,904)"></polygon>
              <polygon class="arrowhead" points="440,216 428,210.4 428,221.6" fill="black" transform="rotate(90,432,216)"></polygon>
              <polygon class="arrowhead" points="432,1544 420,1538.4 420,1549.6" fill="black" transform="rotate(90,424,1544)"></polygon>
              <polygon class="arrowhead" points="416,1336 404,1330.4 404,1341.6" fill="black" transform="rotate(90,408,1336)"></polygon>
              <polygon class="arrowhead" points="384,280 372,274.4 372,285.6" fill="black" transform="rotate(270,376,280)"></polygon>
              <polygon class="arrowhead" points="352,72 340,66.4 340,77.6" fill="black" transform="rotate(270,344,72)"></polygon>
              <polygon class="arrowhead" points="288,1320 276,1314.4 276,1325.6" fill="black" transform="rotate(270,280,1320)"></polygon>
              <polygon class="arrowhead" points="288,1120 276,1114.4 276,1125.6" fill="black" transform="rotate(270,280,1120)"></polygon>
              <polygon class="arrowhead" points="288,1032 276,1026.4 276,1037.6" fill="black" transform="rotate(90,280,1032)"></polygon>
              <polygon class="arrowhead" points="288,872 276,866.4 276,877.6" fill="black" transform="rotate(90,280,872)"></polygon>
              <polygon class="arrowhead" points="288,696 276,690.4 276,701.6" fill="black" transform="rotate(90,280,696)"></polygon>
              <polygon class="arrowhead" points="280,448 268,442.4 268,453.6" fill="black" transform="rotate(270,272,448)"></polygon>
              <polygon class="arrowhead" points="240,160 228,154.4 228,165.6" fill="black" transform="rotate(270,232,160)"></polygon>
              <polygon class="arrowhead" points="224,504 212,498.4 212,509.6" fill="black" transform="rotate(90,216,504)"></polygon>
              <polygon class="arrowhead" points="200,272 188,266.4 188,277.6" fill="black" transform="rotate(0,192,272)"></polygon>
              <polygon class="arrowhead" points="200,240 188,234.4 188,245.6" fill="black" transform="rotate(0,192,240)"></polygon>
              <polygon class="arrowhead" points="144,1480 132,1474.4 132,1485.6" fill="black" transform="rotate(270,136,1480)"></polygon>
              <polygon class="arrowhead" points="144,1312 132,1306.4 132,1317.6" fill="black" transform="rotate(270,136,1312)"></polygon>
              <polygon class="arrowhead" points="128,216 116,210.4 116,221.6" fill="black" transform="rotate(90,120,216)"></polygon>
              <polygon class="arrowhead" points="112,48 100,42.4 100,53.6" fill="black" transform="rotate(0,104,48)"></polygon>
              <polygon class="arrowhead" points="40,1544 28,1538.4 28,1549.6" fill="black" transform="rotate(90,32,1544)"></polygon>
              <polygon class="arrowhead" points="40,1032 28,1026.4 28,1037.6" fill="black" transform="rotate(90,32,1032)"></polygon>
              <polygon class="arrowhead" points="40,504 28,498.4 28,509.6" fill="black" transform="rotate(90,32,504)"></polygon>
              <g class="text">
                <text x="36" y="52">Incoming</text>
                <text x="192" y="52">Are</text>
                <text x="232" y="52">there</text>
                <text x="312" y="52">proxy-related</text>
                <text x="404" y="52">options?</text>
                <text x="32" y="68">request</text>
                <text x="120" y="84">|</text>
                <text x="432" y="84">|</text>
                <text x="120" y="100">YES</text>
                <text x="236" y="100">..........</text>
                <text x="436" y="100">NO</text>
                <text x="200" y="116">:</text>
                <text x="236" y="116">Return</text>
                <text x="272" y="116">:</text>
                <text x="200" y="132">:</text>
                <text x="228" y="132">5.05</text>
                <text x="272" y="132">:</text>
                <text x="236" y="148">:........:</text>
                <text x="236" y="196">NO</text>
                <text x="232" y="212">|</text>
                <text x="152" y="228">YES</text>
                <text x="28" y="244">Is</text>
                <text x="64" y="244">there</text>
                <text x="104" y="244">the</text>
                <text x="220" y="244">Am</text>
                <text x="240" y="244">I</text>
                <text x="256" y="244">a</text>
                <text x="388" y="244">Is</text>
                <text x="424" y="244">there</text>
                <text x="460" y="244">an</text>
                <text x="56" y="260">Proxy-Uri</text>
                <text x="108" y="260">or</text>
                <text x="240" y="260">forward</text>
                <text x="404" y="260">OSCORE</text>
                <text x="464" y="260">option?</text>
                <text x="56" y="276">Proxy-Cri</text>
                <text x="236" y="276">proxy?</text>
                <text x="48" y="292">option?</text>
                <text x="408" y="292">|</text>
                <text x="472" y="292">|</text>
                <text x="216" y="308">|</text>
                <text x="412" y="308">NO</text>
                <text x="472" y="308">YES</text>
                <text x="32" y="324">|</text>
                <text x="216" y="324">YES</text>
                <text x="36" y="340">NO</text>
                <text x="276" y="388">..........</text>
                <text x="240" y="404">:</text>
                <text x="276" y="404">Return</text>
                <text x="312" y="404">:</text>
                <text x="240" y="420">:</text>
                <text x="268" y="420">4.01</text>
                <text x="312" y="420">:</text>
                <text x="276" y="436">:........:</text>
                <text x="472" y="452">Are</text>
                <text x="512" y="452">there</text>
                <text x="492" y="468">Uri-Path</text>
                <text x="152" y="484">YES</text>
                <text x="276" y="484">NO</text>
                <text x="492" y="484">options?</text>
                <text x="152" y="500">|</text>
                <text x="272" y="500">|</text>
                <text x="456" y="516">|</text>
                <text x="536" y="516">|</text>
                <text x="28" y="532">Is</text>
                <text x="64" y="532">there</text>
                <text x="104" y="532">the</text>
                <text x="220" y="532">Is</text>
                <text x="244" y="532">it</text>
                <text x="456" y="532">YES</text>
                <text x="540" y="532">NO</text>
                <text x="68" y="548">Proxy-Scheme</text>
                <text x="132" y="548">or</text>
                <text x="252" y="548">acceptable</text>
                <text x="308" y="548">to</text>
                <text x="96" y="564">Proxy-Scheme-Number</text>
                <text x="240" y="564">forward</text>
                <text x="288" y="564">the</text>
                <text x="48" y="580">option,</text>
                <text x="116" y="580">together</text>
                <text x="244" y="580">request?</text>
                <text x="296" y="580">(#)</text>
                <text x="476" y="580">..........</text>
                <text x="36" y="596">with</text>
                <text x="72" y="596">the</text>
                <text x="124" y="596">Uri-Host</text>
                <text x="440" y="596">:</text>
                <text x="476" y="596">Return</text>
                <text x="512" y="596">:</text>
                <text x="28" y="612">or</text>
                <text x="76" y="612">Uri-Port</text>
                <text x="144" y="612">option?</text>
                <text x="280" y="612">|</text>
                <text x="440" y="612">:</text>
                <text x="468" y="612">4.00</text>
                <text x="512" y="612">:</text>
                <text x="280" y="628">YES</text>
                <text x="476" y="628">..........</text>
                <text x="32" y="644">|</text>
                <text x="36" y="660">NO</text>
                <text x="224" y="724">Consume</text>
                <text x="272" y="724">the</text>
                <text x="444" y="724">Is</text>
                <text x="468" y="724">it</text>
                <text x="248" y="740">proxy-related</text>
                <text x="476" y="740">acceptable</text>
                <text x="532" y="740">to</text>
                <text x="224" y="756">options</text>
                <text x="464" y="756">decrypt</text>
                <text x="512" y="756">the</text>
                <text x="468" y="772">request?</text>
                <text x="520" y="772">(#)</text>
                <text x="448" y="804">|</text>
                <text x="528" y="804">|</text>
                <text x="452" y="820">NO</text>
                <text x="528" y="820">YES</text>
                <text x="344" y="852">YES</text>
                <text x="344" y="868">|</text>
                <text x="164" y="900">Does</text>
                <text x="200" y="900">the</text>
                <text x="256" y="900">authority</text>
                <text x="168" y="916">(host</text>
                <text x="208" y="916">and</text>
                <text x="248" y="916">port)</text>
                <text x="284" y="916">of</text>
                <text x="312" y="916">the</text>
                <text x="468" y="916">..........</text>
                <text x="176" y="932">request</text>
                <text x="224" y="932">URI</text>
                <text x="276" y="932">identify</text>
                <text x="328" y="932">me?</text>
                <text x="432" y="932">:</text>
                <text x="468" y="932">Return</text>
                <text x="504" y="932">:</text>
                <text x="432" y="948">:</text>
                <text x="460" y="948">4.01</text>
                <text x="504" y="948">:</text>
                <text x="280" y="964">|</text>
                <text x="468" y="964">:........:</text>
                <text x="284" y="980">NO</text>
                <text x="496" y="1028">Decrypt</text>
                <text x="296" y="1044">...........</text>
                <text x="40" y="1060">There</text>
                <text x="76" y="1060">is</text>
                <text x="100" y="1060">no</text>
                <text x="164" y="1060">Proxy-Scheme</text>
                <text x="256" y="1060">:</text>
                <text x="296" y="1060">Forward</text>
                <text x="336" y="1060">:</text>
                <text x="28" y="1076">or</text>
                <text x="120" y="1076">Proxy-Scheme-Number</text>
                <text x="256" y="1076">:</text>
                <text x="280" y="1076">the</text>
                <text x="336" y="1076">:</text>
                <text x="48" y="1092">option,</text>
                <text x="96" y="1092">but</text>
                <text x="136" y="1092">there</text>
                <text x="176" y="1092">are</text>
                <text x="256" y="1092">:</text>
                <text x="296" y="1092">request</text>
                <text x="336" y="1092">:</text>
                <text x="52" y="1108">Uri-Path</text>
                <text x="116" y="1108">and/or</text>
                <text x="180" y="1108">Uri-Host</text>
                <text x="296" y="1108">:.........:</text>
                <text x="44" y="1124">and/or</text>
                <text x="108" y="1124">Uri-Port</text>
                <text x="176" y="1124">options</text>
                <text x="492" y="1124">Success?</text>
                <text x="456" y="1156">|</text>
                <text x="460" y="1172">NO</text>
                <text x="536" y="1204">YES</text>
                <text x="132" y="1252">..........</text>
                <text x="500" y="1252">................</text>
                <text x="96" y="1268">:</text>
                <text x="132" y="1268">Return</text>
                <text x="168" y="1268">:</text>
                <text x="248" y="1268">Consume</text>
                <text x="296" y="1268">the</text>
                <text x="440" y="1268">:</text>
                <text x="476" y="1268">OSCORE</text>
                <text x="528" y="1268">error</text>
                <text x="560" y="1268">:</text>
                <text x="96" y="1284">:</text>
                <text x="124" y="1284">4.01</text>
                <text x="168" y="1284">:</text>
                <text x="272" y="1284">proxy-related</text>
                <text x="440" y="1284">:</text>
                <text x="484" y="1284">handling</text>
                <text x="560" y="1284">:</text>
                <text x="132" y="1300">:........:</text>
                <text x="248" y="1300">options</text>
                <text x="500" y="1300">:..............:</text>
                <text x="140" y="1364">NO</text>
                <text x="420" y="1364">Is</text>
                <text x="456" y="1364">there</text>
                <text x="492" y="1364">an</text>
                <text x="136" y="1380">|</text>
                <text x="460" y="1380">application?</text>
                <text x="100" y="1412">Is</text>
                <text x="124" y="1412">it</text>
                <text x="424" y="1412">|</text>
                <text x="496" y="1412">|</text>
                <text x="132" y="1428">acceptable</text>
                <text x="188" y="1428">to</text>
                <text x="248" y="1428">YES</text>
                <text x="424" y="1428">YES</text>
                <text x="500" y="1428">NO</text>
                <text x="120" y="1444">forward</text>
                <text x="168" y="1444">the</text>
                <text x="124" y="1460">request?</text>
                <text x="176" y="1460">(#)</text>
                <text x="500" y="1476">..........</text>
                <text x="464" y="1492">:</text>
                <text x="500" y="1492">Return</text>
                <text x="536" y="1492">:</text>
                <text x="464" y="1508">:</text>
                <text x="492" y="1508">4.00</text>
                <text x="536" y="1508">:</text>
                <text x="136" y="1524">YES</text>
                <text x="500" y="1524">:........:</text>
                <text x="136" y="1540">|</text>
                <text x="468" y="1556">..................</text>
                <text x="28" y="1572">Am</text>
                <text x="48" y="1572">I</text>
                <text x="64" y="1572">a</text>
                <text x="128" y="1572">reverse-proxy</text>
                <text x="208" y="1572">using</text>
                <text x="248" y="1572">the</text>
                <text x="400" y="1572">:</text>
                <text x="440" y="1572">Deliver</text>
                <text x="488" y="1572">the</text>
                <text x="536" y="1572">:</text>
                <text x="40" y="1588">exact</text>
                <text x="88" y="1588">value</text>
                <text x="124" y="1588">of</text>
                <text x="160" y="1588">these</text>
                <text x="224" y="1588">Uri-Path,</text>
                <text x="308" y="1588">NO</text>
                <text x="400" y="1588">:</text>
                <text x="440" y="1588">request</text>
                <text x="484" y="1588">to</text>
                <text x="512" y="1588">the</text>
                <text x="536" y="1588">:</text>
                <text x="56" y="1604">Uri-Host,</text>
                <text x="112" y="1604">and</text>
                <text x="164" y="1604">Uri-Port</text>
                <text x="232" y="1604">options</text>
                <text x="400" y="1604">:</text>
                <text x="456" y="1604">application</text>
                <text x="536" y="1604">:</text>
                <text x="32" y="1620">for</text>
                <text x="88" y="1620">proxying?</text>
                <text x="468" y="1620">:................:</text>
                <text x="16" y="1684">(#)</text>
                <text x="52" y="1684">This</text>
                <text x="84" y="1684">is</text>
                <text x="140" y="1684">determined</text>
                <text x="224" y="1684">according</text>
                <text x="276" y="1684">to</text>
                <text x="304" y="1684">the</text>
                <text x="364" y="1684">endpoint's</text>
                <text x="464" y="1684">configuration</text>
                <text x="48" y="1700">and</text>
                <text x="72" y="1700">a</text>
                <text x="116" y="1700">possible</text>
                <text x="208" y="1700">authorization</text>
                <text x="316" y="1700">enforcement.</text>
              </g>
            </svg><a href="#appendix-D-2.1.1" class="pilcrow">Â¶</a>
</div>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-processing-of-an-incoming-req" class="selfRef">Processing of an Incoming Request</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="sec-document-updates">
<section id="appendix-E">
      <h2 id="name-document-updates">
<a href="#appendix-E" class="section-number selfRef">Appendix E. </a><a href="#name-document-updates" class="section-name selfRef">Document Updates</a>
      </h2>
<p id="appendix-E-1">This section is to be removed before publishing as an RFC.<a href="#appendix-E-1" class="pilcrow">Â¶</a></p>
<div id="sec-04-05">
<section id="appendix-E.1">
        <h3 id="name-version-04-to-05">
<a href="#appendix-E.1" class="section-number selfRef">E.1. </a><a href="#name-version-04-to-05" class="section-name selfRef">Version -04 to -05</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-E.1-1.1">
            <p id="appendix-E.1-1.1.1">Fixes in the examples of message exchange.<a href="#appendix-E.1-1.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.1-1.2">
            <p id="appendix-E.1-1.2.1">Minor clarifications and editorial improvements.<a href="#appendix-E.1-1.2.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-03-04">
<section id="appendix-E.2">
        <h3 id="name-version-03-to-04">
<a href="#appendix-E.2" class="section-number selfRef">E.2. </a><a href="#name-version-03-to-04" class="section-name selfRef">Version -03 to -04</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-E.2-1.1">
            <p id="appendix-E.2-1.1.1">Removed definition and use of "OSCORE-in-OSCORE".<a href="#appendix-E.2-1.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.2-1.2">
            <p id="appendix-E.2-1.2.1">Moved use cases to an appendix.<a href="#appendix-E.2-1.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.2-1.3">
            <p id="appendix-E.2-1.3.1">Explain deviations from RFC 8613 as an actual subsection.<a href="#appendix-E.2-1.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.2-1.4">
            <p id="appendix-E.2-1.4.1">More precise indication of outer or inner CoAP options.<a href="#appendix-E.2-1.4.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.2-1.5">
            <p id="appendix-E.2-1.5.1">Added security consideration on membership of OSCORE groups.<a href="#appendix-E.2-1.5.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.2-1.6">
            <p id="appendix-E.2-1.6.1">Updated references.<a href="#appendix-E.2-1.6.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.2-1.7">
            <p id="appendix-E.2-1.7.1">Editorial improvements.<a href="#appendix-E.2-1.7.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-02-03">
<section id="appendix-E.3">
        <h3 id="name-version-02-to-03">
<a href="#appendix-E.3" class="section-number selfRef">E.3. </a><a href="#name-version-02-to-03" class="section-name selfRef">Version -02 to -03</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-E.3-1.1">
            <p id="appendix-E.3-1.1.1">Clarified motivation for updating RFC 8768 in the introduction.<a href="#appendix-E.3-1.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.3-1.2">
            <p id="appendix-E.3-1.2.1">Explained that OSCORE-capable proxies have to recognize CoAP options included in outgoing messages to protect.<a href="#appendix-E.3-1.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.3-1.3">
            <p id="appendix-E.3-1.3.1">Fixed typo about the intended class of Hop-Limit option for OSCORE.<a href="#appendix-E.3-1.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.3-1.4">
            <p id="appendix-E.3-1.4.1">Fixed protection of the Uri-Host option in examples.<a href="#appendix-E.3-1.4.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.3-1.5">
            <p id="appendix-E.3-1.5.1">Added security considerations about the Hop-Limit option.<a href="#appendix-E.3-1.5.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.3-1.6">
            <p id="appendix-E.3-1.6.1">Clarifications and editorial improvements.<a href="#appendix-E.3-1.6.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-01-02">
<section id="appendix-E.4">
        <h3 id="name-version-01-to-02">
<a href="#appendix-E.4" class="section-number selfRef">E.4. </a><a href="#name-version-01-to-02" class="section-name selfRef">Version -01 to -02</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-E.4-1.1">
            <p id="appendix-E.4-1.1.1">Revised escalation of CoAP option protection.<a href="#appendix-E.4-1.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.4-1.2">
            <p id="appendix-E.4-1.2.1">Specified general ordering for protecting outgoing requests.<a href="#appendix-E.4-1.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.4-1.3">
            <p id="appendix-E.4-1.3.1">Explicit definition of OSCORE processing for the Hop-Limit option (update to RFC 8768).<a href="#appendix-E.4-1.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.4-1.4">
            <p id="appendix-E.4-1.4.1">Added examples of message exchange with a reverse-proxy.<a href="#appendix-E.4-1.4.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.4-1.5">
            <p id="appendix-E.4-1.5.1">Clarifications and editorial improvements.<a href="#appendix-E.4-1.5.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-00-01">
<section id="appendix-E.5">
        <h3 id="name-version-00-to-01">
<a href="#appendix-E.5" class="section-number selfRef">E.5. </a><a href="#name-version-00-to-01" class="section-name selfRef">Version -00 to -01</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-E.5-1.1">
            <p id="appendix-E.5-1.1.1">Escalation of option protection as explicit update point to RFC 8613.<a href="#appendix-E.5-1.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.5-1.2">
            <p id="appendix-E.5-1.2.1">Clarified examples of Class U/I CoAP options that become encrypted.<a href="#appendix-E.5-1.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.5-1.3">
            <p id="appendix-E.5-1.3.1">Considered also the CoAP Options Proxy-Cri and Proxy-Scheme-Number.<a href="#appendix-E.5-1.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.5-1.4">
            <p id="appendix-E.5-1.4.1">Added reference to Onion CoAP as use case.<a href="#appendix-E.5-1.4.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.5-1.5">
            <p id="appendix-E.5-1.5.1">Required to set a limit on OSCORE layers that can be added/removed.<a href="#appendix-E.5-1.5.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.5-1.6">
            <p id="appendix-E.5-1.6.1">Revised general rules on protecting CoAP options.<a href="#appendix-E.5-1.6.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.5-1.7">
            <p id="appendix-E.5-1.7.1">A forward-proxy consumes a request when the request URI identifies the proxy itself.<a href="#appendix-E.5-1.7.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.5-1.8">
            <p id="appendix-E.5-1.8.1">Consistency fix: a reverse-proxy can forward based on Uri-Host, Uri-Port or Uri-Path.<a href="#appendix-E.5-1.8.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.5-1.9">
            <p id="appendix-E.5-1.9.1">Generalized authorization checks as acceptability checks.<a href="#appendix-E.5-1.9.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.5-1.10">
            <p id="appendix-E.5-1.10.1">Added acceptability check before decrypting a request.<a href="#appendix-E.5-1.10.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.5-1.11">
            <p id="appendix-E.5-1.11.1">Fixes in the examples of message exchange.<a href="#appendix-E.5-1.11.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.5-1.12">
            <p id="appendix-E.5-1.12.1">Updated state diagram of the incoming request processing.<a href="#appendix-E.5-1.12.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.5-1.13">
            <p id="appendix-E.5-1.13.1">Added state diagram on the protection of CoAP options of Class U/I.<a href="#appendix-E.5-1.13.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.5-1.14">
            <p id="appendix-E.5-1.14.1">Updated references.<a href="#appendix-E.5-1.14.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-E.5-1.15">
            <p id="appendix-E.5-1.15.1">Editorial fixes and improvements.<a href="#appendix-E.5-1.15.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-F">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-F-1">The authors sincerely thank <span class="contact-name">Christian AmsÃ¼ss</span>, <span class="contact-name">Peter Blomqvist</span>, <span class="contact-name">Carsten Bormann</span>, <span class="contact-name">David Navarro</span>, <span class="contact-name">GÃ¶ran Selander</span>, and <span class="contact-name">Lucas Ãhl</span> for their comments and feedback.<a href="#appendix-F-1" class="pilcrow">Â¶</a></p>
<p id="appendix-F-2">The work on this document has been partly supported by the Sweden's Innovation Agency VINNOVA and the Celtic-Next projects CRITISEC and CYPRESS; and by the H2020 project SIFIS-Home (Grant agreement 952652).<a href="#appendix-F-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-G">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Marco Tiloca</span></div>
<div dir="auto" class="left"><span class="org">RISE AB</span></div>
<div dir="auto" class="left"><span class="street-address">Isafjordsgatan 22</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">164 40</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:marco.tiloca@ri.se" class="email">marco.tiloca@ri.se</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Rikard HÃ¶glund</span></div>
<div dir="auto" class="left"><span class="org">RISE AB</span></div>
<div dir="auto" class="left"><span class="street-address">Isafjordsgatan 22</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">164 40</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:rikard.hoglund@ri.se" class="email">rikard.hoglund@ri.se</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
